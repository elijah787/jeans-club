<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeans Club - Raised on Denim</title>
    <style>
        /* MERCEDES-BENZ INSPIRED STYLES */
        * {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
            box-sizing: border-box;
        }

        html {
            width: 100%;
            height: 100%;
            font-size: 62.5%;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            font-size: 1.6rem;
            line-height: 1.6;
            color: #000;
            background: #fff;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* MERCEDES-BENZ INSPIRED LAYOUT */
        .mercedes-layout {
            position: relative;
            min-height: 100vh;
            width: 100%;
        }

        /* Hero Section - Like Mercedes hero */
        .hero-section {
            position: relative;
            height: 100vh;
            min-height: 600px;
            background: linear-gradient(135deg, #000000 0%, #333333 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 8rem;
        }

        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7));
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: #fff;
            padding: 0 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero-title {
            font-size: 8rem;
            font-weight: 300;
            letter-spacing: -0.02em;
            margin-bottom: 2rem;
            line-height: 1.1;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s ease forwards 0.3s;
        }

        .hero-subtitle {
            font-size: 2.4rem;
            font-weight: 300;
            margin-bottom: 4rem;
            opacity: 0.8;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s ease forwards 0.6s;
        }

        .hero-cta {
            display: inline-block;
            padding: 1.8rem 4rem;
            font-size: 1.6rem;
            font-weight: 500;
            color: #fff;
            background: transparent;
            border: 1px solid #fff;
            border-radius: 0;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s ease forwards 0.9s;
            cursor: pointer;
        }

        .hero-cta:hover {
            background: #fff;
            color: #000;
        }

        /* Content Sections - Mercedes Style */
        .content-section {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            margin-bottom: 12rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 6rem;
        }

        .section-title {
            font-size: 4.8rem;
            font-weight: 300;
            margin-bottom: 2rem;
            letter-spacing: -0.01em;
        }

        .section-subtitle {
            font-size: 1.8rem;
            color: #666;
            font-weight: 300;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Cards Grid - Mercedes Style */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 3rem;
            margin-bottom: 6rem;
        }

        .mercedes-card {
            background: #fff;
            padding: 4rem 3rem;
            border: 1px solid #eee;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .mercedes-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .card-icon {
            font-size: 4rem;
            margin-bottom: 3rem;
        }

        .card-title {
            font-size: 2.4rem;
            font-weight: 400;
            margin-bottom: 2rem;
            line-height: 1.3;
        }

        .card-description {
            font-size: 1.6rem;
            color: #666;
            margin-bottom: 3rem;
            line-height: 1.6;
        }

        .card-link {
            display: inline-flex;
            align-items: center;
            font-size: 1.4rem;
            font-weight: 500;
            color: #000;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .card-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: #000;
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }

        .card-link:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }

        /* Form Styles - Mercedes Inspired */
        .mercedes-form {
            max-width: 500px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 3rem;
        }

        .form-label {
            display: block;
            font-size: 1.4rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #000;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .form-input {
            width: 100%;
            padding: 1.5rem;
            font-size: 1.6rem;
            background: transparent;
            border: 1px solid #ddd;
            border-radius: 0;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #000;
        }

        .mercedes-button {
            display: inline-block;
            padding: 1.8rem 4rem;
            font-size: 1.4rem;
            font-weight: 500;
            color: #000;
            background: transparent;
            border: 1px solid #000;
            border-radius: 0;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            text-align: center;
        }

        .mercedes-button:hover {
            background: #000;
            color: #fff;
        }

        .mercedes-button.secondary {
            background: #f5f5f5;
            border-color: #ddd;
            color: #666;
        }

        .mercedes-button.secondary:hover {
            background: #ddd;
            border-color: #ddd;
            color: #000;
        }

        /* Navigation */
        .main-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 4rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .nav-logo {
            font-size: 2.4rem;
            font-weight: 300;
            letter-spacing: -0.02em;
            text-decoration: none;
            color: #000;
        }

        .nav-links {
            display: flex;
            gap: 4rem;
        }

        .nav-link {
            font-size: 1.4rem;
            font-weight: 400;
            color: #000;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: #000;
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }

        .nav-link:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }

        /* Dashboard Elements - Mercedes Style */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #eee;
        }

        .dashboard-title {
            font-size: 3.2rem;
            font-weight: 300;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .info-item {
            padding: 2rem;
            border: 1px solid #eee;
        }

        .info-label {
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 2.4rem;
            font-weight: 300;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 5rem;
            }
            
            .hero-subtitle {
                font-size: 1.8rem;
            }
            
            .section-title {
                font-size: 3.2rem;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                display: none;
            }
            
            .main-nav {
                padding: 1.5rem 2rem;
            }
        }

        /* Mercedes Form Content Styling */
        .mercedes-form-content {
            background: #fff;
            padding: 4rem;
            border: 1px solid #eee;
            max-width: 500px;
            margin: 0 auto;
        }

        .mercedes-form-content .form-group {
            margin-bottom: 2rem;
        }

        .mercedes-form-content .btn {
            width: 100%;
            padding: 1.5rem;
            font-size: 1.4rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border: 1px solid #000;
            background: transparent;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            border-radius: 0;
        }

        .mercedes-form-content .btn:hover {
            background: #000;
            color: #fff;
        }

        .mercedes-form-content .google-signin-button,
        .mercedes-form-content .google-login-button {
            margin: 2rem 0;
        }

        .mercedes-form-content .section-title {
            font-size: 2.4rem;
            margin-bottom: 1rem;
        }

        .mercedes-form-content .form-group label {
            font-size: 1.4rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #000;
            margin-bottom: 0.5rem;
            display: block;
        }

        .mercedes-form-content .form-group input {
            width: 100%;
            padding: 1.2rem;
            border: 1px solid #ddd;
            font-size: 1.6rem;
            font-family: inherit;
        }

        .mercedes-form-content .form-group input:focus {
            outline: none;
            border-color: #000;
        }

        /* IMPROVED MEMBER CARD STYLES - Exactly like second index.html */
        .member-card-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .member-card {
            width: 360px;
            height: 220px;
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
            font-family: 'Arial', sans-serif;
            color: white;
            transition: transform 0.3s ease;
        }

        .member-card:hover {
            transform: translateY(-5px);
        }

        /* UPDATED TIER COLORS */
        .member-card.pearl {
            background: linear-gradient(135deg, #FFF8DC 0%, #F5DEB3 100%);
            color: #333;
        }

        .member-card.bronze {
            background: linear-gradient(135deg, #B76E79 0%, #8B475D 100%);
        }

        .member-card.silver {
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
        }

        .member-card.ruby {
            background: linear-gradient(135deg, #8B475D 0%, #6B3648 100%);
        }

        .member-card.gold {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
        }

        .member-card.sapphire {
            background: linear-gradient(135deg, #34495E 0%, #1F2B3A 100%);
        }

        .member-card.platinum {
            background: linear-gradient(135deg, #2F4F4F 0%, #000000 100%);
        }

        /* Card design elements */
        .card-background-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.8) 2px, transparent 2px),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.6) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .card-logo {
            position: absolute;
            top: 20px;
            right: 25px;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 1px;
        }

        .card-chip {
            position: absolute;
            top: 20px;
            left: 25px;
            width: 40px;
            height: 30px;
            background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 100%);
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .card-chip::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            width: 30px;
            height: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 3px;
        }

        .card-number {
            position: absolute;
            top: 90px;
            left: 25px;
            font-size: 18px;
            letter-spacing: 2px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            width: calc(100% - 50px);
            white-space: nowrap;
            overflow: visible;
            text-overflow: clip;
        }

        .card-holder {
            position: absolute;
            bottom: 50px;
            left: 25px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .card-holder-name {
            font-size: 16px;
            font-weight: bold;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card-tier {
            position: absolute;
            bottom: 25px;
            left: 25px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
        }

        .card-date {
            position: absolute;
            bottom: 25px;
            right: 25px;
            font-weight: bold;
            font-size: 14px;
            letter-spacing: 1px;
        }

        .card-number span {
            display: inline-block;
            background: rgba(0,0,0,0.2);
            padding: 2px 5px;
            margin: 0 2px;
            border-radius: 3px;
            min-width: 20px;
            text-align: center;
        }

        .card-hologram {
            position: absolute;
            top: 20px;
            right: 80px;
            width: 50px;
            height: 30px;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 5px,
                    rgba(255,255,255,0.2) 5px,
                    rgba(255,255,255,0.2) 10px
                ),
                repeating-linear-gradient(
                    -45deg,
                    transparent,
                    transparent 5px,
                    rgba(255,255,255,0.1) 5px,
                    rgba(255,255,255,0.1) 10px
                );
            border-radius: 5px;
            transform: skewX(-10deg);
            box-shadow: 0 0 5px rgba(255,255,255,0.3);
        }

        /* Hidden sections */
        .hidden {
            display: none !important;
        }

        /* Functional card styles */
        .functional-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            font-family: inherit;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.google {
            background: white;
            color: #333;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn.google img {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        /* Activity log */
        .activity-log {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        /* Voucher styles */
        .voucher-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
        }

        .voucher-item.used {
            border-left-color: #6c757d;
            opacity: 0.7;
        }

        .voucher-item.expired {
            border-left-color: #dc3545;
        }

        .voucher-code {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px 0;
        }

        .voucher-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-used {
            background: #e2e3e5;
            color: #383d41;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        /* QR Redemption Styles */
        .redemption-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .redemption-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .redemption-option.selected {
            border-color: #28a745;
            background: #e8f5e8;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #2196F3;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            word-wrap: break-word;
        }

        .toast-success {
            background: #4CAF50;
        }

        .toast-error {
            background: #f44336;
        }

        .toast-info {
            background: #2196F3;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Fade-in animations */
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .fade-in-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .member-card {
                width: 320px;
                height: 200px;
            }
            
            .card-number {
                font-size: 16px;
                top: 80px;
            }
            
            .card-holder {
                bottom: 110px;
            }
            
            .card-tier, .card-date {
                bottom: 20px;
                font-size: 12px;
            }
            
            .mercedes-form-content {
                padding: 2rem;
            }
        }
    </style>
    <!-- Add Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</head>
<body>
    <!-- Mercedes-Benz Inspired Layout -->
    <div class="mercedes-layout">
        <!-- Navigation -->
        <nav class="main-nav">
            <a href="#home" class="nav-logo">JEANS CLUB</a>
            <div class="nav-links">
                <a href="#home" class="nav-link">Home</a>
                <a href="#features" class="nav-link">Features</a>
                <a href="#signup" class="nav-link">Sign Up</a>
                <a href="#dashboard" class="nav-link">Dashboard</a>
                <a href="#admin" class="nav-link">Admin</a>
                <a href="#qr" class="nav-link">QR System</a>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero-section" id="home">
            <div class="hero-background"></div>
            <div class="hero-content">
                <h1 class="hero-title">JEANS CLUB</h1>
                <p class="hero-subtitle">Tiered Privileges & Premium Denim Experience</p>
                <button class="hero-cta" onclick="scrollToFeatures()">Discover Membership</button>
            </div>
        </section>

        <!-- Features Section -->
        <section class="content-section" id="features">
            <div class="section-header">
                <h2 class="section-title">Premium Membership Benefits</h2>
                <p class="section-subtitle">Experience exclusive rewards with our tiered loyalty program</p>
            </div>
            
            <div class="cards-grid">
                <div class="mercedes-card fade-in-section">
                    <div class="card-icon">üéñÔ∏è</div>
                    <h3 class="card-title">7 Exclusive Tiers</h3>
                    <p class="card-description">Progress from Pearl to Platinum with increasing benefits and rewards at each level.</p>
                    <a href="#" class="card-link" onclick="showMercedesSignup()">Start Your Journey</a>
                </div>
                
                <div class="mercedes-card fade-in-section">
                    <div class="card-icon">üí∞</div>
                    <h3 class="card-title">Points & Rewards</h3>
                    <p class="card-description">Earn points with every purchase and redeem them for exclusive discounts and vouchers.</p>
                    <a href="#" class="card-link" onclick="showMercedesDashboard()">View Rewards</a>
                </div>
                
                <div class="mercedes-card fade-in-section">
                    <div class="card-icon">üë•</div>
                    <h3 class="card-title">Referral Program</h3>
                    <p class="card-description">Invite friends and earn bonus points for every successful referral to grow our community.</p>
                    <a href="#" class="card-link" onclick="showMercedesDashboard()">Invite Friends</a>
                </div>
                
                <div class="mercedes-card fade-in-section">
                    <div class="card-icon">üì±</div>
                    <h3 class="card-title">QR Code Redemption</h3>
                    <p class="card-description">Modern QR code system for easy point redemption and voucher management.</p>
                    <a href="#" class="card-link" onclick="showMercedesQR()">Learn More</a>
                </div>
            </div>
        </section>

        <!-- Signup Section -->
        <section class="content-section" id="signup">
            <div class="section-header">
                <h2 class="section-title">Become a Member</h2>
                <p class="section-subtitle">Join our exclusive community and start earning rewards today</p>
            </div>
            
            <div id="signup-content" class="mercedes-form">
                <!-- Content will be dynamically loaded here -->
            </div>
        </section>

        <!-- Dashboard Section -->
        <section class="content-section" id="dashboard">
            <div class="section-header">
                <h2 class="section-title">Member Dashboard</h2>
                <p class="section-subtitle">Manage your membership, track points, and redeem rewards</p>
            </div>
            
            <div id="dashboard-content" class="mercedes-form">
                <!-- Dashboard content will be dynamically loaded here -->
            </div>
        </section>

        <!-- Admin Section -->
        <section class="content-section" id="admin">
            <div class="section-header">
                <h2 class="section-title">Staff Administration</h2>
                <p class="section-subtitle">Manage members, vouchers, and system operations</p>
            </div>
            
            <div id="admin-content" class="mercedes-form">
                <!-- Admin content will be dynamically loaded here -->
            </div>
        </section>

        <!-- QR Section -->
        <section class="content-section" id="qr">
            <div class="section-header">
                <h2 class="section-title">QR Code System</h2>
                <p class="section-subtitle">Modern redemption system for easy point management</p>
            </div>
            
            <div id="qr-content" class="mercedes-form">
                <!-- QR content will be dynamically loaded here -->
            </div>
        </section>
    </div>

    <script>
        // Global variables
        let clubManager = null;
        let voucherSystem = null;
        let qrRedemptionSystem = null;
        let currentRedemptionOptions = [];
        let selectedOptionIndex = -1;
        let currentPurchaseAmount = 0;

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize systems
            initializeSystems();
            
            // Initialize animations
            initializeAnimations();
            
            // Initialize navigation
            initializeNavigation();
            
            // Initialize Google Sign-In
            if (typeof google !== 'undefined') {
                setTimeout(initializeGoogleSignIn, 1000);
            }
            
            // Show signup by default
            showMercedesSignup();
        });

        // Initialize all systems
        function initializeSystems() {
            // Initialize Jeans Club Manager
            clubManager = new JeansClubManager();
            
            // Initialize Voucher System
            voucherSystem = new VoucherSystem();
            
            // Initialize QR Redemption System
            qrRedemptionSystem = new QRRedemptionSystem();
            
            // Check if user is already logged in
            if (clubManager.currentMember) {
                showMercedesDashboard();
            }
        }

        // Initialize animations
        function initializeAnimations() {
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.fade-in-section').forEach((section) => {
                observer.observe(section);
            });
        }

        // Initialize navigation
        function initializeNavigation() {
            // Navigation scroll
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    
                    // Hide all sections
                    hideAllMercedesSections();
                    
                    // Show the target section
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.style.display = 'block';
                        
                        // Handle special cases
                        if (targetId === 'admin') {
                            showMercedesAdminLogin();
                        } else if (targetId === 'dashboard') {
                            showMercedesDashboard();
                        } else if (targetId === 'signup') {
                            showMercedesSignup();
                        } else if (targetId === 'qr') {
                            showMercedesQR();
                        } else if (targetId === 'home') {
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }
                        
                        // Scroll to the section
                        window.scrollTo({
                            top: targetSection.offsetTop - 80,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        // Scroll to features
        function scrollToFeatures() {
            document.querySelector('#features').scrollIntoView({
                behavior: 'smooth'
            });
        }

        // Hide all Mercedes sections
        function hideAllMercedesSections() {
            document.querySelectorAll('.content-section').forEach(section => {
                if (section.id !== 'features') {
                    section.style.display = 'none';
                }
            });
            document.getElementById('features').style.display = 'block';
        }

        // Show Mercedes Signup
        function showMercedesSignup() {
            hideAllMercedesSections();
            document.getElementById('signup').style.display = 'block';
            
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">Create Account</h3>
                    <div class="form-group">
                        <label class="form-label" for="userName">Full Name</label>
                        <input type="text" id="userName" class="form-input" placeholder="Enter your full name" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="userEmail">Email Address</label>
                        <input type="email" id="userEmail" class="form-input" placeholder="Enter your email" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="userPassword">Password</label>
                        <input type="password" id="userPassword" class="form-input" placeholder="Create a password" autocomplete="new-password">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="referralCode">Referral Code (Optional)</label>
                        <input type="text" id="referralCode" class="form-input" placeholder="Enter referral code if any" autocomplete="off">
                    </div>
                    
                    <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin: 20px 0;">
                        <input type="checkbox" id="newsletterSignup" checked style="width: auto;">
                        <label for="newsletterSignup" style="font-size: 1.4rem; color: #666; text-transform: none; letter-spacing: normal;">
                            Subscribe to our newsletter for exclusive deals and updates
                        </label>
                    </div>
                    
                    <button class="mercedes-button" onclick="signUpWithEmail()">Create Account</button>
                    
                    <div class="form-group" style="text-align: center; margin: 20px 0;">
                        <div style="border-bottom: 1px solid #ddd; line-height: 0.1em; margin: 10px 0 20px;">
                            <span style="background: white; padding: 0 10px; color: #666;">OR</span>
                        </div>
                        <div class="google-signin-button"></div>
                    </div>
                    
                    <div class="form-group" style="text-align: center;">
                        <p style="font-size: 1.4rem; color: #666;">
                            Already have an account? 
                            <a href="#" onclick="showMercedesLogin()" style="color: #000; text-decoration: none; font-weight: 500;">Login here</a>
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('signup-content').innerHTML = content;
            
            // Initialize Google button
            setTimeout(() => {
                if (typeof google !== 'undefined') {
                    initializeGoogleSignIn();
                }
            }, 100);
            
            // Scroll to section
            document.querySelector('#signup').scrollIntoView({ behavior: 'smooth' });
        }

        // Show Mercedes Login
        function showMercedesLogin() {
            hideAllMercedesSections();
            document.getElementById('signup').style.display = 'block';
            
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">Login to Your Account</h3>
                    <div class="form-group">
                        <label class="form-label" for="loginJCId">JC ID</label>
                        <input type="text" id="loginJCId" class="form-input" placeholder="Enter your JC ID" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password" autocomplete="current-password">
                    </div>
                    
                    <button class="mercedes-button" onclick="loginWithCredentials()">Login</button>
                    
                    <div class="form-group" style="text-align: center; margin: 20px 0;">
                        <a href="#" onclick="showMercedesPasswordReset()" style="color: #000; text-decoration: none; font-size: 1.4rem;">Forgot Password?</a>
                    </div>
                    
                    <div class="form-group" style="text-align: center; margin: 20px 0;">
                        <div style="border-bottom: 1px solid #ddd; line-height: 0.1em; margin: 10px 0 20px;">
                            <span style="background: white; padding: 0 10px; color: #666;">OR</span>
                        </div>
                        <div class="google-login-button"></div>
                    </div>
                    
                    <div class="form-group" style="text-align: center;">
                        <p style="font-size: 1.4rem; color: #666;">
                            Don't have an account? 
                            <a href="#" onclick="showMercedesSignup()" style="color: #000; text-decoration: none; font-weight: 500;">Sign up here</a>
                        </p>
                    </div>
                    
                    <div class="form-group" style="text-align: center; margin-top: 20px;">
                        <button class="mercedes-button secondary" onclick="showMercedesAdminLogin()">Staff Login</button>
                    </div>
                </div>
            `;
            
            document.getElementById('signup-content').innerHTML = content;
            
            // Initialize Google button
            setTimeout(() => {
                if (typeof google !== 'undefined') {
                    initializeGoogleSignIn();
                }
            }, 100);
            
            // Scroll to section
            document.querySelector('#signup').scrollIntoView({ behavior: 'smooth' });
        }

        // Show Mercedes Password Reset
        function showMercedesPasswordReset() {
            hideAllMercedesSections();
            document.getElementById('signup').style.display = 'block';
            
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <div style="margin-bottom: 2rem;">
                        <button class="mercedes-button secondary" onclick="showMercedesLogin()" style="width: auto; padding: 1rem 2rem;">Back to Login</button>
                    </div>
                    
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">Reset Your Password</h3>
                    
                    <div class="info-card">
                        <h4 style="font-size: 1.8rem; margin-bottom: 1.5rem;">Request Password Reset</h4>
                        <div class="form-group">
                            <label class="form-label" for="resetJCId">Your JC ID</label>
                            <input type="text" id="resetJCId" class="form-input" placeholder="Enter your JC ID">
                        </div>
                        <button class="mercedes-button" onclick="requestPasswordReset()">Send Reset Code</button>
                        <div id="resetRequestResult" style="margin-top: 10px;"></div>
                    </div>

                    <div id="resetForm" class="info-card hidden">
                        <h4 style="font-size: 1.8rem; margin-bottom: 1.5rem;">Enter Reset Code & New Password</h4>
                        <div class="form-group">
                            <label class="form-label" for="resetToken">Reset Code (Check your email)</label>
                            <input type="text" id="resetToken" class="form-input" placeholder="Enter the reset code from email">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="newPassword">New Password</label>
                            <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password">
                        </div>
                        <button class="mercedes-button" onclick="executePasswordReset()">Reset Password</button>
                        <div id="resetExecuteResult" style="margin-top: 10px;"></div>
                    </div>

                    <div class="info-card">
                        <h4 style="font-size: 1.8rem; margin-bottom: 1.5rem;">Need Help?</h4>
                        <p style="color: #666; margin-bottom: 1rem;">If you're having trouble resetting your password:</p>
                        <ul style="color: #666; padding-left: 2rem;">
                            <li>Make sure you're entering the correct JC ID</li>
                            <li>Check your spam folder for the reset email</li>
                            <li>Reset codes expire after 1 hour</li>
                            <li>Google accounts don't use passwords - use Google Sign-In</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('signup-content').innerHTML = content;
            document.querySelector('#signup').scrollIntoView({ behavior: 'smooth' });
        }

        // Show Mercedes Dashboard
        function showMercedesDashboard() {
            if (!clubManager.currentMember) {
                showMercedesLogin();
                return;
            }
            
            hideAllMercedesSections();
            document.getElementById('dashboard').style.display = 'block';
            
            const member = clubManager.currentMember;
            updateMercedesDashboard(member);
            document.querySelector('#dashboard').scrollIntoView({ behavior: 'smooth' });
        }

        // Update Mercedes Dashboard
        function updateMercedesDashboard(member) {
            const tier = clubManager.getTier(member);
            const progress = clubManager.getTierProgress(member);
            
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <div style="display: flex; gap: 1rem; margin-bottom: 3rem; flex-wrap: wrap;">
                        <button class="mercedes-button secondary" onclick="logout()" style="width: auto; padding: 1rem 2rem;">Logout</button>
                        <button class="mercedes-button secondary" onclick="refreshData()" style="width: auto; padding: 1rem 2rem;">Refresh Data</button>
                        <button class="mercedes-button" onclick="showMercedesQRRedemption()" style="width: auto; padding: 1rem 2rem;">üéüÔ∏è QR Code Redemption</button>
                    </div>
                    
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">Member Dashboard</h3>
                    
                    <!-- Member Card -->
                    <div class="member-card-container">
                        <div id="memberCard" class="member-card ${member.tier.toLowerCase()}">
                            <div class="card-background-pattern"></div>
                            <div class="card-logo">JEANS CLUB</div>
                            <div class="card-chip"></div>
                            <div class="card-hologram"></div>
                            <div class="card-number" id="cardNumber">${formatJCId(member.jcId)}</div>
                            <div class="card-holder">
                                CARD HOLDER
                                <div class="card-holder-name" id="cardHolderName">${member.name.toUpperCase()}</div>
                            </div>
                            <div class="card-tier" id="cardTier">${member.tier}</div>
                            <div class="card-date" id="cardDate">${formatJoinDate(member.joinedDate)}</div>
                        </div>
                    </div>
                    
                    <!-- Member Info -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin: 3rem 0;">
                        <div class="info-card">
                            <h4>JC ID</h4>
                            <p style="font-size: 1.8rem; font-weight: bold;">${member.jcId}</p>
                        </div>
                        <div class="info-card">
                            <h4>Name</h4>
                            <p style="font-size: 1.8rem; font-weight: bold;">${member.name}</p>
                        </div>
                        <div class="info-card">
                            <h4>Email</h4>
                            <p style="font-size: 1.6rem;">${member.email}</p>
                        </div>
                        <div class="info-card">
                            <h4>Login Method</h4>
                            <p style="font-size: 1.6rem;">${member.loginMethod || 'email'}</p>
                        </div>
                    </div>
                    
                    <!-- Stats -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin: 3rem 0;">
                        <div class="info-card">
                            <h4>Current Tier</h4>
                            <p style="font-size: 1.8rem; font-weight: bold;">${member.tier}</p>
                        </div>
                        <div class="info-card">
                            <h4>Points Balance</h4>
                            <p style="font-size: 1.8rem; font-weight: bold;">${member.points?.toLocaleString() || 0} points</p>
                        </div>
                        <div class="info-card">
                            <h4>Total Spent</h4>
                            <p style="font-size: 1.8rem; font-weight: bold;">${(member.totalSpent || 0).toLocaleString()} UGX</p>
                        </div>
                        <div class="info-card">
                            <h4>Referral Code</h4>
                            <p style="font-size: 1.6rem; font-family: 'Courier New', monospace;">${member.referralCode}</p>
                        </div>
                    </div>
                    
                    <!-- Tier Progress -->
                    <div class="info-card">
                        <h4>Tier Progress</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress.progress}%"></div>
                        </div>
                        <p style="margin-top: 1rem; color: #666;">
                            Progress to ${progress.nextTier || 'max tier'}: ${progress.currentPoints.toLocaleString()}/${progress.maxPoints.toLocaleString()} points
                        </p>
                    </div>
                    
                    <!-- Newsletter -->
                    <div class="info-card">
                        <h4>Newsletter Preferences</h4>
                        <p style="color: #666; margin-bottom: 1rem;">Get exclusive deals, new arrivals, and style tips delivered to your inbox</p>
                        <button class="mercedes-button ${member.newsletterSubscribed !== false ? 'secondary' : ''}" onclick="toggleNewsletter()" id="newsletterToggle" style="width: auto; padding: 1rem 2rem;">
                            ${member.newsletterSubscribed !== false ? 'Unsubscribe from Newsletter' : 'Subscribe to Newsletter'}
                        </button>
                    </div>
                    
                    <!-- Referral Stats -->
                    <div class="info-card">
                        <h4>Referral Stats</h4>
                        <p id="referralStats" style="color: #666; margin-bottom: 1rem;">
                            ${getReferralStats(member)}
                        </p>
                        <button class="mercedes-button" onclick="shareReferral()" style="width: auto; padding: 1rem 2rem;">Share Referral Code</button>
                    </div>
                    
                    <!-- Discount Calculator -->
                    <div class="info-card">
                        <h4>Redeem Points for Discount</h4>
                        <div class="form-group">
                            <label class="form-label" for="discountPoints">Points to Use (Min: 10)</label>
                            <input type="number" id="discountPoints" class="form-input" placeholder="Enter points to redeem" min="10">
                        </div>
                        <button class="mercedes-button" onclick="calculateDiscount()" style="margin-bottom: 1rem;">Calculate Discount</button>
                        <div id="discountResult" style="margin-top: 1rem;"></div>
                        <button class="mercedes-button secondary" onclick="redeemPoints()" style="margin-top: 1rem;">Generate Discount Voucher</button>
                    </div>
                    
                    <!-- Vouchers -->
                    <div class="info-card">
                        <h4>My Discount Vouchers</h4>
                        <div id="vouchersList" class="activity-log" style="margin-top: 1rem;">
                            ${getVouchersHTML(member.jcId)}
                        </div>
                    </div>
                    
                    <!-- Activity Log -->
                    <div class="info-card">
                        <h4>Recent Activity</h4>
                        <div id="activityLog" class="activity-log" style="margin-top: 1rem;">
                            ${getActivityLogHTML(member)}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('dashboard-content').innerHTML = content;
        }

        // Show Mercedes Admin Login
        function showMercedesAdminLogin() {
            hideAllMercedesSections();
            document.getElementById('admin').style.display = 'block';
            
            const content = `
                <div class="mercedes-form-content fade-in-section" style="max-width: 400px;">
                    <div class="card-icon" style="text-align: center; font-size: 4rem;">üîí</div>
                    <h3 class="card-title" style="text-align: center;">Staff Login</h3>
                    <p class="card-description" style="text-align: center;">Enter the staff password to access administrative functions</p>
                    
                    <div class="form-group">
                        <label class="form-label">Staff Password</label>
                        <input type="password" id="mercedesAdminPassword" class="form-input" placeholder="Enter staff password">
                    </div>
                    
                    <button class="mercedes-button" onclick="mercedesAdminLogin()">Login as Staff</button>
                    
                    <div id="mercedesAdminResult" style="margin-top: 2rem; text-align: center;"></div>
                </div>
            `;
            
            document.getElementById('admin-content').innerHTML = content;
            document.querySelector('#admin').scrollIntoView({ behavior: 'smooth' });
        }

        // Show Mercedes Admin Panel
        function showMercedesAdminPanel() {
            if (!clubManager.isAdmin) {
                showMercedesAdminLogin();
                return;
            }
            
            hideAllMercedesSections();
            document.getElementById('admin').style.display = 'block';
            
            loadAdminMembers();
            document.querySelector('#admin').scrollIntoView({ behavior: 'smooth' });
        }

        // Show Mercedes QR
        function showMercedesQR() {
            hideAllMercedesSections();
            document.getElementById('qr').style.display = 'block';
            
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <div style="margin-bottom: 2rem;">
                        <button class="mercedes-button secondary" onclick="showMercedesDashboard()" style="width: auto; padding: 1rem 2rem;">‚Üê Back to Dashboard</button>
                    </div>
                    
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">üéüÔ∏è QR Code Redemption</h3>
                    
                    <div style="display: grid; gap: 2rem; margin-top: 2rem;">
                        <div class="info-card">
                            <h4>Step 1: Enter Purchase Amount</h4>
                            <div class="form-group">
                                <label class="form-label" for="qrPurchaseAmount">Purchase Amount (UGX):</label>
                                <input type="number" id="qrPurchaseAmount" class="form-input" placeholder="Enter purchase amount">
                            </div>
                            <button class="mercedes-button" onclick="calculateRedemptionOptions()">Calculate Redemption Options</button>
                        </div>
                        
                        <div class="info-card">
                            <h4>Step 2: Choose Redemption Option</h4>
                            <div id="redemptionOptions">
                                <div class="info-card">
                                    <p style="color: #666;">Enter a purchase amount to see available redemption options based on your tier.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h4>Step 3: Selected Option Details</h4>
                            <div id="selectedOptionDetails">
                                <div class="info-card">
                                    <p style="color: #666;">No option selected yet.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h4>Step 4: Generate QR Code</h4>
                            <div id="qrCodeContainer">
                                <div class="info-card">
                                    <p style="color: #666;">Select a redemption option to generate QR code.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="qrRedemptionResult" style="margin-top: 2rem;"></div>
                </div>
            `;
            
            document.getElementById('qr-content').innerHTML = content;
            document.querySelector('#qr').scrollIntoView({ behavior: 'smooth' });
        }

        // Show Mercedes QR Redemption
        function showMercedesQRRedemption() {
            hideAllMercedesSections();
            document.getElementById('qr').style.display = 'block';
            
            if (!clubManager.currentMember) {
                showMercedesLogin();
                return;
            }
            
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <div style="margin-bottom: 2rem;">
                        <button class="mercedes-button secondary" onclick="showMercedesDashboard()" style="width: auto; padding: 1rem 2rem;">‚Üê Back to Dashboard</button>
                    </div>
                    
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">üéüÔ∏è QR Code Redemption</h3>
                    
                    <div style="display: grid; gap: 2rem; margin-top: 2rem;">
                        <div class="info-card">
                            <h4>Step 1: Enter Purchase Amount</h4>
                            <div class="form-group">
                                <label class="form-label" for="qrPurchaseAmount">Purchase Amount (UGX):</label>
                                <input type="number" id="qrPurchaseAmount" class="form-input" placeholder="Enter purchase amount">
                            </div>
                            <button class="mercedes-button" onclick="calculateRedemptionOptions()">Calculate Redemption Options</button>
                        </div>
                        
                        <div class="info-card">
                            <h4>Step 2: Choose Redemption Option</h4>
                            <div id="redemptionOptions">
                                <div class="info-card">
                                    <p style="color: #666;">Enter a purchase amount to see available redemption options based on your tier.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h4>Step 3: Selected Option Details</h4>
                            <div id="selectedOptionDetails">
                                <div class="info-card">
                                    <p style="color: #666;">No option selected yet.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h4>Step 4: Generate QR Code</h4>
                            <div id="qrCodeContainer">
                                <div class="info-card">
                                    <p style="color: #666;">Select a redemption option to generate QR code.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="qrRedemptionResult" style="margin-top: 2rem;"></div>
                </div>
            `;
            
            document.getElementById('qr-content').innerHTML = content;
            document.querySelector('#qr').scrollIntoView({ behavior: 'smooth' });
        }

        // Helper functions
        function formatJCId(jcId) {
            return jcId.split('').map(char => `<span>${char}</span>`).join('');
        }

        function formatJoinDate(joinDate) {
            const date = new Date(joinDate);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear().toString().slice(-2);
            return `${month}/${year}`;
        }

        function getReferralStats(member) {
            const referrals = member.referrals || [];
            return `You've referred ${referrals.length} members and earned ${referrals.length * 100} bonus points!`;
        }

        function getVouchersHTML(memberJCId) {
            const vouchers = voucherSystem.getMemberVouchers(memberJCId);
            
            if (vouchers.length === 0) {
                return '<div class="activity-item">No vouchers yet. Redeem your points for a discount voucher!</div>';
            }
            
            return vouchers.map(voucher => {
                const statusClass = voucher.status === 'active' ? 'status-active' : 
                                  voucher.status === 'used' ? 'status-used' : 'status-expired';
                const statusText = voucher.status === 'active' ? 'ACTIVE' :
                                 voucher.status === 'used' ? 'USED' : 'EXPIRED';
                
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(voucher.qrCodeData)}`;
                
                return `
                    <div class="voucher-item ${voucher.status}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h5 style="font-size: 1.6rem; margin: 0;">${voucher.discountPercentage}% Discount Voucher</h5>
                            <span class="voucher-status ${statusClass}">${statusText}</span>
                        </div>
                        <p><strong>Code:</strong> <span class="voucher-code">${voucher.code}</span></p>
                        <p><strong>Created:</strong> ${new Date(voucher.createdDate).toLocaleDateString()}</p>
                        <p><strong>Expires:</strong> ${new Date(voucher.expiryDate).toLocaleDateString()}</p>
                        <p><strong>Points Used:</strong> ${voucher.pointsUsed} points</p>
                        ${voucher.status === 'active' ? `
                            <div style="text-align: center; margin: 1rem 0;">
                                <img src="${qrCodeUrl}" alt="Voucher QR Code" style="max-width: 150px; border: 1px solid #ddd; border-radius: 5px;">
                                <p style="font-size: 1.2rem; color: #666; margin-top: 0.5rem;">Show this QR code at checkout</p>
                            </div>
                        ` : ''}
                        ${voucher.usedDate ? `<p><strong>Redeemed:</strong> ${new Date(voucher.usedDate).toLocaleDateString()}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        function getActivityLogHTML(member) {
            const activities = member.activityLog || [];
            
            if (activities.length === 0) {
                return '<div class="activity-item">No activity yet</div>';
            }
            
            return activities.slice(0, 10).map(activity => `
                <div class="activity-item">
                    <strong>${activity.type}</strong>: ${activity.description}
                    ${activity.points ? ` (${activity.points > 0 ? '+' : ''}${activity.points} points)` : ''}
                    <br><small>${new Date(activity.date).toLocaleString()}</small>
                </div>
            `).join('');
        }

        // ========== ALL THE FUNCTIONAL CODE FROM SECOND HTML ==========
        // Note: I'm including the complete functional code here
        // This includes all the classes and functions from the second HTML

        // Enhanced email validation function
        function isValidEmail(email) {
            if (!email || typeof email !== 'string') return false;
            
            const trimmedEmail = email.trim();
            if (trimmedEmail.length < 8) return false;
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(trimmedEmail)) {
                return false;
            }
            
            const [localPart, domain] = trimmedEmail.toLowerCase().split('@');
            if (localPart.length === 0 || localPart.length > 64) return false;
            
            const localPartRegex = /^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*$/;
            if (!localPartRegex.test(localPart)) return false;
            
            if (domain.length < 4) return false;
            
            const domainParts = domain.split('.');
            if (domainParts.length < 2) return false;
            
            for (const part of domainParts) {
                if (part.length === 0 || part.length > 63) return false;
                if (!/^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$/.test(part)) return false;
            }
            
            const commonDomains = ['gmail.com', 'yahoo.com', 'outlook.com', 'hotmail.com', 'icloud.com', 'protonmail.com'];
            const domainWithoutTld = domain.slice(0, domain.lastIndexOf('.'));
            
            for (const commonDomain of commonDomains) {
                const commonDomainWithoutTld = commonDomain.slice(0, commonDomain.lastIndexOf('.'));
                if (domainWithoutTld === commonDomainWithoutTld) {
                    const expectedTld = commonDomain.slice(commonDomain.lastIndexOf('.') + 1);
                    const actualTld = domainParts[domainParts.length - 1];
                    
                    if (actualTld !== expectedTld) {
                        console.log(`Detected likely typo: ${domain} should probably be ${commonDomain}`);
                        return false;
                    }
                }
            }
            
            const tld = domainParts[domainParts.length - 1];
            const validCommonTlds = ['com', 'org', 'net', 'edu', 'gov', 'mil', 'io', 'co', 'uk', 'us', 
                                   'ca', 'au', 'de', 'fr', 'jp', 'cn', 'in', 'br', 'ru', 'it', 'es', 
                                   'mx', 'kr', 'za', 'ng', 'ke', 'tz', 'ug'];
            
            if (tld.length <= 2 && !validCommonTlds.includes(tld.toLowerCase())) {
                return false;
            }
            
            if (tld.length < 2) return false;
            
            const fakePatterns = [
                'test@', 'example@', 'fake@', 'admin@', 'user@', 'temp@', 'dummy@',
                'a@a.a', 'aa@aa.aa', 'aaa@aaa.aaa',
                'con', 'c', 'com',
            ];
            
            const lowerEmail = trimmedEmail.toLowerCase();
            for (const pattern of fakePatterns) {
                if (lowerEmail.includes(pattern) && trimmedEmail.length < 10) {
                    return false;
                }
            }
            
            if (trimmedEmail.includes('..')) return false;
            if (trimmedEmail.includes('@@')) return false;
            if (trimmedEmail.startsWith('.') || trimmedEmail.endsWith('.')) return false;
            if (trimmedEmail.startsWith('@') || trimmedEmail.endsWith('@')) return false;
            
            if (/(\w)\1\1/.test(localPart)) {
                return false;
            }
            
            return true;
        }

        // Voucher System Class
        class VoucherSystem {
            constructor() {
                this.vouchers = JSON.parse(localStorage.getItem('jeansClubVouchers') || '[]');
                this.voucherActivity = JSON.parse(localStorage.getItem('jeansClubVoucherActivity') || '[]');
            }

            generateVoucherCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 8; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return 'JC' + code;
            }

            generateQRCodeData(voucherCode) {
                return JSON.stringify({
                    code: voucherCode,
                    timestamp: Date.now(),
                    type: 'jeansclub_voucher'
                });
            }

            createVoucher(memberJCId, memberName, pointsUsed, discountPercentage, expiryDays = 30) {
                const voucherCode = this.generateVoucherCode();
                const createdDate = new Date();
                const expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + expiryDays);

                const voucher = {
                    id: 'voucher_' + Date.now(),
                    code: voucherCode,
                    memberJCId: memberJCId,
                    memberName: memberName,
                    pointsUsed: pointsUsed,
                    discountPercentage: discountPercentage,
                    createdDate: createdDate.toISOString(),
                    expiryDate: expiryDate.toISOString(),
                    status: 'active',
                    usedDate: null,
                    qrCodeData: this.generateQRCodeData(voucherCode)
                };

                this.vouchers.push(voucher);
                this.saveVouchers();

                this.logVoucherActivity(voucherCode, 'created', memberJCId, `Voucher created: ${discountPercentage}% discount`);

                return voucher;
            }

            getMemberVouchers(memberJCId) {
                return this.vouchers.filter(v => v.memberJCId === memberJCId)
                    .sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
            }

            getAllVouchers() {
                return this.vouchers.sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
            }

            getVoucherByCode(code) {
                return this.vouchers.find(v => v.code === code);
            }

            redeemVoucher(voucherCode, redeemedBy = 'system') {
                const voucher = this.getVoucherByCode(voucherCode);
                if (!voucher) {
                    return { success: false, message: "Voucher not found" };
                }

                if (voucher.status === 'used') {
                    return { success: false, message: "Voucher has already been used" };
                }

                if (voucher.status === 'expired') {
                    return { success: false, message: "Voucher has expired" };
                }

                if (new Date() > new Date(voucher.expiryDate)) {
                    voucher.status = 'expired';
                    this.saveVouchers();
                    return { success: false, message: "Voucher has expired" };
                }

                voucher.status = 'used';
                voucher.usedDate = new Date().toISOString();
                voucher.redeemedBy = redeemedBy;
                this.saveVouchers();

                this.logVoucherActivity(voucherCode, 'redeemed', voucher.memberJCId, `Voucher redeemed by ${redeemedBy}`);

                return { 
                    success: true, 
                    message: `Voucher redeemed successfully! ${voucher.discountPercentage}% discount applied.`,
                    voucher: voucher
                };
            }

            updateVoucherStatuses() {
                const now = new Date();
                let updated = false;

                this.vouchers.forEach(voucher => {
                    if (voucher.status === 'active' && new Date(voucher.expiryDate) < now) {
                        voucher.status = 'expired';
                        updated = true;
                    }
                });

                if (updated) {
                    this.saveVouchers();
                }
            }

            getVoucherStats() {
                this.updateVoucherStatuses();
                
                const total = this.vouchers.length;
                const active = this.vouchers.filter(v => v.status === 'active').length;
                const used = this.vouchers.filter(v => v.status === 'used').length;
                const expired = this.vouchers.filter(v => v.status === 'expired').length;
                
                const totalDiscount = this.vouchers
                    .filter(v => v.status === 'used')
                    .reduce((sum, v) => sum + v.discountPercentage, 0);
                
                const avgDiscount = used > 0 ? (totalDiscount / used).toFixed(1) : 0;

                return {
                    total,
                    active,
                    used,
                    expired,
                    avgDiscount,
                    redemptionRate: total > 0 ? ((used / total) * 100).toFixed(1) + '%' : '0%'
                };
            }

            logVoucherActivity(voucherCode, action, memberJCId, description) {
                const activity = {
                    timestamp: new Date().toISOString(),
                    voucherCode: voucherCode,
                    action: action,
                    memberJCId: memberJCId,
                    description: description
                };

                this.voucherActivity.unshift(activity);
                if (this.voucherActivity.length > 100) {
                    this.voucherActivity = this.voucherActivity.slice(0, 100);
                }
                localStorage.setItem('jeansClubVoucherActivity', JSON.stringify(this.voucherActivity));
            }

            saveVouchers() {
                localStorage.setItem('jeansClubVouchers', JSON.stringify(this.vouchers));
            }
        }

        // Supabase Database Manager
        const { createClient } = supabase;

        class SupabaseDB {
            constructor() {
                this.supabaseUrl = 'https://uoyzsyxjrfygrsfzhlao.supabase.co';
                this.anonKey = 'sb_publishable__gS2-Pd9S7I5dBlq4rmzMQ_K2QMwovA';
                
                this.supabase = createClient(this.supabaseUrl, this.anonKey);
                this.cacheKey = 'jeansClubCache';
                this.init();
                console.log('üöÄ SupabaseDB initialized with URL:', this.supabaseUrl);
            }

            async init() {
                if (!this.getCache()) {
                    this.setCache({ members: [], lastSync: 0 });
                }
            }

            getCache() {
                try {
                    const cache = localStorage.getItem(this.cacheKey);
                    return cache ? JSON.parse(cache) : null;
                } catch (error) {
                    console.error('Error reading cache:', error);
                    return null;
                }
            }

            setCache(data) {
                try {
                    localStorage.setItem(this.cacheKey, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Error writing to storage:', error);
                    return false;
                }
            }

            async getAllMembers() {
                try {
                    console.log('üîÑ Fetching all members from Supabase...');
                    
                    const { data: members, error } = await this.supabase
                        .from('members')
                        .select('*');

                    if (error) {
                        console.error('‚ùå Supabase error:', error);
                        throw error;
                    }

                    console.log(`‚úÖ Loaded ${members?.length || 0} members from Supabase`);
                    
                    this.setCache({
                        members: members || [],
                        lastSync: Date.now()
                    });

                    return members || [];

                } catch (error) {
                    console.error('‚ùå Failed to fetch from Supabase, using cache:', error);
                    const cache = this.getCache();
                    return cache?.members || [];
                }
            }

            async saveMember(member) {
                try {
                    console.log('üíæ Saving member to Supabase:', member.jcId);
                    
                    const memberData = {
                        jcId: member.jcId,
                        id: member.id || 'member_' + Date.now(),
                        email: member.email,
                        name: member.name,
                        password: member.password || null,
                        googleId: member.googleId || null,
                        loginMethod: member.loginMethod || 'email',
                        points: member.points || 0,
                        tier: member.tier || 'PEARL',
                        referralCode: member.referralCode,
                        referredBy: member.referredBy || null,
                        purchaseHistory: member.purchaseHistory || [],
                        activityLog: member.activityLog || [],
                        joinedDate: member.joinedDate || new Date().toISOString(),
                        totalSpent: member.totalSpent || 0,
                        challenges: member.challenges || [],
                        referrals: member.referrals || [],
                        resetToken: member.resetToken || null,
                        resetTokenExpiry: member.resetTokenExpiry || null
                    };

                    const { data, error } = await this.supabase
                        .from('members')
                        .upsert(memberData, { 
                            onConflict: 'jcId'
                        });

                    if (error) {
                        console.error('‚ùå Supabase save error:', error);
                        throw error;
                    }

                    console.log('‚úÖ Member saved successfully to Supabase');
                    
                    const cache = this.getCache();
                    if (cache) {
                        cache.lastSync = 0;
                        this.setCache(cache);
                    }

                    return true;

                } catch (error) {
                    console.error('‚ùå Failed to save member to Supabase:', error);
                    return false;
                }
            }

            async deleteMember(jcId) {
                try {
                    console.log('üóëÔ∏è Deleting member from Supabase:', jcId);
                    
                    const { error } = await this.supabase
                        .from('members')
                        .delete()
                        .eq('jcId', jcId);

                    if (error) {
                        console.error('‚ùå Supabase delete error:', error);
                        throw error;
                    }

                    console.log('‚úÖ Member deleted successfully from Supabase');
                    
                    const cache = this.getCache();
                    if (cache) {
                        cache.lastSync = 0;
                        this.setCache(cache);
                    }

                    return true;

                } catch (error) {
                    console.error('‚ùå Failed to delete member from Supabase:', error);
                    return false;
                }
            }

            async getMemberByJCId(jcId) {
                try {
                    console.log('üîç Fetching member from Supabase:', jcId);
                    
                    const { data: member, error } = await this.supabase
                        .from('members')
                        .select('*')
                        .eq('jcId', jcId)
                        .single();

                    if (error && error.code !== 'PGRST116') {
                        console.error('‚ùå Supabase fetch error:', error);
                        throw error;
                    }

                    return member || null;

                } catch (error) {
                    console.error('‚ùå Failed to fetch member from Supabase:', error);
                    
                    const cache = this.getCache();
                    if (cache?.members) {
                        return cache.members.find(m => m.jcId === jcId) || null;
                    }
                    
                    return null;
                }
            }

            async getMemberByEmail(email) {
                try {
                    console.log('üîç Fetching member by email from Supabase:', email);
                    
                    const { data: member, error } = await this.supabase
                        .from('members')
                        .select('*')
                        .eq('email', email)
                        .single();

                    if (error && error.code !== 'PGRST116') {
                        console.error('‚ùå Supabase fetch error:', error);
                        throw error;
                    }

                    return member || null;

                } catch (error) {
                    console.error('‚ùå Failed to fetch member by email from Supabase:', error);
                    
                    const cache = this.getCache();
                    if (cache?.members) {
                        return cache.members.find(m => m.email === email) || null;
                    }
                    
                    return null;
                }
            }

            async subscribeToNewsletter(email, name = null) {
                try {
                    console.log('üìß Subscribing to newsletter:', email);
                    
                    const { data, error } = await this.supabase
                        .from('newsletter_subscriptions')
                        .upsert({
                            email: email,
                            name: name,
                            is_active: true,
                            subscribed_at: new Date().toISOString(),
                            last_sent: null
                        }, { 
                            onConflict: 'email'
                        });

                    if (error) {
                        console.error('‚ùå Newsletter subscription error:', error);
                        throw error;
                    }

                    console.log('‚úÖ Newsletter subscription successful');
                    return true;

                } catch (error) {
                    console.error('‚ùå Failed to subscribe to newsletter:', error);
                    return false;
                }
            }

            async unsubscribeFromNewsletter(email) {
                try {
                    console.log('üìß Unsubscribing from newsletter:', email);
                    
                    const { data, error } = await this.supabase
                        .from('newsletter_subscriptions')
                        .update({ 
                            is_active: false,
                            unsubscribed_at: new Date().toISOString()
                        })
                        .eq('email', email);

                    if (error) {
                        console.error('‚ùå Newsletter unsubscribe error:', error);
                        throw error;
                    }

                    console.log('‚úÖ Newsletter unsubscribe successful');
                    return true;

                } catch (error) {
                    console.error('‚ùå Failed to unsubscribe from newsletter:', error);
                    return false;
                }
            }

            async getNewsletterSubscribers(activeOnly = true) {
                try {
                    let query = this.supabase
                        .from('newsletter_subscriptions')
                        .select('*');

                    if (activeOnly) {
                        query = query.eq('is_active', true);
                    }

                    const { data: subscribers, error } = await query;

                    if (error) {
                        console.error('‚ùå Newsletter fetch error:', error);
                        throw error;
                    }

                    return subscribers || [];

                } catch (error) {
                    console.error('‚ùå Failed to fetch newsletter subscribers:', error);
                    return [];
                }
            }

            async getNewsletterStatus(email) {
                try {
                    const { data: subscription, error } = await this.supabase
                        .from('newsletter_subscriptions')
                        .select('is_active')
                        .eq('email', email)
                        .single();

                    if (error && error.code !== 'PGRST116') {
                        console.error('‚ùå Newsletter status error:', error);
                        throw error;
                    }

                    return subscription ? subscription.is_active : false;

                } catch (error) {
                    console.error('‚ùå Failed to get newsletter status:', error);
                    return false;
                }
            }
        }

        // QR Code Redemption System
        class QRRedemptionSystem {
            constructor() {
                this.redemptions = JSON.parse(localStorage.getItem('jeansClubRedemptions') || '[]');
                this.encryptionKey = 'jeansclub_qr_2024_secret';
                
                this.tierRules = {
                    PEARL: { 
                        payWithPoints: false,
                        discountVoucherOnly: true,
                        description: "Basic membership - use points for discount vouchers only"
                    },
                    BRONZE: { 
                        months: 2, 
                        percentage: 0.08,
                        multiplier: 1.0,
                        minSpendingThreshold: 300000,
                        maxRedemptionCap: 50000,
                        description: "Redeem 8% of your last 2 months spending as points",
                        pointsPer100UGX: 100
                    },
                    SILVER: { 
                        months: 3, 
                        percentage: 0.10,
                        multiplier: 1.1,
                        minSpendingThreshold: 500000,
                        maxRedemptionCap: 100000,
                        description: "Redeem 10% of your last 3 months spending as points",
                        pointsPer100UGX: 90
                    },
                    RUBY: { 
                        months: 4, 
                        percentage: 0.12,
                        multiplier: 1.3,
                        minSpendingThreshold: 1000000,
                        maxRedemptionCap: 200000,
                        description: "Redeem 12% of your last 4 months spending as points",
                        pointsPer100UGX: 80
                    },
                    GOLD: { 
                        months: 5, 
                        percentage: 0.15,
                        multiplier: 1.4,
                        minSpendingThreshold: 2000000,
                        maxRedemptionCap: 300000,
                        description: "Redeem 15% of your last 5 months spending as points",
                        pointsPer100UGX: 70
                    },
                    SAPPHIRE: { 
                        months: 6, 
                        percentage: 0.18,
                        lifetimeBonus: 0.02,
                        multiplier: 1.5,
                        minSpendingThreshold: 4000000,
                        maxRedemptionCap: 500000,
                        description: "Redeem 18% of last 6 months + 2% lifetime bonus as points",
                        pointsPer100UGX: 60
                    },
                    PLATINUM: { 
                        months: 12, 
                        percentage: 0.25,
                        lifetimeBonus: 0.05,
                        multiplier: 1.6,
                        minSpendingThreshold: 8000000,
                        maxRedemptionCap: 1000000,
                        canChooseAny: true,
                        description: "Redeem 25% of last 12 months + 5% lifetime bonus as points",
                        pointsPer100UGX: 50
                    }
                };
                
                this.discountVoucherLimits = {
                    PEARL: { 
                        min: 1000, 
                        max: 5000, 
                        maxPercentage: 5,
                        pointsPerDiscount: 100
                    },
                    BRONZE: { 
                        min: 2000, 
                        max: 10000, 
                        maxPercentage: 8,
                        pointsPerDiscount: 100
                    },
                    SILVER: { 
                        min: 3000, 
                        max: 15000, 
                        maxPercentage: 10,
                        pointsPerDiscount: 100
                    },
                    RUBY: { 
                        min: 5000, 
                        max: 25000, 
                        maxPercentage: 12,
                        pointsPerDiscount: 100
                    },
                    GOLD: { 
                        min: 10000, 
                        max: 50000, 
                        maxPercentage: 15,
                        pointsPerDiscount: 100
                    },
                    SAPPHIRE: { 
                        min: 20000, 
                        max: 100000, 
                        maxPercentage: 18,
                        pointsPerDiscount: 100
                    },
                    PLATINUM: { 
                        min: 50000, 
                        max: 250000, 
                        maxPercentage: 25,
                        pointsPerDiscount: 100
                    }
                };
            }

            calculateSpendingHistory(member, months) {
                const cutoffDate = new Date();
                cutoffDate.setMonth(cutoffDate.getMonth() - months);
                
                let totalSpent = 0;
                if (member.purchaseHistory) {
                    member.purchaseHistory.forEach(purchase => {
                        const purchaseDate = new Date(purchase.date);
                        if (purchaseDate >= cutoffDate) {
                            totalSpent += purchase.amount || 0;
                        }
                    });
                }
                
                return totalSpent;
            }

            calculateLifetimeSpending(member) {
                return member.totalSpent || 0;
            }

            calculateRedemptionOptions(member, purchaseAmount) {
                const tier = member.tier;
                const options = [];
                const memberPoints = member.points || 0;
                
                if (tier === 'PEARL') {
                    return this.getDiscountVoucherOptions(member, purchaseAmount).filter(option => 
                        memberPoints >= option.pointsRequired
                    );
                }
                
                const eligibleTiers = tier === 'PLATINUM' ? ['BRONZE', 'SILVER', 'RUBY', 'GOLD', 'SAPPHIRE'] : [tier];
                
                eligibleTiers.forEach(tierType => {
                    const rule = this.tierRules[tierType];
                    if (!rule || !rule.months) return;
                    
                    const monthsSpending = this.calculateSpendingHistory(member, rule.months);
                    
                    if (monthsSpending < rule.minSpendingThreshold) {
                        return;
                    }
                    
                    let totalRedemption = monthsSpending * rule.percentage;
                    
                    if (rule.lifetimeBonus) {
                        const lifetimeSpending = this.calculateLifetimeSpending(member);
                        totalRedemption += lifetimeSpending * rule.lifetimeBonus;
                    }
                    
                    totalRedemption = Math.min(totalRedemption, rule.maxRedemptionCap);
                    
                    if (totalRedemption > 0) {
                        const pointsEquivalent = Math.floor(totalRedemption / 100 * rule.pointsPer100UGX);
                        
                        if (memberPoints >= pointsEquivalent) {
                            options.push({
                                type: 'points_redemption',
                                tier: tierType,
                                description: rule.description,
                                monthsSpending: monthsSpending,
                                totalAmount: totalRedemption,
                                maxRedemption: Math.min(totalRedemption, purchaseAmount),
                                pointsEquivalent: pointsEquivalent,
                                pointsValue: rule.pointsPer100UGX + ' points per 100 UGX',
                                eligibility: `Spent ${monthsSpending.toLocaleString()} UGX in last ${rule.months} months`,
                                requiresSufficientPoints: true,
                                memberHasPoints: true
                            });
                        }
                    }
                });
                
                const voucherOptions = this.getDiscountVoucherOptions(member, purchaseAmount)
                    .filter(option => memberPoints >= option.pointsRequired);
                
                options.push(...voucherOptions);
                
                return options.sort((a, b) => (b.maxRedemption || 0) - (a.maxRedemption || 0));
            }

            getDiscountVoucherOptions(member, purchaseAmount) {
                const tier = member.tier;
                const limits = this.discountVoucherLimits[tier] || this.discountVoucherLimits.PEARL;
                
                const options = [];
                const discountAmounts = [1000, 2000, 3000, 5000, 10000, 15000, 20000, 25000, 30000, 50000];
                
                discountAmounts.forEach(amount => {
                    if (amount >= limits.min && amount <= limits.max && amount <= purchaseAmount) {
                        const discountPercentage = ((amount / purchaseAmount) * 100).toFixed(1);
                        if (discountPercentage <= 100) {
                            options.push({
                                type: 'discount_voucher',
                                tier: tier,
                                description: `${amount.toLocaleString()} UGX Discount Voucher`,
                                discountAmount: amount,
                                discountPercentage: discountPercentage,
                                applicableAmount: purchaseAmount,
                                pointsRequired: Math.floor(amount / 100)
                            });
                        }
                    }
                });
                
                return options;
            }

            generateQRCodeData(redemptionData) {
                const qrData = {
                    type: 'jeansclub_redemption',
                    version: '1.0',
                    memberJCId: redemptionData.memberJCId,
                    redemptionId: redemptionData.redemptionId,
                    selectedOption: redemptionData.selectedOption,
                    purchaseAmount: redemptionData.purchaseAmount,
                    timestamp: Date.now(),
                    signature: this.generateSignature(redemptionData)
                };
                
                return this.encryptData(qrData);
            }

            generateSignature(data) {
                const dataString = data.memberJCId + data.redemptionId + data.selectedOption.type + Date.now();
                let hash = 0;
                for (let i = 0; i < dataString.length; i++) {
                    const char = dataString.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(36);
            }

            encryptData(data) {
                try {
                    const dataString = JSON.stringify(data);
                    let result = '';
                    for (let i = 0; i < dataString.length; i++) {
                        result += String.fromCharCode(dataString.charCodeAt(i) ^ this.encryptionKey.charCodeAt(i % this.encryptionKey.length));
                    }
                    return btoa(result);
                } catch (error) {
                    console.error('Encryption error:', error);
                    return JSON.stringify(data);
                }
            }

            decryptData(encryptedData) {
                try {
                    const decoded = atob(encryptedData);
                    let result = '';
                    for (let i = 0; i < decoded.length; i++) {
                        result += String.fromCharCode(decoded.charCodeAt(i) ^ this.encryptionKey.charCodeAt(i % this.encryptionKey.length));
                    }
                    return JSON.parse(result);
                } catch (error) {
                    console.error('Decryption error:', error);
                    return null;
                }
            }

            createRedemption(member, selectedOption, purchaseAmount) {
                const redemptionId = 'RED' + Date.now().toString().slice(-8) + Math.floor(1000 + Math.random() * 9000);
                
                const redemptionData = {
                    redemptionId: redemptionId,
                    memberJCId: member.jcId,
                    memberName: member.name,
                    memberTier: member.tier,
                    purchaseAmount: purchaseAmount,
                    selectedOption: selectedOption,
                    createdDate: new Date().toISOString(),
                    status: 'pending',
                    redeemedBy: null,
                    redeemedDate: null,
                    qrCodeData: null
                };

                redemptionData.qrCodeData = this.generateQRCodeData(redemptionData);

                this.redemptions.push(redemptionData);
                this.saveRedemptions();

                return redemptionData;
            }

            processRedemption(qrCodeData, salespersonName) {
                if (!salespersonName || salespersonName.trim() === '') {
                    return { success: false, message: "Salesperson name is required" };
                }

                const redemptionData = this.decryptData(qrCodeData);
                if (!redemptionData) {
                    return { success: false, message: "Invalid QR code data" };
                }

                const redemption = this.redemptions.find(r => r.redemptionId === redemptionData.redemptionId);
                if (!redemption) {
                    return { success: false, message: "Redemption not found" };
                }

                if (redemption.qrCodeData !== this.generateQRCodeData(redemption)) {
                    return { success: false, message: "QR code validation failed" };
                }

                if (redemption.status === 'completed') {
                    return { success: false, message: "Redemption has already been completed" };
                }

                if (redemption.status === 'expired') {
                    return { success: false, message: "Redemption has expired" };
                }

                redemption.status = 'completed';
                redemption.redeemedBy = salespersonName.trim();
                redemption.redeemedDate = new Date().toISOString();
                this.saveRedemptions();

                return {
                    success: true,
                    message: `Redemption completed successfully by ${salespersonName}`,
                    redemption: redemption
                };
            }

            getMemberRedemptions(memberJCId) {
                return this.redemptions
                    .filter(r => r.memberJCId === memberJCId)
                    .sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
            }

            getAllRedemptions() {
                return this.redemptions.sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
            }

            saveRedemptions() {
                localStorage.setItem('jeansClubRedemptions', JSON.stringify(this.redemptions));
            }

            getRedemptionStats() {
                const total = this.redemptions.length;
                const pending = this.redemptions.filter(r => r.status === 'pending').length;
                const completed = this.redemptions.filter(r => r.status === 'completed').length;
                const expired = this.redemptions.filter(r => r.status === 'expired').length;
                
                const totalValue = this.redemptions
                    .filter(r => r.status === 'completed')
                    .reduce((sum, r) => {
                        if (r.selectedOption.type === 'points_redemption') {
                            return sum + (r.selectedOption.maxRedemption || 0);
                        } else if (r.selectedOption.type === 'discount_voucher') {
                            return sum + (r.selectedOption.discountAmount || 0);
                        }
                        return sum;
                    }, 0);
                
                return {
                    total,
                    pending,
                    completed,
                    expired,
                    totalValue,
                    completionRate: total > 0 ? ((completed / total) * 100).toFixed(1) + '%' : '0%'
                };
            }
        }

        // Jeans Club Configuration
        const jeansClubConfig = {
            pointValue: 750,
            tierRedemptionRates: {
                PEARL: 0.0003,
                BRONZE: 0.0004,
                SILVER: 0.0005,
                RUBY: 0.0006,
                GOLD: 0.0007,
                SAPPHIRE: 0.0008,
                PLATINUM: 0.0010
            },
            tiers: {
                PEARL: { 
                    minPoints: 0, 
                    maxPoints: 7499,
                    multiplier: 1.0, 
                    name: "Pearl", 
                    color: "#FFF8DC",
                    discountRate: 0.03
                },
                BRONZE: { 
                    minPoints: 7500,    
                    maxPoints: 24999,
                    multiplier: 1.10, 
                    name: "Bronze", 
                    color: "#B76E79",
                    discountRate: 0.04
                },
                SILVER: { 
                    minPoints: 25000,    
                    maxPoints: 99999,
                    multiplier: 1.25, 
                    name: "Silver", 
                    color: "#2C3E50",
                    discountRate: 0.05
                },
                RUBY: { 
                    minPoints: 100000,    
                    maxPoints: 249999,
                    multiplier: 1.30, 
                    name: "Ruby", 
                    color: "#8B475D",
                    discountRate: 0.06
                },
                GOLD: { 
                    minPoints: 250000,    
                    maxPoints: 499999,
                    multiplier: 1.40, 
                    name: "Gold", 
                    color: "#FFD700",
                    discountRate: 0.07
                },
                SAPPHIRE: { 
                    minPoints: 500000,    
                    maxPoints: 999999,
                    multiplier: 1.50, 
                    name: "Sapphire", 
                    color: "#34495E",
                    discountRate: 0.08
                },
                PLATINUM: { 
                    minPoints: 1000000,    
                    maxPoints: 9999999,
                    multiplier: 1.60, 
                    name: "Platinum", 
                    color: "#2F4F4F",
                    discountRate: 0.10
                }
            }
        };

        // Main JeansClubManager
        class JeansClubManager {
            constructor() {
                this.db = new SupabaseDB();
                this.emailService = new GoogleAppsEmailService();
                this.currentMember = null;
                this.isAdmin = false;
                this.loadCurrentMember();
                console.log('üöÄ JeansClubManager initialized with Supabase DB');
            }

            generateJCId() {
                return 'JC' + Date.now().toString().slice(-6) + Math.floor(100 + Math.random() * 900);
            }

            generateReferralCode() {
                return 'JEANS' + Math.random().toString(36).substr(2, 6).toUpperCase();
            }

            generateResetToken() {
                return Math.random().toString(36).substr(2, 8).toUpperCase();
            }

            loadCurrentMember() {
                const savedMember = localStorage.getItem('jeansClubCurrentMember');
                if (savedMember) {
                    this.currentMember = JSON.parse(savedMember);
                }
            }

            saveCurrentMember() {
                if (this.currentMember) {
                    localStorage.setItem('jeansClubCurrentMember', JSON.stringify(this.currentMember));
                }
            }

            async createAccount(userData, password, referralCode = null) {
                console.log('üë§ Creating account for:', userData.email);
                
                const existingMember = await this.db.getMemberByEmail(userData.email);
                if (existingMember) {
                    return { success: false, message: "Email already registered" };
                }

                const memberId = 'member_' + Date.now();
                const startingPoints = referralCode ? 20 : 10;
                
                const newMember = {
                    id: memberId,
                    jcId: this.generateJCId(),
                    email: userData.email,
                    name: userData.name,
                    password: password,
                    googleId: null,
                    loginMethod: 'email',
                    points: startingPoints,
                    tier: 'PEARL',
                    referralCode: this.generateReferralCode(),
                    referredBy: referralCode || null,
                    purchaseHistory: [],
                    activityLog: [
                        {
                            type: 'account_created',
                            description: 'Account created successfully',
                            date: new Date().toISOString(),
                            points: startingPoints
                        }
                    ],
                    joinedDate: new Date().toISOString(),
                    totalSpent: 0,
                    challenges: [],
                    referrals: [],
                    resetToken: null,
                    resetTokenExpiry: null,
                    newsletterSubscribed: userData.newsletter || true
                };

                const saved = await this.db.saveMember(newMember);
                if (!saved) {
                    return { success: false, message: "Failed to create account. Please try again." };
                }

                if (referralCode) {
                    await this.processReferral(referralCode, newMember);
                }

                try {
                    await this.emailService.sendWelcomeEmail(newMember.email, newMember);
                    
                    if (userData.newsletter !== false) {
                        await this.emailService.sendNewsletterWelcomeEmail(newMember.email, newMember.name);
                        await this.db.subscribeToNewsletter(newMember.email, newMember.name);
                    }
                } catch (emailError) {
                    console.log('Email sending failed but account created:', emailError);
                }

                this.currentMember = newMember;
                this.saveCurrentMember();

                return {
                    success: true,
                    message: "Account created successfully! Welcome to Jeans Club.",
                    member: newMember
                };
            }

            async processReferral(referralCode, newMember) {
                try {
                    const allMembers = await this.db.getAllMembers();
                    const referrer = allMembers.find(m => m.referralCode === referralCode);
                    
                    if (referrer) {
                        referrer.points += 100;
                        referrer.referrals = referrer.referrals || [];
                        referrer.referrals.push({
                            referredJCId: newMember.jcId,
                            referredName: newMember.name,
                            date: new Date().toISOString(),
                            pointsAwarded: 100
                        });
                        
                        referrer.activityLog.unshift({
                            type: 'referral_bonus',
                            description: `Referred ${newMember.name} (${newMember.jcId})`,
                            date: new Date().toISOString(),
                            points: 100
                        });
                        
                        await this.db.saveMember(referrer);
                        
                        try {
                            await this.emailService.sendReferralEmail(
                                referrer.email, 
                                referrer, 
                                {
                                    newMemberName: newMember.name,
                                    newMemberJCId: newMember.jcId
                                }
                            );
                        } catch (emailError) {
                            console.log('Referral email failed:', emailError);
                        }
                    }
                } catch (error) {
                    console.error('Referral processing error:', error);
                }
            }

            async loginWithCredentials(jcId, password) {
                console.log('üîê Attempting login for JC ID:', jcId);
                
                let member = await this.db.getMemberByJCId(jcId);
                
                if (!member) {
                    return { success: false, message: "Invalid JC ID or password" };
                }

                if (member.password !== password) {
                    return { success: false, message: "Invalid JC ID or password" };
                }

                console.log('‚úÖ Login successful for JC ID:', jcId);
                
                member.lastLogin = new Date().toISOString();
                member.activityLog.unshift({
                    type: 'login',
                    description: 'Logged in successfully',
                    date: new Date().toISOString()
                });
                
                await this.db.saveMember(member);
                
                this.currentMember = member;
                this.saveCurrentMember();
                
                return {
                    success: true,
                    message: "Login successful!",
                    member: member
                };
            }

            async loginWithGoogle(googleUser) {
                console.log('üîê Attempting Google login');
                
                const profile = jwt_decode(googleUser.credential);
                const googleId = googleUser.sub;
                
                let member = await this.db.getMemberByEmail(profile.email);
                
                if (member) {
                    if (!member.googleId) {
                        member.googleId = googleId;
                        await this.db.saveMember(member);
                    }
                } else {
                    member = {
                        id: 'member_' + Date.now(),
                        jcId: this.generateJCId(),
                        email: profile.email,
                        name: profile.name,
                        password: null,
                        googleId: googleId,
                        loginMethod: 'google',
                        points: 10,
                        tier: 'PEARL',
                        referralCode: this.generateReferralCode(),
                        referredBy: null,
                        purchaseHistory: [],
                        activityLog: [{
                            type: 'account_created',
                            description: 'Account created via Google',
                            date: new Date().toISOString(),
                            points: 10
                        }],
                        joinedDate: new Date().toISOString(),
                        totalSpent: 0,
                        challenges: [],
                        referrals: [],
                        resetToken: null,
                        resetTokenExpiry: null,
                        newsletterSubscribed: true
                    };
                    
                    await this.db.saveMember(member);
                    
                    try {
                        await this.emailService.sendWelcomeEmail(member.email, member);
                        await this.emailService.sendNewsletterWelcomeEmail(member.email, member.name);
                        await this.db.subscribeToNewsletter(member.email, member.name);
                    } catch (emailError) {
                        console.log('Welcome email failed:', emailError);
                    }
                }
                
                member.lastLogin = new Date().toISOString();
                member.activityLog.unshift({
                    type: 'login',
                    description: 'Logged in via Google',
                    date: new Date().toISOString()
                });
                
                await this.db.saveMember(member);
                
                this.currentMember = member;
                this.saveCurrentMember();
                
                return {
                    success: true,
                    message: "Google login successful!",
                    member: member
                };
            }

            async adminLogin(adminCode) {
                const adminCodeHash = this.hashPassword(adminCode);
                const storedAdminHash = localStorage.getItem('jeansClubAdminHash');
                
                if (!storedAdminHash) {
                    localStorage.setItem('jeansClubAdminHash', adminCodeHash);
                    this.isAdmin = true;
                    return { success: true, message: "Admin account created successfully!" };
                }
                
                if (adminCodeHash === storedAdminHash) {
                    this.isAdmin = true;
                    return { success: true, message: "Admin login successful!" };
                }
                
                return { success: false, message: "Invalid admin code" };
            }

            hashPassword(password) {
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(36);
            }

            logout() {
                this.currentMember = null;
                this.isAdmin = false;
                localStorage.removeItem('jeansClubCurrentMember');
                return { success: true, message: "Logged out successfully!" };
            }

            async toggleNewsletter(email, subscribe = true) {
                try {
                    if (subscribe) {
                        await this.db.subscribeToNewsletter(email, this.currentMember?.name);
                        await this.emailService.sendNewsletterWelcomeEmail(email, this.currentMember?.name);
                    } else {
                        await this.db.unsubscribeFromNewsletter(email);
                    }
                    
                    if (this.currentMember) {
                        this.currentMember.newsletterSubscribed = subscribe;
                        await this.db.saveMember(this.currentMember);
                    }
                    
                    return { success: true, message: subscribe ? "Subscribed to newsletter!" : "Unsubscribed from newsletter!" };
                } catch (error) {
                    console.error('Newsletter toggle error:', error);
                    return { success: false, message: "Failed to update newsletter preferences" };
                }
            }

            async requestPasswordReset(jcId) {
                const member = await this.db.getMemberByJCId(jcId);
                
                if (!member) {
                    return { success: false, message: "JC ID not found" };
                }
                
                if (member.loginMethod === 'google') {
                    return { success: false, message: "Google accounts don't have passwords. Use Google Sign-In instead." };
                }
                
                const resetToken = this.generateResetToken();
                const resetTokenExpiry = new Date(Date.now() + 60 * 60 * 1000);
                
                member.resetToken = resetToken;
                member.resetTokenExpiry = resetTokenExpiry.toISOString();
                await this.db.saveMember(member);
                
                try {
                    await this.emailService.sendPasswordResetEmail(
                        member.email, 
                        member, 
                        {
                            resetToken: resetToken,
                            expiry: resetTokenExpiry.toLocaleString()
                        }
                    );
                    
                    return { 
                        success: true, 
                        message: "Password reset email sent! Check your inbox." 
                    };
                } catch (emailError) {
                    console.log('Reset email failed:', emailError);
                    return { 
                        success: true, 
                        message: "Reset code generated: " + resetToken + " (Email service unavailable)" 
                    };
                }
            }

            async executePasswordReset(jcId, resetToken, newPassword) {
                const member = await this.db.getMemberByJCId(jcId);
                
                if (!member) {
                    return { success: false, message: "JC ID not found" };
                }
                
                if (!member.resetToken || member.resetToken !== resetToken) {
                    return { success: false, message: "Invalid reset code" };
                }
                
                if (new Date() > new Date(member.resetTokenExpiry)) {
                    return { success: false, message: "Reset code has expired" };
                }
                
                member.password = newPassword;
                member.resetToken = null;
                member.resetTokenExpiry = null;
                
                member.activityLog.unshift({
                    type: 'password_reset',
                    description: 'Password reset successfully',
                    date: new Date().toISOString()
                });
                
                await this.db.saveMember(member);
                
                try {
                    await this.emailService.sendPasswordResetSuccessEmail(member.email, member);
                } catch (emailError) {
                    console.log('Confirmation email failed:', emailError);
                }
                
                return { success: true, message: "Password reset successful! You can now login with your new password." };
            }

            calculateDiscount(points) {
                if (points < 10) {
                    return { 
                        success: false, 
                        message: "Minimum 10 points required for discount" 
                    };
                }
                
                const tier = this.getTier(this.currentMember);
                const redemptionRate = jeansClubConfig.tierRedemptionRates[tier.name] || 0.0003;
                const maxDiscount = jeansClubConfig.tiers[tier.name].discountRate * 100;
                const discountPercentage = Math.min(points * redemptionRate * 100, maxDiscount);
                
                return {
                    success: true,
                    points: points,
                    discountPercentage: discountPercentage.toFixed(1),
                    maxPossible: maxDiscount + '%',
                    value: (points * jeansClubConfig.pointValue).toLocaleString() + ' UGX',
                    tierMultiplier: tier.multiplier
                };
            }

            async createDiscountVoucher(points) {
                const discountCalc = this.calculateDiscount(points);
                
                if (!discountCalc.success) {
                    return discountCalc;
                }
                
                if (this.currentMember.points < points) {
                    return { 
                        success: false, 
                        message: `Insufficient points. You have ${this.currentMember.points} points, but need ${points} points.` 
                    };
                }
                
                const currentTier = this.currentMember.tier;
                this.currentMember.points -= points;
                this.currentMember.tier = currentTier;
                
                this.currentMember.activityLog.unshift({
                    type: 'points_redeemed',
                    description: `Redeemed ${points} points for ${discountCalc.discountPercentage}% discount voucher`,
                    date: new Date().toISOString(),
                    points: -points
                });
                
                const voucher = voucherSystem.createVoucher(
                    this.currentMember.jcId,
                    this.currentMember.name,
                    points,
                    parseFloat(discountCalc.discountPercentage)
                );
                
                await this.db.saveMember(this.currentMember);
                
                try {
                    await this.emailService.sendDiscountEmail(
                        this.currentMember.email,
                        this.currentMember,
                        {
                            pointsUsed: points,
                            discountPercentage: discountCalc.discountPercentage,
                            voucher: voucher
                        }
                    );
                } catch (emailError) {
                    console.log('Voucher email failed:', emailError);
                }
                
                return {
                    success: true,
                    message: `Voucher created successfully! ${discountCalc.discountPercentage}% discount applied.`,
                    voucher: voucher
                };
            }

            async redeemVoucher(voucherCode, redeemedBy = 'staff') {
                const result = voucherSystem.redeemVoucher(voucherCode, redeemedBy);
                
                if (result.success) {
                    const member = await this.db.getMemberByJCId(result.voucher.memberJCId);
                    if (member) {
                        try {
                            await this.emailService.sendDiscountEmail(
                                member.email,
                                member,
                                {
                                    pointsUsed: result.voucher.pointsUsed,
                                    discountPercentage: result.voucher.discountPercentage,
                                    voucher: result.voucher
                                }
                            );
                        } catch (emailError) {
                            console.log('Redeem confirmation email failed:', emailError);
                        }
                    }
                }
                
                return result;
            }

            async addPurchase(jcId, amount, description) {
                const member = await this.db.getMemberByJCId(jcId);
                
                if (!member) {
                    return { success: false, message: "Member not found" };
                }
                
                const tier = this.getTier(member);
                const pointsEarned = Math.floor(amount * tier.multiplier * 0.01);
                
                const oldPoints = member.points || 0;
                member.points = oldPoints + pointsEarned;
                member.totalSpent = (member.totalSpent || 0) + amount;
                
                member.purchaseHistory = member.purchaseHistory || [];
                member.purchaseHistory.unshift({
                    amount: amount,
                    description: description,
                    date: new Date().toISOString(),
                    pointsEarned: pointsEarned
                });
                
                member.activityLog.unshift({
                    type: 'purchase',
                    description: `Purchase: ${description} - UGX ${amount.toLocaleString()}`,
                    date: new Date().toISOString(),
                    points: pointsEarned
                });
                
                const newTierInfo = this.getTier(member);
                const currentTier = member.tier;
                const newTier = newTierInfo.name;
                
                const tierOrder = ['PEARL', 'BRONZE', 'SILVER', 'RUBY', 'GOLD', 'SAPPHIRE', 'PLATINUM'];
                const currentIndex = tierOrder.indexOf(currentTier);
                const newIndex = tierOrder.indexOf(newTier);
                
                if (newIndex > currentIndex) {
                    member.tier = newTier;
                    member.activityLog.unshift({
                        type: 'tier_upgrade',
                        description: `Tier upgraded from ${currentTier} to ${newTier}`,
                        date: new Date().toISOString()
                    });
                }
                
                await this.db.saveMember(member);
                
                try {
                    await this.emailService.sendPurchaseEmail(
                        member.email,
                        member,
                        {
                            amount: amount,
                            description: description,
                            pointsEarned: pointsEarned
                        }
                    );
                } catch (emailError) {
                    console.log('Purchase email failed:', emailError);
                }
                
                return {
                    success: true,
                    message: `Purchase recorded! ${pointsEarned} points added.`,
                    member: member,
                    pointsEarned: pointsEarned
                };
            }

            async deleteMember(jcId) {
                const member = await this.db.getMemberByJCId(jcId);
                
                if (!member) {
                    return { success: false, message: "Member not found" };
                }
                
                const deleted = await this.db.deleteMember(jcId);
                
                if (deleted) {
                    await this.db.unsubscribeFromNewsletter(member.email);
                    return { success: true, message: "Member deleted successfully!" };
                }
                
                return { success: false, message: "Failed to delete member" };
            }

            getTier(member) {
                const points = member.points || 0;
                let currentTier = jeansClubConfig.tiers.PEARL;
                
                for (const [tierName, tierConfig] of Object.entries(jeansClubConfig.tiers)) {
                    if (points >= tierConfig.minPoints && points <= tierConfig.maxPoints) {
                        currentTier = { ...tierConfig, name: tierName };
                        break;
                    }
                }
                
                return currentTier;
            }

            updateMemberTier(member) {
                const points = member.points || 0;
                let newTier = 'PEARL';
                
                for (const [tierName, tierConfig] of Object.entries(jeansClubConfig.tiers)) {
                    if (points >= tierConfig.minPoints && points <= tierConfig.maxPoints) {
                        newTier = tierName;
                        break;
                    }
                }
                
                if (member.tier !== newTier) {
                    const oldTier = member.tier;
                    member.tier = newTier;
                    
                    member.activityLog.unshift({
                        type: 'tier_upgrade',
                        description: `Tier upgraded from ${oldTier} to ${newTier}`,
                        date: new Date().toISOString()
                    });
                }
                
                return member.tier;
            }

            getTierProgress(member) {
                const tier = this.getTier(member);
                const points = member.points || 0;
                
                const progress = Math.min(
                    ((points - tier.minPoints) / (tier.maxPoints - tier.minPoints)) * 100,
                    100
                );
                
                return {
                    currentTier: tier.name,
                    currentPoints: points,
                    minPoints: tier.minPoints,
                    maxPoints: tier.maxPoints,
                    nextTier: this.getNextTier(tier.name),
                    progress: progress,
                    pointsToNext: tier.maxPoints - points + 1
                };
            }

            getNextTier(currentTier) {
                const tierOrder = ['PEARL', 'BRONZE', 'SILVER', 'RUBY', 'GOLD', 'SAPPHIRE', 'PLATINUM'];
                const currentIndex = tierOrder.indexOf(currentTier);
                
                if (currentIndex < tierOrder.length - 1) {
                    return tierOrder[currentIndex + 1];
                }
                
                return null;
            }

            async sendNewsletter(subject, content) {
                try {
                    const subscribers = await this.db.getNewsletterSubscribers(true);
                    
                    if (subscribers.length === 0) {
                        return { success: false, message: "No active subscribers found" };
                    }
                    
                    let successCount = 0;
                    let failCount = 0;
                    
                    for (const subscriber of subscribers) {
                        try {
                            await this.emailService.sendNewsletterEmail(
                                subscriber.email,
                                subject,
                                content,
                                subscriber.name
                            );
                            successCount++;
                        } catch (error) {
                            console.error(`Failed to send to ${subscriber.email}:`, error);
                            failCount++;
                        }
                    }
                    
                    return {
                        success: true,
                        message: `Newsletter sent to ${successCount} subscribers. ${failCount} failed.`
                    };
                } catch (error) {
                    console.error('Newsletter sending error:', error);
                    return { success: false, message: "Failed to send newsletter: " + error.message };
                }
            }

            async createQRRedemption(purchaseAmount) {
                if (!this.currentMember) {
                    return { success: false, message: "You must be logged in to create a redemption" };
                }
                
                const options = qrRedemptionSystem.calculateRedemptionOptions(this.currentMember, purchaseAmount);
                
                if (options.length === 0) {
                    return { 
                        success: false, 
                        message: "No redemption options available for your tier and purchase amount." 
                    };
                }
                
                return {
                    success: true,
                    options: options,
                    member: this.currentMember,
                    purchaseAmount: purchaseAmount
                };
            }

            async generateQRCodeForRedemption(selectedOption, purchaseAmount) {
                if (!this.currentMember) {
                    return { success: false, message: "You must be logged in" };
                }
                
                const redemption = qrRedemptionSystem.createRedemption(
                    this.currentMember,
                    selectedOption,
                    purchaseAmount
                );
                
                if (selectedOption.type === 'points_redemption') {
                    this.currentMember.points -= selectedOption.pointsEquivalent;
                    
                    this.currentMember.activityLog.unshift({
                        type: 'points_redemption_qr',
                        description: `Created QR redemption for ${selectedOption.totalAmount.toLocaleString()} UGX`,
                        date: new Date().toISOString(),
                        points: -selectedOption.pointsEquivalent
                    });
                    
                    await this.db.saveMember(this.currentMember);
                }
                
                return {
                    success: true,
                    redemption: redemption,
                    qrCodeData: redemption.qrCodeData
                };
            }

            async refreshData() {
                if (this.currentMember) {
                    const updatedMember = await this.db.getMemberByJCId(this.currentMember.jcId);
                    if (updatedMember) {
                        this.currentMember = updatedMember;
                        this.saveCurrentMember();
                    }
                }
                return this.currentMember;
            }
        }

        // Google Apps Email Service (simplified for this example)
        class GoogleAppsEmailService {
            constructor() {
                this.scriptURL = 'https://script.google.com/macros/s/AKfycbwPycPrQFn5hux5eHrbAg1KIc8aO96HwrEI-KUZG7YmITm1ACyqIDQJcWGP5pqq9kun/exec';
                this.isActive = true;
            }

            async sendEmailToGoogleScript(email, type, memberData, extraData = null) {
                try {
                    return { success: true, message: "Email sent successfully" };
                } catch (error) {
                    console.error('Email sending failed:', error);
                    return { success: false, message: "Email service temporarily unavailable" };
                }
            }

            async sendWelcomeEmail(email, memberData) {
                return this.sendEmailToGoogleScript(email, 'welcome', memberData);
            }

            async sendPurchaseEmail(email, memberData, purchaseData) {
                return this.sendEmailToGoogleScript(email, 'purchase', memberData, purchaseData);
            }

            async sendDiscountEmail(email, memberData, discountData) {
                return this.sendEmailToGoogleScript(email, 'discount', memberData, discountData);
            }

            async sendReferralEmail(email, memberData, referralData) {
                return this.sendEmailToGoogleScript(email, 'referral', memberData, referralData);
            }

            async sendPasswordResetEmail(email, memberData, resetData) {
                return this.sendEmailToGoogleScript(email, 'password_reset', memberData, resetData);
            }

            async sendPasswordResetSuccessEmail(email, memberData) {
                return this.sendEmailToGoogleScript(email, 'password_reset_success', memberData);
            }

            async sendNewsletterWelcomeEmail(email, name = null) {
                return this.sendEmailToGoogleScript(email, 'newsletter_welcome', { name, email });
            }

            async sendNewsletterEmail(email, subject, content, name = null) {
                return this.sendEmailToGoogleScript(email, 'newsletter', { name, email }, { subject, message: content });
            }
        }

        // Initialize Google Sign-In
        function initializeGoogleSignIn() {
            if (typeof google === 'undefined') return;
            
            google.accounts.id.initialize({
                client_id: '607807821474-43243foqc9ml9eq3e0ugu04fnsigbqc5.apps.googleusercontent.com',
                callback: handleGoogleSignIn,
                auto_select: false,
                cancel_on_tap_outside: true
            });

            // Render buttons if containers exist
            const signinContainer = document.querySelector('.google-signin-button');
            const loginContainer = document.querySelector('.google-login-button');
            
            if (signinContainer) {
                google.accounts.id.renderButton(signinContainer, {
                    theme: "outline",
                    size: "large",
                    text: "signup_with",
                    shape: "rectangular"
                });
            }
            
            if (loginContainer) {
                google.accounts.id.renderButton(loginContainer, {
                    theme: "outline",
                    size: "large",
                    text: "signin_with",
                    shape: "rectangular"
                });
            }
        }

        // Handle Google Sign-In
        async function handleGoogleSignIn(response) {
            try {
                const result = await clubManager.loginWithGoogle(response);
                
                if (result.success) {
                    showMercedesDashboard();
                    showToast("Google login successful! üéâ", "success");
                } else {
                    showToast(result.message, "error");
                }
            } catch (error) {
                console.error('Google sign-in error:', error);
                showToast("Google sign-in failed. Please try again.", "error");
            }
        }

        // ========== MAIN FUNCTIONS ==========

        // Sign up with email
        async function signUpWithEmail() {
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const password = document.getElementById('userPassword').value;
            const referralCode = document.getElementById('referralCode').value.trim();
            const newsletter = document.getElementById('newsletterSignup').checked;

            if (!name || !email || !password) {
                showToast("Please fill in all required fields", "error");
                return;
            }

            if (!isValidEmail(email)) {
                showToast("Please enter a valid email address (e.g., name@domain.com)", "error");
                return;
            }

            const fakeEmails = ['test@test.com', 'example@example.com', 'user@user.com'];
            if (fakeEmails.includes(email.toLowerCase())) {
                showToast("Please use your real email address", "error");
                return;
            }

            if (password.length < 6) {
                showToast("Password must be at least 6 characters", "error");
                return;
            }

            showToast("Creating account...", "info");

            try {
                const result = await clubManager.createAccount(
                    { name, email, newsletter },
                    password,
                    referralCode
                );

                if (result.success) {
                    showMercedesDashboard();
                    showToast("Account created successfully! Welcome to Jeans Club! üéâ", "success");
                    
                    document.getElementById('userName').value = '';
                    document.getElementById('userEmail').value = '';
                    document.getElementById('userPassword').value = '';
                    document.getElementById('referralCode').value = '';
                    
                } else {
                    showToast(result.message, "error");
                }
            } catch (error) {
                console.error('Signup error:', error);
                showToast("An error occurred. Please try again.", "error");
            }
        }

        // Login with credentials
        async function loginWithCredentials() {
            const jcId = document.getElementById('loginJCId').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!jcId || !password) {
                showToast("Please enter JC ID and password", "error");
                return;
            }

            showToast("Logging in...", "info");

            const result = await clubManager.loginWithCredentials(jcId, password);

            if (result.success) {
                showMercedesDashboard();
                showToast("Login successful! üéâ", "success");
            } else {
                showToast(result.message, "error");
            }
        }

        // Mercedes Admin Login
        async function mercedesAdminLogin() {
            const password = document.getElementById('mercedesAdminPassword').value;
            const resultDiv = document.getElementById('mercedesAdminResult');
            
            if (!password) {
                resultDiv.innerHTML = '<span style="color: #dc3545;">Please enter staff password</span>';
                return;
            }
            
            const result = await clubManager.adminLogin(password);
            
            if (result.success) {
                showMercedesAdminPanel();
                showToast("Admin login successful! üëë", "success");
            } else {
                resultDiv.innerHTML = '<span style="color: #dc3545;">' + result.message + '</span>';
                showToast(result.message, "error");
            }
        }

        // Load admin members
        async function loadAdminMembers() {
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <div style="display: flex; gap: 1rem; margin-bottom: 3rem; flex-wrap: wrap;">
                        <button class="mercedes-button secondary" onclick="logout()" style="width: auto; padding: 1rem 2rem;">Logout</button>
                        <button class="mercedes-button secondary" onclick="showMercedesAdminPanel()" style="width: auto; padding: 1rem 2rem;">Refresh Members</button>
                        <button class="mercedes-button" onclick="showMercedesVoucherManagement()" style="width: auto; padding: 1rem 2rem;">Manage Vouchers</button>
                        <button class="mercedes-button" onclick="showMercedesQRRedemptionManagement()" style="width: auto; padding: 1rem 2rem;">QR Redemptions</button>
                    </div>
                    
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">Staff Admin Panel</h3>
                    
                    <!-- Add Purchase -->
                    <div class="info-card">
                        <h4>Add Purchase</h4>
                        <div class="form-group">
                            <label class="form-label" for="purchaseJCId">Member JC ID</label>
                            <input type="text" id="purchaseJCId" class="form-input" placeholder="Enter JC ID">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="purchaseAmount">Amount (UGX)</label>
                            <input type="number" id="purchaseAmount" class="form-input" placeholder="Enter amount">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="purchaseDescription">Description</label>
                            <input type="text" id="purchaseDescription" class="form-input" placeholder="Purchase description">
                        </div>
                        <button class="mercedes-button" onclick="adminAddPurchase()">Add Purchase</button>
                        <div id="purchaseResult" style="margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Voucher Scanning -->
                    <div class="info-card" style="border-left-color: #2196F3;">
                        <h4>Scan & Redeem Voucher</h4>
                        <div class="form-group">
                            <label class="form-label" for="voucherCodeInput">Voucher Code</label>
                            <input type="text" id="voucherCodeInput" class="form-input" placeholder="Enter voucher code or scan QR code">
                        </div>
                        <button class="mercedes-button" onclick="redeemVoucherByCode()">Redeem Voucher</button>
                        <div id="voucherRedeemResult" style="margin-top: 10px;"></div>
                    </div>
                    
                    <!-- Send Newsletter -->
                    <div class="info-card">
                        <h4>Send Newsletter</h4>
                        <div class="form-group">
                            <label class="form-label" for="newsletterSubject">Subject</label>
                            <input type="text" id="newsletterSubject" class="form-input" placeholder="Enter newsletter subject">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="newsletterContent">Content</label>
                            <textarea id="newsletterContent" class="form-input" placeholder="Enter newsletter content" rows="6" style="height: auto; min-height: 150px;"></textarea>
                        </div>
                        <button class="mercedes-button" onclick="sendNewsletter()">Send Newsletter to All Subscribers</button>
                        <div id="newsletterResult" style="margin-top: 10px;"></div>
                    </div>
                    
                    <!-- All Members -->
                    <div class="info-card">
                        <h4>All Members</h4>
                        <div id="adminMembersList" style="margin-top: 1rem;">
                            Loading members...
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('admin-content').innerHTML = content;
            
            // Load members
            setTimeout(async () => {
                await loadAdminMembersList();
            }, 100);
        }

        // Load admin members list
        async function loadAdminMembersList() {
            const container = document.getElementById('adminMembersList');
            if (!container) return;
            
            try {
                const members = await clubManager.db.getAllMembers();
                
                if (members.length === 0) {
                    container.innerHTML = '<p style="color: #666;">No members yet</p>';
                    return;
                }
                
                container.innerHTML = members.map(member => `
                    <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #667eea;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h5 style="margin: 0 0 0.5rem; font-size: 1.6rem;">${member.name} <small style="color: #666;">(${member.jcId})</small></h5>
                                <p style="margin: 0 0 0.5rem; color: #666; font-size: 1.4rem;">${member.email}</p>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <span style="background: #f0f0f0; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 1.2rem;">${member.tier}</span>
                                    <span style="background: #e7f3ff; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 1.2rem;">${member.points?.toLocaleString() || 0} points</span>
                                </div>
                            </div>
                            <button class="mercedes-button secondary" onclick="promptDeleteMember('${member.jcId}')" style="width: auto; padding: 0.5rem 1rem; font-size: 1.2rem;">
                                Delete
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 1rem;">
                            <div>
                                <small style="color: #666;">Total Spent:</small>
                                <p style="margin: 0.2rem 0; font-weight: bold;">${(member.totalSpent || 0).toLocaleString()} UGX</p>
                            </div>
                            <div>
                                <small style="color: #666;">Joined:</small>
                                <p style="margin: 0.2rem 0;">${new Date(member.joinedDate).toLocaleDateString()}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading admin members:', error);
                container.innerHTML = '<p style="color: #dc3545;">Error loading members</p>';
            }
        }

        // Show Mercedes Voucher Management
        function showMercedesVoucherManagement() {
            hideAllMercedesSections();
            document.getElementById('admin').style.display = 'block';
            
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <div style="margin-bottom: 2rem;">
                        <button class="mercedes-button secondary" onclick="showMercedesAdminPanel()" style="width: auto; padding: 1rem 2rem;">‚Üê Back to Admin</button>
                    </div>
                    
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">Voucher Management</h3>
                    
                    <div class="info-card">
                        <h4>All Vouchers</h4>
                        <div id="allVouchersList" class="activity-log" style="margin-top: 1rem;">
                            Loading vouchers...
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h4>Voucher Statistics</h4>
                        <div id="voucherStats" style="margin-top: 1rem;">
                            Loading voucher statistics...
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('admin-content').innerHTML = content;
            
            // Load vouchers
            setTimeout(() => {
                loadAllVouchers();
            }, 100);
        }

        // Show Mercedes QR Redemption Management
        function showMercedesQRRedemptionManagement() {
            hideAllMercedesSections();
            document.getElementById('admin').style.display = 'block';
            
            const content = `
                <div class="mercedes-form-content fade-in-section">
                    <div style="margin-bottom: 2rem;">
                        <button class="mercedes-button secondary" onclick="showMercedesAdminPanel()" style="width: auto; padding: 1rem 2rem;">‚Üê Back to Admin</button>
                    </div>
                    
                    <h3 class="section-title" style="font-size: 2.4rem; margin-bottom: 3rem;">QR Redemption Management</h3>
                    
                    <div class="info-card">
                        <h4>Redemption Statistics</h4>
                        <div id="qrRedemptionStats" style="margin-top: 1rem;">
                            Loading statistics...
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h4>All Redemptions</h4>
                        <div id="allRedemptionsList" class="activity-log" style="margin-top: 1rem;">
                            Loading redemptions...
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('admin-content').innerHTML = content;
            
            // Load QR redemption data
            setTimeout(() => {
                loadQRRedemptionData();
            }, 100);
        }

        // ========== HELPER FUNCTIONS ==========

        // Request password reset
        async function requestPasswordReset() {
            const jcId = document.getElementById('resetJCId').value.trim();
            
            if (!jcId) {
                showToast("Please enter your JC ID", "error");
                return;
            }
            
            showToast("Sending reset code...", "info");
            
            const result = await clubManager.requestPasswordReset(jcId);
            
            const resetRequestResult = document.getElementById('resetRequestResult');
            if (result.success) {
                resetRequestResult.innerHTML = `<span style="color: #28a745;">${result.message}</span>`;
                document.getElementById('resetForm').classList.remove('hidden');
            } else {
                resetRequestResult.innerHTML = `<span style="color: #dc3545;">${result.message}</span>`;
            }
        }

        // Execute password reset
        async function executePasswordReset() {
            const jcId = document.getElementById('resetJCId').value.trim();
            const resetToken = document.getElementById('resetToken').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!jcId || !resetToken || !newPassword || !confirmPassword) {
                showToast("Please fill in all fields", "error");
                return;
            }
            
            if (newPassword.length < 6) {
                showToast("Password must be at least 6 characters", "error");
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast("Passwords do not match", "error");
                return;
            }
            
            showToast("Resetting password...", "info");
            
            const result = await clubManager.executePasswordReset(jcId, resetToken, newPassword);
            
            const resetExecuteResult = document.getElementById('resetExecuteResult');
            if (result.success) {
                resetExecuteResult.innerHTML = `<span style="color: #28a745;">${result.message}</span>`;
                
                setTimeout(() => {
                    document.getElementById('resetForm').classList.add('hidden');
                    resetExecuteResult.innerHTML = '';
                    showMercedesLogin();
                }, 3000);
            } else {
                resetExecuteResult.innerHTML = `<span style="color: #dc3545;">${result.message}</span>`;
            }
        }

        // Calculate discount
        async function calculateDiscount() {
            const pointsInput = document.getElementById('discountPoints');
            const points = parseInt(pointsInput.value);
            
            if (!points || points < 10) {
                showToast("Please enter at least 10 points", "error");
                return;
            }
            
            const result = clubManager.calculateDiscount(points);
            
            const discountResult = document.getElementById('discountResult');
            if (result.success) {
                discountResult.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 1.5rem; border-radius: 8px; border: 1px solid #c3e6cb;">
                        <h5 style="margin: 0 0 1rem; font-size: 1.6rem;">Discount Calculation</h5>
                        <p style="margin: 0.5rem 0;"><strong>Points to use:</strong> ${points} points</p>
                        <p style="margin: 0.5rem 0;"><strong>Discount:</strong> ${result.discountPercentage}% off</p>
                        <p style="margin: 0.5rem 0;"><strong>Value:</strong> ${result.value}</p>
                        <p style="margin: 0.5rem 0;"><strong>Tier Multiplier:</strong> ${result.tierMultiplier}x</p>
                        <p style="margin: 1rem 0 0; font-size: 1.2rem; color: #666;">Minimum 10 points required, maximum 50% discount</p>
                    </div>
                `;
            } else {
                discountResult.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1.5rem; border-radius: 8px; border: 1px solid #f5c6cb;">
                        ${result.message}
                    </div>
                `;
            }
        }

        // Redeem points for voucher
        async function redeemPoints() {
            const pointsInput = document.getElementById('discountPoints');
            const points = parseInt(pointsInput.value);
            
            if (!points || points < 10) {
                showToast("Please enter at least 10 points", "error");
                return;
            }
            
            showToast("Creating discount voucher...", "info");
            
            const result = await clubManager.createDiscountVoucher(points);
            
            if (result.success) {
                showToast("Voucher created successfully! Check your email for details.", "success");
                updateMercedesDashboard(clubManager.currentMember);
                
                const discountResult = document.getElementById('discountResult');
                discountResult.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 1.5rem; border-radius: 8px; border: 1px solid #c3e6cb;">
                        <h5 style="margin: 0 0 1rem; font-size: 1.6rem;">üéâ Voucher Created!</h5>
                        <p style="margin: 0.5rem 0;"><strong>Voucher Code:</strong> <span style="font-family: 'Courier New', monospace; background: #e9ecef; padding: 0.3rem 0.6rem; border-radius: 4px;">${result.voucher.code}</span></p>
                        <p style="margin: 0.5rem 0;"><strong>Discount:</strong> ${result.voucher.discountPercentage}% off</p>
                        <p style="margin: 0.5rem 0;"><strong>Points Used:</strong> ${points} points</p>
                        <p style="margin: 0.5rem 0;"><strong>Expires:</strong> ${new Date(result.voucher.expiryDate).toLocaleDateString()}</p>
                        <p style="margin: 1rem 0 0; font-size: 1.2rem; color: #666;">Check your email for QR code and details</p>
                    </div>
                `;
                
                pointsInput.value = '';
            } else {
                showToast(result.message, "error");
            }
        }

        // Toggle newsletter subscription
        async function toggleNewsletter() {
            if (!clubManager.currentMember) return;
            
            const currentlySubscribed = clubManager.currentMember.newsletterSubscribed !== false;
            const action = currentlySubscribed ? false : true;
            
            showToast("Updating newsletter preferences...", "info");
            
            const result = await clubManager.toggleNewsletter(
                clubManager.currentMember.email,
                action
            );
            
            if (result.success) {
                showToast(result.message, "success");
                updateMercedesDashboard(clubManager.currentMember);
            } else {
                showToast(result.message, "error");
            }
        }

        // Share referral code
        function shareReferral() {
            if (!clubManager.currentMember) return;
            
            const referralCode = clubManager.currentMember.referralCode;
            const message = `Join me on Jeans Club! Use my referral code ${referralCode} to get bonus points when you sign up. Sign up at https://elijah787.github.io/jeans-club`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Join Jeans Club',
                    text: message,
                    url: 'https://elijah787.github.io/jeans-club'
                });
            } else {
                navigator.clipboard.writeText(message);
                showToast("Referral code copied to clipboard! üìã", "success");
            }
        }

        // Logout
        function logout() {
            clubManager.logout();
            showMercedesLogin();
            showToast("Logged out successfully", "info");
        }

        // Refresh data
        async function refreshData() {
            showToast("Refreshing data...", "info");
            const updatedMember = await clubManager.refreshData();
            if (updatedMember) {
                updateMercedesDashboard(updatedMember);
                showToast("Data refreshed!", "success");
            } else {
                showToast("Failed to refresh data", "error");
            }
        }

        // Admin: Add purchase
        async function adminAddPurchase() {
            const jcId = document.getElementById('purchaseJCId').value.trim();
            const amount = parseFloat(document.getElementById('purchaseAmount').value);
            const description = document.getElementById('purchaseDescription').value.trim();
            
            if (!jcId || !amount || !description) {
                showToast("Please fill in all fields", "error");
                return;
            }
            
            if (amount <= 0) {
                showToast("Amount must be positive", "error");
                return;
            }
            
            showToast("Recording purchase...", "info");
            
            const result = await clubManager.addPurchase(jcId, amount, description);
            
            const purchaseResult = document.getElementById('purchaseResult');
            if (result.success) {
                purchaseResult.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 8px; border: 1px solid #c3e6cb;">
                        <strong>Success!</strong> ${result.message}<br>
                        <small>Member: ${result.member.name} (${result.member.jcId})</small>
                    </div>
                `;
                
                document.getElementById('purchaseJCId').value = '';
                document.getElementById('purchaseAmount').value = '';
                document.getElementById('purchaseDescription').value = '';
                
                loadAdminMembersList();
            } else {
                purchaseResult.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px; border: 1px solid #f5c6cb;">
                        ${result.message}
                    </div>
                `;
            }
        }

        // Admin: Send newsletter
        async function sendNewsletter() {
            const subject = document.getElementById('newsletterSubject').value.trim();
            const content = document.getElementById('newsletterContent').value.trim();
            
            if (!subject || !content) {
                showToast("Please fill in subject and content", "error");
                return;
            }
            
            if (!confirm(`Send newsletter to all subscribers? This will send to everyone subscribed to the newsletter.`)) {
                return;
            }
            
            showToast("Sending newsletter... This may take a moment.", "info");
            
            const result = await clubManager.sendNewsletter(subject, content);
            
            const newsletterResult = document.getElementById('newsletterResult');
            if (result.success) {
                newsletterResult.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 8px; border: 1px solid #c3e6cb;">
                        ${result.message}
                    </div>
                `;
                
                document.getElementById('newsletterSubject').value = '';
                document.getElementById('newsletterContent').value = '';
            } else {
                newsletterResult.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px; border: 1px solid #f5c6cb;">
                        ${result.message}
                    </div>
                `;
            }
        }

        // Prompt delete member
        function promptDeleteMember(jcId) {
            if (!confirm(`Are you absolutely sure you want to delete member ${jcId}? This action cannot be undone!`)) {
                return;
            }
            
            deleteMember(jcId);
        }

        // Delete member
        async function deleteMember(jcId) {
            showToast("Deleting member...", "info");
            
            const result = await clubManager.deleteMember(jcId);
            
            if (result.success) {
                showToast("Member deleted successfully!", "success");
                loadAdminMembersList();
            } else {
                showToast(result.message, "error");
            }
        }

        // Admin: Redeem voucher by code
        async function redeemVoucherByCode() {
            const voucherCode = document.getElementById('voucherCodeInput').value.trim();
            
            if (!voucherCode) {
                showToast("Please enter voucher code", "error");
                return;
            }
            
            showToast("Redeeming voucher...", "info");
            
            const result = await clubManager.redeemVoucher(voucherCode, 'staff');
            
            const voucherRedeemResult = document.getElementById('voucherRedeemResult');
            if (result.success) {
                voucherRedeemResult.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 8px; border: 1px solid #c3e6cb;">
                        <strong>Success!</strong> ${result.message}<br>
                        <small>Voucher: ${result.voucher.code} - ${result.voucher.discountPercentage}% discount</small>
                    </div>
                `;
                
                document.getElementById('voucherCodeInput').value = '';
                
                loadAllVouchers();
            } else {
                voucherRedeemResult.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px; border: 1px solid #f5c6cb;">
                        ${result.message}
                    </div>
                `;
            }
        }

        // Load all vouchers
        async function loadAllVouchers() {
            const allVouchersList = document.getElementById('allVouchersList');
            const voucherStats = document.getElementById('voucherStats');
            
            if (!allVouchersList || !voucherStats) return;
            
            allVouchersList.innerHTML = '<div class="activity-item">Loading vouchers...</div>';
            
            const stats = voucherSystem.getVoucherStats();
            voucherStats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px;">
                        <div style="font-size: 2.4rem; font-weight: bold;">${stats.total}</div>
                        <div style="font-size: 1.2rem; color: #666;">Total</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px;">
                        <div style="font-size: 2.4rem; font-weight: bold; color: #28a745;">${stats.active}</div>
                        <div style="font-size: 1.2rem; color: #666;">Active</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px;">
                        <div style="font-size: 2.4rem; font-weight: bold; color: #6c757d;">${stats.used}</div>
                        <div style="font-size: 1.2rem; color: #666;">Used</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px;">
                        <div style="font-size: 2.4rem; font-weight: bold; color: #dc3545;">${stats.expired}</div>
                        <div style="font-size: 1.2rem; color: #666;">Expired</div>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <p><strong>Redemption Rate:</strong> ${stats.redemptionRate}</p>
                    <p><strong>Average Discount:</strong> ${stats.avgDiscount}%</p>
                </div>
            `;
            
            const vouchers = voucherSystem.getAllVouchers();
            
            if (vouchers.length === 0) {
                allVouchersList.innerHTML = '<div class="activity-item">No vouchers yet</div>';
                return;
            }
            
            allVouchersList.innerHTML = vouchers.map(voucher => {
                const statusClass = voucher.status === 'active' ? 'status-active' : 
                                  voucher.status === 'used' ? 'status-used' : 'status-expired';
                const statusText = voucher.status === 'active' ? 'ACTIVE' :
                                 voucher.status === 'used' ? 'USED' : 'EXPIRED';
                
                return `
                    <div class="voucher-item ${voucher.status}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h5 style="margin: 0; font-size: 1.6rem;">${voucher.memberName} (${voucher.memberJCId})</h5>
                            <span class="voucher-status ${statusClass}">${statusText}</span>
                        </div>
                        <p><strong>Voucher:</strong> <span class="voucher-code">${voucher.code}</span></p>
                        <p><strong>Discount:</strong> ${voucher.discountPercentage}%</p>
                        <p><strong>Points Used:</strong> ${voucher.pointsUsed}</p>
                        <p><strong>Created:</strong> ${new Date(voucher.createdDate).toLocaleDateString()}</p>
                        <p><strong>Expires:</strong> ${new Date(voucher.expiryDate).toLocaleDateString()}</p>
                        ${voucher.usedDate ? `
                            <p><strong>Redeemed:</strong> ${new Date(voucher.usedDate).toLocaleDateString()}</p>
                            <p><strong>Redeemed By:</strong> ${voucher.redeemedBy || 'system'}</p>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Load QR redemption data
        function loadQRRedemptionData() {
            const qrRedemptionStats = document.getElementById('qrRedemptionStats');
            const allRedemptionsList = document.getElementById('allRedemptionsList');
            
            if (!qrRedemptionStats || !allRedemptionsList) return;
            
            const stats = qrRedemptionSystem.getRedemptionStats();
            qrRedemptionStats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px;">
                        <div style="font-size: 2.4rem; font-weight: bold;">${stats.total}</div>
                        <div style="font-size: 1.2rem; color: #666;">Total</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px;">
                        <div style="font-size: 2.4rem; font-weight: bold; color: #ffc107;">${stats.pending}</div>
                        <div style="font-size: 1.2rem; color: #666;">Pending</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px;">
                        <div style="font-size: 2.4rem; font-weight: bold; color: #28a745;">${stats.completed}</div>
                        <div style="font-size: 1.2rem; color: #666;">Completed</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 8px;">
                        <div style="font-size: 2.4rem; font-weight: bold; color: #dc3545;">${stats.expired}</div>
                        <div style="font-size: 1.2rem; color: #666;">Expired</div>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <p><strong>Completion Rate:</strong> ${stats.completionRate}</p>
                    <p><strong>Total Value Redeemed:</strong> ${stats.totalValue.toLocaleString()} UGX</p>
                </div>
            `;
            
            const allRedemptions = qrRedemptionSystem.getAllRedemptions();
            
            if (allRedemptions.length === 0) {
                allRedemptionsList.innerHTML = '<div class="activity-item">No redemptions yet</div>';
                return;
            }
            
            allRedemptionsList.innerHTML = allRedemptions.map(redemption => {
                const statusClass = redemption.status === 'completed' ? 'status-active' : 
                                  redemption.status === 'expired' ? 'status-expired' : 'status-used';
                const statusText = redemption.status === 'completed' ? 'COMPLETED' :
                                 redemption.status === 'expired' ? 'EXPIRED' : 'PENDING';
                
                return `
                    <div class="redemption-item" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h5 style="margin: 0; font-size: 1.6rem;">${redemption.memberName} (${redemption.memberJCId})</h5>
                            <span class="redemption-status ${statusClass}" style="display: inline-block; padding: 0.3rem 0.8rem; border-radius: 12px; font-size: 1.2rem; font-weight: bold;">${statusText}</span>
                        </div>
                        <p><strong>Redemption ID:</strong> <span style="font-family: 'Courier New', monospace; background: #e9ecef; padding: 0.3rem 0.6rem; border-radius: 4px;">${redemption.redemptionId}</span></p>
                        <p><strong>Purchase Amount:</strong> ${redemption.purchaseAmount.toLocaleString()} UGX</p>
                        <p><strong>Option:</strong> ${redemption.selectedOption.description}</p>
                        <p><strong>Created:</strong> ${new Date(redemption.createdDate).toLocaleString()}</p>
                        ${redemption.redeemedDate ? `
                            <p><strong>Redeemed:</strong> ${new Date(redemption.redeemedDate).toLocaleString()}</p>
                            <p><strong>Redeemed By:</strong> ${redemption.redeemedBy}</p>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Calculate redemption options
        async function calculateRedemptionOptions() {
            const purchaseAmount = parseFloat(document.getElementById('qrPurchaseAmount').value);
            
            if (!purchaseAmount || purchaseAmount <= 0) {
                showToast("Please enter a valid purchase amount", "error");
                return;
            }
            
            currentPurchaseAmount = purchaseAmount;
            
            if (!clubManager.currentMember) {
                showToast("You must be logged in", "error");
                return;
            }
            
            showToast("Calculating redemption options...", "info");
            
            currentRedemptionOptions = qrRedemptionSystem.calculateRedemptionOptions(
                clubManager.currentMember, 
                purchaseAmount
            );
            
            if (!currentRedemptionOptions || currentRedemptionOptions.length === 0) {
                const redemptionOptions = document.getElementById('redemptionOptions');
                redemptionOptions.innerHTML = `
                    <div class="info-card">
                        <p>No redemption options available for your purchase amount and tier.</p>
                        <p><small>Pearl members only have discount voucher options. Higher tiers have pay-with-points options.</small></p>
                        <p><small>You may need to:</small></p>
                        <ul>
                            <li>Have at least 10 points for discount vouchers</li>
                            <li>Meet spending thresholds for pay-with-points (higher tiers)</li>
                            <li>Earn more points through purchases</li>
                        </ul>
                    </div>
                `;
                selectedOptionIndex = -1;
                return;
            }
            
            const redemptionOptions = document.getElementById('redemptionOptions');
            redemptionOptions.innerHTML = currentRedemptionOptions.map((option, index) => {
                let optionHTML = '';
                
                if (option.type === 'points_redemption') {
                    optionHTML = `
                        <div class="redemption-option" onclick="selectRedemptionOption(${index})">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h5 style="margin: 0; font-size: 1.6rem;">üí∞ Pay with Points</h5>
                                <span style="background: #f0f0f0; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 1.2rem;">${option.tier}</span>
                            </div>
                            <p><strong>Available:</strong> ${option.maxRedemption.toLocaleString()} UGX</p>
                            <p><strong>Points Equivalent:</strong> ${option.pointsEquivalent.toLocaleString()} points</p>
                            <p><strong>Description:</strong> ${option.description}</p>
                            <p><strong>Value:</strong> ${option.pointsValue} points multiplier</p>
                            <p><small>Uses your accumulated points for purchase credit</small></p>
                        </div>
                    `;
                } else if (option.type === 'discount_voucher') {
                    optionHTML = `
                        <div class="redemption-option" onclick="selectRedemptionOption(${index})">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h5 style="margin: 0; font-size: 1.6rem;">üé´ Discount Voucher</h5>
                                <span style="background: #f0f0f0; padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 1.2rem;">${option.tier}</span>
                            </div>
                            <p><strong>Discount Amount:</strong> ${option.discountAmount.toLocaleString()} UGX</p>
                            <p><strong>Discount Percentage:</strong> ${option.discountPercentage}%</p>
                            <p><strong>Applicable Amount:</strong> ${option.applicableAmount.toLocaleString()} UGX</p>
                            <p><strong>Points Required:</strong> ${option.pointsRequired.toLocaleString()} points</p>
                            <p><small>Get a fixed discount voucher for future use</small></p>
                        </div>
                    `;
                }
                
                return optionHTML;
            }).join('');
            
            selectedOptionIndex = -1;
            showToast(`${currentRedemptionOptions.length} redemption options available`, "success");
        }

        // Select redemption option
        function selectRedemptionOption(index) {
            selectedOptionIndex = index;
            
            currentPurchaseAmount = parseFloat(document.getElementById('qrPurchaseAmount').value);
            
            if (!currentPurchaseAmount || currentPurchaseAmount <= 0) {
                showToast("Please enter a valid purchase amount first", "error");
                return;
            }
            
            currentRedemptionOptions = qrRedemptionSystem.calculateRedemptionOptions(
                clubManager.currentMember, 
                currentPurchaseAmount
            );
            
            if (!currentRedemptionOptions || currentRedemptionOptions.length === 0) {
                showToast("No redemption options available", "error");
                return;
            }
            
            if (index < 0 || index >= currentRedemptionOptions.length) {
                showToast("Invalid option selected", "error");
                return;
            }
            
            document.querySelectorAll('.redemption-option').forEach(el => {
                el.classList.remove('selected');
            });
            
            const allOptions = document.querySelectorAll('.redemption-option');
            if (allOptions[index]) {
                allOptions[index].classList.add('selected');
            }
            
            const selectedOption = currentRedemptionOptions[index];
            const selectedOptionDetails = document.getElementById('selectedOptionDetails');
            
            let detailsHTML = '';
            if (selectedOption.type === 'points_redemption') {
                detailsHTML = `
                    <div class="selected-option-details" style="background: #e7f3ff; padding: 2rem; border-radius: 8px; margin: 2rem 0; border-left: 4px solid #2196F3;">
                        <h5 style="font-size: 1.8rem; margin: 0 0 1rem;">üí∞ Pay with Points Selected</h5>
                        <p><strong>Tier:</strong> ${selectedOption.tier}</p>
                        <p><strong>Maximum Redemption:</strong> ${selectedOption.maxRedemption.toLocaleString()} UGX</p>
                        <p><strong>Points Required:</strong> ${selectedOption.pointsEquivalent.toLocaleString()} points</p>
                        <p><strong>Description:</strong> ${selectedOption.description}</p>
                        <p><strong>Your Points Balance:</strong> ${clubManager.currentMember.points.toLocaleString()} points</p>
                        <p><strong>Points After Redemption:</strong> ${(clubManager.currentMember.points - selectedOption.pointsEquivalent).toLocaleString()} points</p>
                        <button class="mercedes-button" onclick="generateQRCode()" style="margin-top: 1.5rem;">
                            Generate QR Code
                        </button>
                    </div>
                `;
            } else if (selectedOption.type === 'discount_voucher') {
                detailsHTML = `
                    <div class="selected-option-details" style="background: #e7f3ff; padding: 2rem; border-radius: 8px; margin: 2rem 0; border-left: 4px solid #2196F3;">
                        <h5 style="font-size: 1.8rem; margin: 0 0 1rem;">üé´ Discount Voucher Selected</h5>
                        <p><strong>Discount Amount:</strong> ${selectedOption.discountAmount.toLocaleString()} UGX</p>
                        <p><strong>Discount Percentage:</strong> ${selectedOption.discountPercentage}%</p>
                        <p><strong>Applicable Purchase:</strong> ${selectedOption.applicableAmount.toLocaleString()} UGX</p>
                        <p><strong>Points Required:</strong> ${selectedOption.pointsRequired.toLocaleString()} points</p>
                        <p><strong>Your Points Balance:</strong> ${clubManager.currentMember.points.toLocaleString()} points</p>
                        <p><strong>Points After Redemption:</strong> ${(clubManager.currentMember.points - selectedOption.pointsRequired).toLocaleString()} points</p>
                        <button class="mercedes-button" onclick="generateQRCode()" style="margin-top: 1.5rem;">
                            Generate QR Code
                        </button>
                    </div>
                `;
            }
            
            selectedOptionDetails.innerHTML = detailsHTML;
        }

        // Generate QR code
        async function generateQRCode() {
            try {
                if (selectedOptionIndex === -1) {
                    showToast("Please select a redemption option first", "error");
                    return { success: false, message: "No option selected" };
                }
                
                if (!clubManager.currentMember) {
                    showToast("You must be logged in", "error");
                    return { success: false, message: "Not logged in" };
                }
                
                const selectedOption = currentRedemptionOptions[selectedOptionIndex];
                const purchaseAmount = currentPurchaseAmount;
                
                const memberPoints = clubManager.currentMember.points || 0;
                let pointsNeeded = 0;
                
                if (selectedOption.type === 'points_redemption') {
                    pointsNeeded = selectedOption.pointsEquivalent || 0;
                } else if (selectedOption.type === 'discount_voucher') {
                    pointsNeeded = selectedOption.pointsRequired || 0;
                }
                
                if (memberPoints < pointsNeeded) {
                    const errorMsg = `‚ùå Insufficient points! You have ${memberPoints.toLocaleString()} points, but need ${pointsNeeded.toLocaleString()} points for this redemption.`;
                    showToast(errorMsg, "error");
                    
                    selectedOptionIndex = -1;
                    document.querySelectorAll('.redemption-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                    document.getElementById('selectedOptionDetails').innerHTML = `
                        <div class="info-card">
                            <p style="color: #dc3545;">${errorMsg}</p>
                            <p>Please select a different option or add more points to your account.</p>
                        </div>
                    `;
                    
                    return { success: false, message: errorMsg };
                }
                
                showToast("Generating QR code...", "info");
                
                const redemption = qrRedemptionSystem.createRedemption(
                    clubManager.currentMember,
                    selectedOption,
                    purchaseAmount
                );
                
                if (!redemption) {
                    showToast("Failed to create redemption", "error");
                    return { success: false, message: "Redemption creation failed" };
                }
                
                const oldPoints = clubManager.currentMember.points;
                const currentTier = clubManager.currentMember.tier;
                
                clubManager.currentMember.points -= pointsNeeded;
                clubManager.currentMember.tier = currentTier;
                
                clubManager.currentMember.activityLog.unshift({
                    type: 'points_redemption_qr',
                    description: `QR redemption: ${selectedOption.description}`,
                    date: new Date().toISOString(),
                    points: -pointsNeeded
                });
                
                const saved = await clubManager.db.saveMember(clubManager.currentMember);
                if (!saved) {
                    clubManager.currentMember.points = oldPoints;
                    showToast("Failed to save points deduction", "error");
                    return { success: false, message: "Database save failed" };
                }
                
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(redemption.qrCodeData)}`;
                
                const qrCodeContainer = document.getElementById('qrCodeContainer');
                qrCodeContainer.innerHTML = `
                    <div class="qr-code-container" style="text-align: center; padding: 2rem; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h5 style="font-size: 1.8rem; margin: 0 0 1.5rem;">üéâ Redemption QR Code</h5>
                        <img src="${qrCodeUrl}" alt="Redemption QR Code" style="max-width: 250px; margin: 1.5rem 0; border: 2px solid #ddd; border-radius: 10px; padding: 10px;">
                        <p><strong>Redemption ID:</strong> ${redemption.redemptionId}</p>
                        <p><strong>Amount:</strong> ${purchaseAmount.toLocaleString()} UGX</p>
                        <p><strong>Option:</strong> ${selectedOption.description}</p>
                        <p><strong>Points Deducted:</strong> ${pointsNeeded.toLocaleString()}</p>
                        <p><strong>Remaining Points:</strong> ${clubManager.currentMember.points.toLocaleString()}</p>
                        <p><strong>Your Tier:</strong> ${currentTier} (unchanged)</p>
                        <p style="font-size: 1.2rem; color: #666; margin-top: 1.5rem;">
                            Show this QR code to our staff at checkout. It's valid for 24 hours.
                        </p>
                    </div>
                `;
                
                showToast("QR code generated successfully! Show this to staff.", "success");
                
                document.getElementById('qrRedemptionResult').innerHTML = `
                    <div class="success-card" style="background: #d4edda; color: #155724; padding: 2rem; border-radius: 8px; margin: 2rem 0; border: 1px solid #c3e6cb;">
                        <h5 style="font-size: 1.8rem; margin: 0 0 1rem;">‚úÖ QR Redemption Created!</h5>
                        <p>Your QR code has been generated successfully. Show it to our staff at checkout.</p>
                        <p><strong>Redemption ID:</strong> ${redemption.redemptionId}</p>
                        <p><strong>Status:</strong> Pending redemption</p>
                        <p><strong>Points Deducted:</strong> ${pointsNeeded.toLocaleString()}</p>
                        <p><strong>Remaining Points:</strong> ${clubManager.currentMember.points.toLocaleString()}</p>
                        <p><strong>Your Tier:</strong> ${currentTier} (no downgrade)</p>
                        <button class="mercedes-button" onclick="showMercedesDashboard()" style="margin-top: 1rem;">
                            Back to Dashboard
                        </button>
                    </div>
                `;
                
                selectedOptionIndex = -1;
                document.querySelectorAll('.redemption-option').forEach(el => {
                    el.classList.remove('selected');
                });
                document.getElementById('selectedOptionDetails').innerHTML = `
                    <div class="info-card">
                        <p>Please calculate new options for another redemption.</p>
                    </div>
                `;
                
                return { success: true, redemption: redemption };
                
            } catch (error) {
                console.error("Error generating QR code:", error);
                showToast("Error generating QR code: " + error.message, "error");
                return { success: false, message: error.message };
            }
        }

        // Toast notification system
        function showToast(message, type = "info") {
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
                word-wrap: break-word;
            `;
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Add CSS for toast animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Export for debugging
        window.clubManager = clubManager;
        window.voucherSystem = voucherSystem;
        window.qrRedemptionSystem = qrRedemptionSystem;
    </script>
</body>
</html>