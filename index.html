<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeans Club - Raised on Denim</title>
    <style>
        /* All your existing CSS remains the same */
        /* MERCEDES-BENZ INSPIRED HEADER & NAVIGATION */
        .mercedes-header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            position: relative;
            z-index: 1000;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .brand-logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #ffffff;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .logo-jeans {
            color: #00AFF0;
        }

        .logo-club {
            color: #ffffff;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .search-icon, .user-icon, .menu-toggle {
            cursor: pointer;
            font-size: 20px;
            transition: color 0.3s;
        }

        .search-icon:hover, .user-icon:hover, .menu-toggle:hover {
            color: #00AFF0;
        }

        /* Search Modal */
        .search-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: flex-start;
            padding-top: 100px;
        }

        .search-modal.active {
            display: flex;
        }

        .search-container {
            width: 90%;
            max-width: 600px;
        }

        .search-input {
            width: 100%;
            padding: 20px;
            font-size: 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid #00AFF0;
            color: white;
            outline: none;
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .search-results {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
        }

        .search-result-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }

        .search-result-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .search-close {
            position: absolute;
            top: 30px;
            right: 30px;
            color: white;
            font-size: 30px;
            cursor: pointer;
            background: rgba(0,0,0,0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Navigation */
        .main-navigation {
            display: flex;
            justify-content: center;
            padding: 0 40px;
            background: rgba(0, 0, 0, 0.95);
        }

        .nav-links {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 40px;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            color: #ffffff;
            text-decoration: none;
            padding: 20px 0;
            display: inline-block;
            font-size: 15px;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: #00AFF0;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: #00AFF0;
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            flex-direction: column;
            gap: 4px;
            cursor: pointer;
        }

        .menu-toggle span {
            width: 25px;
            height: 2px;
            background: white;
            transition: 0.3s;
        }

        /* Full Page Background */
        body {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                        url('https://images.unsplash.com/photo-1542272604-787c3835535d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
        }

        /* Hero Section - REMOVED THE STATEMENT */
        .hero-section {
            color: white;
            padding: 100px 20px;
            text-align: center;
            margin-bottom: 60px;
            background: transparent;
        }

        .hero-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hero-subtitle {
            font-size: 20px;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 40px;
            line-height: 1.6;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* Information Pages */
        .info-page {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 40px;
            margin: 20px auto;
            max-width: 1200px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .info-page h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
        }

        .info-page h2 {
            color: #667eea;
            margin: 30px 0 15px;
            font-size: 1.8em;
        }

        .info-page p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .info-page ul, .info-page ol {
            color: #555;
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .info-page li {
            margin-bottom: 10px;
        }

        .tiers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .tier-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid;
        }

        .tier-card.pearl { border-color: #FFF8DC; }
        .tier-card.bronze { border-color: #B76E79; }
        .tier-card.silver { border-color: #2C3E50; }
        .tier-card.ruby { border-color: #8B475D; }
        .tier-card.gold { border-color: #FFD700; }
        .tier-card.sapphire { border-color: #34495E; }
        .tier-card.platinum { border-color: #2F4F4F; }

        .tier-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .benefits-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .benefit-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .benefit-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        /* Enhanced Voucher/QR Details Display */
        .voucher-details-display, .qr-details-display {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .detail-item strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }

        /* Social Media Links */
        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .social-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s;
        }

        .social-link:hover {
            transform: translateY(-2px);
        }

        .social-tiktok { background: #000000; }
        .social-instagram { background: #E4405F; }
        .social-x { background: #000000; }

        /* NEW BONUS SYSTEM STYLES - UPDATED */
        .bonus-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .bonus-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .bonus-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .bonus-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .bonus-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .bonus-item.active {
            border-color: #28a745;
            background: #e8f5e8;
        }

        .bonus-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .bonus-progress-bar {
            flex: 1;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .bonus-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .bonus-value {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .bonus-stack {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px dashed #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }

        .bonus-stack-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }

        .daily-streak {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .streak-day {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            background: #e9ecef;
            color: #666;
        }

        .streak-day.active {
            background: #28a745;
            color: white;
        }

        .streak-day.today {
            background: #667eea;
            color: white;
            animation: pulse 2s infinite;
        }

        .streak-day.completed {
            background: #28a745;
            color: white;
        }

        .streak-day.missed {
            background: #dc3545;
            color: white;
        }

        .streak-day.future {
            background: #e9ecef;
            color: #666;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* NEW BONUS DETAILS STYLES */
        .bonus-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .bonus-detail-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
        }

        .bonus-detail-card.daily { border-left-color: #28a745; }
        .bonus-detail-card.weekly { border-left-color: #667eea; }
        .bonus-detail-card.monthly { border-left-color: #ffc107; }

        .bonus-requirements {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }

        /* UPDATED TIER CARD STYLES FOR MONTHLY MINIMUMS */
        .tier-minimums-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tier-minimum-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid;
            position: relative;
        }

        .tier-minimum-card.pearl { border-top-color: #FFF8DC; }
        .tier-minimum-card.bronze { border-top-color: #B76E79; }
        .tier-minimum-card.silver { border-top-color: #2C3E50; }
        .tier-minimum-card.ruby { border-top-color: #8B475D; }
        .tier-minimum-card.gold { border-top-color: #FFD700; }
        .tier-minimum-card.sapphire { border-top-color: #34495E; }
        .tier-minimum-card.platinum { border-top-color: #2F4F4F; }

        .tier-minimum-card h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.2em;
        }

        .minimum-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .minimum-details p {
            margin: 5px 0;
            font-size: 14px;
            color: #666;
        }

        .minimum-details strong {
            color: #333;
        }

        /* REST OF YOUR EXISTING CSS STYLES */
        * {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
            box-sizing: inherit;
        }

        *, *::after, *::before {
            box-sizing: inherit;
        }

        html {
            width: 100%;
            height: auto;
            overflow-x: visible;
            overflow-x: initial;
            font-size: 10px;
            line-height: 1;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            -ms-text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%;
            --scrollWidth: 0px;
        }

        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            color: #333;
            font-size: 1.4rem;
            font-family: HelveticaNeue-Light, Helvetica, Arial, sans-serif;
            line-height: 1.1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, .004);
        }

        /* TYPOGRAPHY SYSTEM */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            font-family: Emirates-Bold, Helvetica, Arial, Lucida Grande, sans-serif;
            display: inline-block;
            margin: 0 0 1rem;
            text-align: left;
        }

        h1 {
            font-size: 2.5em;
        }

        h2 {
            font-size: 1.6rem;
        }

        .reset-h {
            display: block;
        }

        .links-section__heading {
            margin: 0;
            padding: 10px;
            color: #fff;
            font-weight: 400;
            font-size: 1.8rem;
            line-height: 2.5rem;
            opacity: .9;
            -webkit-font-smoothing: antialiased;
        }

        @media only screen and (min-width: 1024px) {
            .links-section__heading {
                padding: 25px 0 0;
            }
        }

        /* YOUR EXISTING COMPONENT STYLES */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #333;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            color: #666;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select, button, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: HelveticaNeue-Light, Helvetica, Arial, sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            font-family: Emirates-Bold, Helvetica, Arial, sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.google {
            background: white;
            color: #333;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn.google img {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        .section-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-family: Emirates-Bold, Helvetica, Arial, sans-serif;
        }

        .member-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-family: Emirates-Bold, Helvetica, Arial, sans-serif;
        }

        .info-card p {
            color: #666;
            font-size: 1.1em;
        }

        .tier-pearl { color: #FFF8DC; }
        .tier-bronze { color: #B76E79; }
        .tier-silver { color: #2C3E50; }
        .tier-ruby { color: #8B475D; }
        .tier-gold { color: #FFD700; }
        .tier-sapphire { color: #34495E; }
        .tier-platinum { color: #2F4F4F; }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .activity-log {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .discount-result {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .discount-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .discount-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .admin-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
        }

        .members-list {
            display: grid;
            gap: 15px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-buttons .btn {
            flex: 1;
        }

        .newsletter-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .newsletter-checkbox input {
            width: auto;
        }

        .newsletter-checkbox label {
            margin: 0;
            font-weight: normal;
        }

        /* IMPROVED MEMBER CARD STYLES - FIXED FOR MOBILE */
        .member-card-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            perspective: 1000px;
        }

        .member-card {
            width: 360px;
            height: 220px;
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
            font-family: 'Arial', sans-serif;
            color: white;
            transition: transform 0.3s ease;
            transform-style: preserve-3d;
        }

        .member-card:hover {
            transform: translateY(-5px) rotateX(5deg);
        }

        /* UPDATED TIER COLORS */
        .member-card.pearl {
            background: linear-gradient(135deg, #FFF8DC 0%, #F5DEB3 100%);
            color: #333;
        }

        .member-card.bronze {
            background: linear-gradient(135deg, #B76E79 0%, #8B475D 100%);
        }

        .member-card.silver {
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
        }

        .member-card.ruby {
            background: linear-gradient(135deg, #8B475D 0%, #6B3648 100%);
        }

        .member-card.gold {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
        }

        .member-card.sapphire {
            background: linear-gradient(135deg, #34495E 0%, #1F2B3A 100%);
        }

        .member-card.platinum {
            background: linear-gradient(135deg, #2F4F4F 0%, #000000 100%);
        }

        /* Card design elements */
        .card-background-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.8) 2px, transparent 2px),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.6) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .card-logo {
            position: absolute;
            top: 20px;
            right: 25px;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 1px;
        }

        .card-logo-img {
            height: 30px;
            width: auto;
        }

        .card-chip {
            position: absolute;
            top: 20px;
            left: 25px;
            width: 40px;
            height: 30px;
            background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 100%);
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .card-chip::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            width: 30px;
            height: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 3px;
        }

        /* FIXED JC ID DISPLAY FOR MOBILE */
        .card-number {
            position: absolute;
            top: 75px;
            left: 25px;
            font-size: 20px;
            letter-spacing: 3px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            width: calc(100% - 50px);
            white-space: nowrap;
            overflow: visible;
            text-overflow: clip;
            display: flex;
            justify-content: flex-start;
            gap: 5px;
        }

        .card-holder {
            position: absolute;
            bottom: 70px;
            left: 25px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .card-holder-name {
            font-size: 18px;
            font-weight: bold;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            line-height: 1.2;
        }

        .card-tier {
            position: absolute;
            bottom: 25px;
            left: 25px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
        }

        .card-date {
            position: absolute;
            bottom: 25px;
            right: 25px;
            font-weight: bold;
            font-size: 14px;
            letter-spacing: 1px;
        }

        /* Special number styling like the reference images */
        .card-number span {
            display: inline-block;
            background: rgba(0,0,0,0.2);
            padding: 2px 8px;
            margin: 0 1px;
            border-radius: 4px;
            min-width: 22px;
            text-align: center;
        }

        /* SIM card holographic effect */
        .card-hologram {
            position: absolute;
            top: 20px;
            right: 80px;
            width: 50px;
            height: 30px;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 5px,
                    rgba(255,255,255,0.2) 5px,
                    rgba(255,255,255,0.2) 10px
                ),
                repeating-linear-gradient(
                    -45deg,
                    transparent,
                    transparent 5px,
                    rgba(255,255,255,0.1) 5px,
                    rgba(255,255,255,0.1) 10px
                );
            border-radius: 5px;
            transform: skewX(-10deg);
            box-shadow: 0 0 5px rgba(255,255,255,0.3);
        }

        /* NEW VOUCHER MANAGEMENT STYLES */
        .voucher-management-section {
            margin-top: 30px;
        }

        .voucher-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
        }

        .voucher-item.used {
            border-left-color: #6c757d;
            opacity: 0.7;
        }

        .voucher-item.expired {
            border-left-color: #dc3545;
        }

        .voucher-code {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px 0;
        }

        .voucher-qr {
            margin: 10px 0;
            text-align: center;
        }

        .voucher-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-used {
            background: #e2e3e5;
            color: #383d41;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .scan-voucher-section {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }

        /* QR Redemption Styles - KEPT FOR VOUCHERS ONLY */
        .redemption-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .redemption-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .redemption-option.selected {
            border-color: #28a745;
            background: #e8f5e8;
        }

        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .option-tier {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .selected-option-details {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success-card {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .info-message {
            background: #e7f3ff;
            color: #2196F3;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        /* QR Code Container */
        .qr-code-container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .qr-share-section {
            display: block !important;
        }

        /* Redemption Item */
        .redemption-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .redemption-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .redemption-id {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px 0;
        }

        /* NEW IMPROVED CAMERA SCANNER STYLES */
        .camera-scanner-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .camera-scanner-modal.active {
            display: flex;
        }

        .camera-container {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .scanner-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .scanner-header h2 {
            margin: 0;
            font-size: 24px;
        }

        .scanner-header p {
            margin: 5px 0 0;
            opacity: 0.9;
            font-size: 14px;
        }

        .scanner-viewport {
            position: relative;
            width: 100%;
            height: 400px;
            background: #000;
            overflow: hidden;
        }

        #cameraVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: #ff4757;
            box-shadow: 0 0 10px #ff4757;
            animation: scan 2s infinite linear;
            z-index: 10;
        }

        @keyframes scan {
            0% { top: 0; }
            50% { top: calc(100% - 4px); }
            100% { top: 0; }
        }

        #cameraCanvas {
            display: none;
        }

        .scanner-controls {
            background: #f8f9fa;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .camera-select {
            width: 100%;
        }

        .camera-select select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .camera-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .camera-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .camera-btn.start {
            background: #28a745;
            color: white;
        }

        .camera-btn.start:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .camera-btn.stop {
            background: #dc3545;
            color: white;
        }

        .camera-btn.stop:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .camera-btn.switch {
            background: #17a2b8;
            color: white;
        }

        .camera-btn.switch:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .camera-btn.close {
            background: #6c757d;
            color: white;
        }

        .camera-btn.close:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .camera-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none !important;
        }

        .scan-status {
            text-align: center;
            padding: 12px;
            margin: 0;
            border-radius: 5px;
            font-weight: bold;
            background: #e7f3ff;
            color: #2196F3;
        }

        .scan-status.active {
            background: #d4edda;
            color: #155724;
        }

        .scan-status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .scanner-results {
            background: white;
            padding: 20px;
            border-top: 1px solid #eee;
            max-height: 200px;
            overflow-y: auto;
        }

        .result-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        #scannerResult {
            word-break: break-all;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #ddd;
            min-height: 80px;
            font-family: monospace;
            font-size: 14px;
            color: #333;
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        #scannerResult:not(:empty) {
            background: #d4edda !important;
            border-color: #28a745 !important;
            color: #155724 !important;
            font-weight: bold !important;
            border-width: 3px !important;
        }
        
        .camera-scanner-modal {
            z-index: 9999;
        }

        /* Quick Scan Button */
        .quick-scan-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.3s;
            margin: 10px 0;
        }

        .quick-scan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .quick-scan-btn i {
            font-size: 20px;
        }

        /* Scan Results Display */
        .scan-results {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            animation: slideIn 0.3s ease;
        }

        .scan-results.success {
            border-left: 5px solid #28a745;
        }

        .scan-results.error {
            border-left: 5px solid #dc3545;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* TIER REWARD CARD STYLES */
        .tier-reward-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            border-left: 4px solid #FFD700;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .tier-reward-card:hover {
            transform: translateY(-2px);
        }

        .reward-badge {
            display: inline-block;
            background: #FFD700;
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .reward-qr-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .reward-qr-img {
            width: 200px;
            height: 200px;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 10px;
        }

        /* Responsive Styles */
        @media (max-width: 1024px) {
            .nav-links {
                gap: 20px;
            }
            
            .header-top {
                padding: 15px 20px;
            }
            
            .main-navigation {
                padding: 0 20px;
            }
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: flex;
            }
            
            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.95);
                flex-direction: column;
                padding: 20px;
                gap: 10px;
            }
            
            .nav-links.active {
                display: flex;
            }
            
            .nav-link {
                padding: 15px;
                width: 100%;
            }
            
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .member-info {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .member-card {
                width: 320px;
                height: 200px;
                padding: 20px;
            }
            
            .card-number {
                top: 70px;
                font-size: 18px;
                letter-spacing: 2px;
            }
            
            .card-number span {
                padding: 2px 6px;
                min-width: 18px;
            }
            
            .card-holder {
                bottom: 65px;
            }
            
            .card-holder-name {
                font-size: 16px;
                margin-top: 6px;
            }
            
            .card-tier, .card-date {
                bottom: 20px;
                font-size: 12px;
            }
            
            .card-logo {
                font-size: 16px;
                top: 15px;
                right: 20px;
            }
            
            .card-chip {
                top: 15px;
                left: 20px;
                width: 35px;
                height: 25px;
            }
            
            .hero-title {
                font-size: 36px;
            }
            
            .hero-subtitle {
                font-size: 18px;
            }
            
            .tiers-grid, .benefits-list {
                grid-template-columns: 1fr;
            }
            
            .scanner-viewport {
                height: 300px;
            }
            
            .camera-buttons {
                flex-direction: column;
            }
            
            .camera-btn {
                width: 100%;
            }
            
            .bonus-grid {
                grid-template-columns: 1fr;
            }
            
            .bonus-details-grid {
                grid-template-columns: 1fr;
            }
            
            .tier-minimums-grid {
                grid-template-columns: 1fr;
            }

            .reward-qr-img {
                width: 150px;
                height: 150px;
            }
        }

        @media (max-width: 480px) {
            .member-card {
                width: 290px;
                height: 180px;
                padding: 15px;
            }
            
            .card-number {
                top: 65px;
                font-size: 16px;
                letter-spacing: 1.5px;
            }
            
            .card-number span {
                padding: 1px 4px;
                min-width: 16px;
            }
            
            .card-holder {
                bottom: 60px;
                font-size: 10px;
            }
            
            .card-holder-name {
                font-size: 14px;
                margin-top: 4px;
                letter-spacing: 1px;
            }
            
            .card-tier, .card-date {
                bottom: 15px;
                font-size: 10px;
            }
            
            .card-logo {
                font-size: 14px;
                top: 10px;
                right: 15px;
            }
            
            .card-chip {
                top: 10px;
                left: 15px;
                width: 30px;
                height: 20px;
            }
            
            .hero-title {
                font-size: 28px;
            }
            
            .hero-subtitle {
                font-size: 16px;
            }
            
            .scanner-viewport {
                height: 250px;
            }
            
            .reward-qr-img {
                width: 120px;
                height: 120px;
            }
        }

        @media (max-width: 360px) {
            .member-card {
                width: 280px;
                height: 170px;
            }
            
            .card-number {
                font-size: 14px;
            }
            
            .card-holder-name {
                font-size: 13px;
            }
        }

        /* Footer */
        .footer {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 60px 20px 30px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            color: #00AFF0;
            margin-bottom: 20px;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .footer-section p {
            color: #999;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #666;
            font-size: 14px;
        }

        /* ===== SCANNER RESULTS FIXES ===== */
        .scanner-results {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            background: white !important;
            padding: 20px !important;
            border-top: 1px solid #eee !important;
            max-height: 400px !important;
            overflow-y: auto !important;
            min-height: 200px !important;
        }

        #scannerResult {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 150px !important;
            background: white !important;
            border: 2px solid #ddd !important;
            border-radius: 8px !important;
            padding: 15px !important;
            margin-top: 10px !important;
            color: #333 !important;
            font-family: monospace !important;
            font-size: 14px !important;
            word-break: break-all !important;
            overflow-y: auto !important;
            max-height: 300px !important;
            line-height: 1.5 !important;
        }

        #scannerResult:not(:empty) {
            background: #d4edda !important;
            border-color: #28a745 !important;
            color: #155724 !important;
            font-weight: bold !important;
            border-width: 3px !important;
        }

        .camera-scanner-modal {
            z-index: 9999 !important;
        }

        #scanResults {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            animation: fadeIn 0.3s ease !important;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .details-grid {
            display: grid !important;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
            gap: 15px !important;
            margin-top: 15px !important;
        }

        .detail-item {
            padding: 10px !important;
            background: white !important;
            border-radius: 5px !important;
            border: 1px solid #ddd !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
        }

        .detail-item strong {
            color: #333 !important;
            display: block !important;
            margin-bottom: 5px !important;
            font-size: 12px !important;
            text-transform: uppercase !important;
            color: #666 !important;
        }

        .detail-item div {
            font-size: 14px !important;
            color: #333 !important;
            font-weight: 500 !important;
        }

        .scan-results {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            background: white !important;
            border-radius: 10px !important;
            padding: 20px !important;
            margin-top: 20px !important;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1) !important;
            animation: slideIn 0.3s ease !important;
            border-left: 5px solid !important;
        }

        .scan-results.success {
            border-left-color: #28a745 !important;
        }

        .scan-results.error {
            border-left-color: #dc3545 !important;
        }

        .scan-results h4 {
            margin-top: 0 !important;
            margin-bottom: 15px !important;
            font-size: 18px !important;
        }

        .scan-results p {
            margin: 10px 0 !important;
        }

        .result-title {
            font-weight: bold !important;
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 16px !important;
            display: block !important;
        }

        .scanner-results {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
        }

        #scannerResult.hidden,
        .scanner-results.hidden,
        .scan-results.hidden {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
    </style>
    <!-- Add Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Add jsQR Library -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
</head>
<body>
    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search for members, vouchers...">
            <div class="search-results" id="searchResults"></div>
        </div>
        <div class="search-close" onclick="hideSearch()"></div>
    </div>

    <!-- NEW IMPROVED CAMERA SCANNER MODAL -->
    <div class="camera-scanner-modal" id="cameraScannerModal">
        <div class="camera-container">
            <div class="scanner-header">
                <h2>QR Code Scanner</h2>
                <p>Scan vouchers or tier reward QR codes</p>
            </div>
            
            <div class="scanner-viewport">
                <video id="cameraVideo" playsinline></video>
                <div class="scan-line"></div>
                <canvas id="cameraCanvas"></canvas>
            </div>
            
            <div class="scan-status" id="scanStatus">
                Click Start Scanner to begin
            </div>
            
            <div class="scanner-controls">
                <div class="camera-select">
                    <select id="cameraSelect">
                        <option value="">Select Camera</option>
                    </select>
                </div>
                
                <div class="camera-buttons">
                    <button class="camera-btn start" id="startScannerBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
                        </svg>
                        Start Scanner
                    </button>
                    <button class="camera-btn stop" id="stopScannerBtn" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z"/>
                        </svg>
                        Stop Scanner
                    </button>
                    <button class="camera-btn switch" id="switchCameraBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4h-3.17L15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 11.5V13H9v2.5L5.5 12 9 8.5V11h6V8.5l3.5 3.5-3.5 3.5z"/>
                        </svg>
                        Switch Camera
                    </button>
                    <button class="camera-btn close" onclick="closeCameraScanner()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                        Close
                    </button>
                </div>
            </div>
            
            <div class="scanner-results">
                <div class="result-title">Scanned Result:</div>
                <div id="scannerResult">No QR code scanned yet</div>
            </div>
        </div>
    </div>

    <!-- Mercedes-Benz Inspired Header -->
    <header class="mercedes-header">
        <div class="header-top">
            <div class="brand-logo">
                <img src="https://i.ibb.co.com/Rp9F4xBC/jeans-club.jpg" alt="Jeans Club" class="header-logo">
            </div>
            
            <div class="header-actions">
                <div class="search-icon" onclick="showSearch()"></div>
                <div class="user-icon" onclick="toggleUserMenu()"></div>
                <div class="menu-toggle" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
        
        <nav class="main-navigation">
            <ul class="nav-links" id="navLinks">
                <li class="nav-item"><a href="#dashboard" class="nav-link" onclick="showDashboardSection()">Dashboard</a></li>
                <li class="nav-item"><a href="#membership" class="nav-link" onclick="showMembershipInfo()">Membership</a></li>
                <li class="nav-item"><a href="#benefits" class="nav-link" onclick="showBenefits()">Benefits</a></li>
                <li class="nav-item"><a href="#tiers" class="nav-link" onclick="showTiers()">Tiers</a></li>
                <li class="nav-item"><a href="#rewards" class="nav-link" onclick="showRewards()">Rewards</a></li>
                <li class="nav-item"><a href="#contact" class="nav-link" onclick="showContact()">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <h1 class="hero-title">Raised on Denim</h1>
    </section>

    <div class="container" id="main-content">
        <!-- Information Pages -->
        <div id="membershipInfoPage" class="info-page hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="showDashboardSection()"> Back to Dashboard</button>
            </div>
            
            <h1>Membership Information</h1>
            
            <h2>Welcome to Jeans Club Membership</h2>
            <p>Our loyalty program is designed to reward our most valued customers with exclusive benefits, points, and tiered privileges. As a member, you'll enjoy a premium denim shopping experience like no other.</p>
            
            <h2> New Points System</h2>
            <div class="benefits-list">
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Earn Points</h3>
                    <p><strong>1 point for every 1,000 UGX spent</strong></p>
                    <p>Shop more, earn more points automatically</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Redeem Points</h3>
                    <p><strong>1 point = 50 UGX discount</strong></p>
                    <p>Convert your points into shopping discounts</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Simple & Transparent</h3>
                    <p>Easy to calculate your rewards</p>
                    <p>No complex formulas or hidden rules</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Example</h3>
                    <p>Spend 50,000 UGX = 50 points</p>
                    <p>50 points = 2,500 UGX discount</p>
                </div>
            </div>
            
            <h2> NEW: Bi-Monthly Tier Rewards</h2>
            <div style="background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%); padding: 25px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #FFD700;">
                <h3 style="color: #333; margin-top: 0;">Bronze+ Members Get FREE Rewards!</h3>
                <p style="color: #555;">Every 2 months (January, March, May, July, September, November), eligible members receive a special discount QR code:</p>
                <ul style="color: #555; margin-top: 10px;">
                    <li><strong>Bronze:</strong> 10% off (max 100,000 UGX)</li>
                    <li><strong>Silver:</strong> 15% off (max 200,000 UGX)</li>
                    <li><strong>Ruby:</strong> 20% off (max 400,000 UGX)</li>
                    <li><strong>Gold:</strong> 25% off (max 800,000 UGX)</li>
                    <li><strong>Sapphire:</strong> 30% off (max 1,500,000 UGX)</li>
                    <li><strong>Platinum:</strong> 40% off (max 3,000,000 UGX)</li>
                </ul>
                <p style="color: #666; margin-top: 10px;"><strong>Valid for 60 days</strong>  Automatically appears in dashboard  Generate QR code once and save it</p>
            </div>
            
            <h2>How to Join</h2>
            <ol>
                <li>Sign up using your email address or Google account</li>
                <li>Receive your unique JC ID (Jeans Club Identification)</li>
                <li>Get your starting points and referral code</li>
                <li>Start shopping to earn points and climb tiers</li>
            </ol>
            
            <h2>Membership Features</h2>
            <div class="benefits-list">
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Simple Points System</h3>
                    <p>Earn 1 point for every 1,000 UGX spent. Redeem 1 point for 50 UGX discount.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>7 Tiers</h3>
                    <p>Progress through Pearl, Bronze, Silver, Ruby, Gold, Sapphire, and Platinum tiers.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Referral Program</h3>
                    <p>Earn 100 points for each friend who joins using your referral code.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Exclusive Discounts</h3>
                    <p>Convert points to discount vouchers or use points for purchases.</p>
                </div>
            </div>
            
            <h2>Getting Started</h2>
            <p>Upon joining, you'll receive:</p>
            <ul>
                <li>10 welcome points (20 if referred by a friend)</li>
                <li>Unique JC ID for all transactions</li>
                <li>Personal referral code to share with friends</li>
                <li>Starting tier: Pearl</li>
                <li>Access to your digital membership card</li>
            </ul>
            
            <h2>Managing Your Membership</h2>
            <p>Use your dashboard to:</p>
            <ul>
                <li>Track your points balance and tier progress</li>
                <li>View purchase history and activity log</li>
                <li>Create and manage discount vouchers</li>
                <li>Claim your bi-monthly tier reward QR code</li>
                <li>Share your referral code</li>
                <li>Update newsletter preferences</li>
            </ul>
            
            <div style="text-align: center; margin-top: 40px;">
                <button class="btn" onclick="showSignupScreen()">Join Now</button>
                <button class="btn secondary" onclick="showLoginScreen()" style="margin-left: 10px;">Login</button>
            </div>
        </div>

        <div id="benefitsInfoPage" class="info-page hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="showDashboardSection()"> Back to Dashboard</button>
            </div>
            
            <h1>Member Benefits</h1>
            
            <h2> Exclusive Member Benefits</h2>
            <p>As a Jeans Club member, you unlock a world of exclusive benefits designed to enhance your denim shopping experience.</p>
            
            <div class="benefits-list">
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>New Points System</h3>
                    <p><strong>Earn:</strong> 1 point for every 1,000 UGX spent</p>
                    <p><strong>Redeem:</strong> 1 point = 50 UGX discount</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Tier Reward QR Codes</h3>
                    <p>Bi-monthly discount QR codes for Bronze+ tiers (up to 40% off!)</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Exclusive Emails</h3>
                    <p>Receive personalized offers, new arrival alerts, and style tips.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Faster Checkout</h3>
                    <p>Quick QR code scanning for seamless discounts.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Birthday Rewards</h3>
                    <p>Special birthday discounts and bonus points.</p>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>VIP Access</h3>
                    <p>Early access to sales and exclusive collections.</p>
                </div>
            </div>
            
            <h2> Points Calculation Examples</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h3>Simple & Transparent Rewards</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                    <thead>
                        <tr style="background: #667eea; color: white;">
                            <th style="padding: 10px; text-align: left;">Spending</th>
                            <th style="padding: 10px; text-align: left;">Points Earned</th>
                            <th style="padding: 10px; text-align: left;">Discount Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px;">10,000 UGX</td>
                            <td style="padding: 10px;">10 points</td>
                            <td style="padding: 10px;">500 UGX</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px;">50,000 UGX</td>
                            <td style="padding: 10px;">50 points</td>
                            <td style="padding: 10px;">2,500 UGX</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px;">100,000 UGX</td>
                            <td style="padding: 10px;">100 points</td>
                            <td style="padding: 10px;">5,000 UGX</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px;">200,000 UGX</td>
                            <td style="padding: 10px;">200 points</td>
                            <td style="padding: 10px;">10,000 UGX</td>
                        </tr>
                    </tbody>
                </table>
                <p style="margin-top: 15px; font-size: 14px; color: #666;">*Points are calculated automatically with every purchase</p>
            </div>
            
            <h2> Tier-Specific Benefits</h2>
            <p>Your benefits increase as you progress through tiers:</p>
            
            <h3>Pearl Tier</h3>
            <ul>
                <li>Basic points earning (1 point per 1,000 UGX spent)</li>
                <li>Discount voucher creation</li>
                <li>Newsletter subscription</li>
                <li>Referral program access</li>
                <li style="color: #dc3545;"> No bi-monthly tier rewards</li>
            </ul>
            
            <h3>Bronze & Silver Tiers</h3>
            <ul>
                <li>All Pearl benefits</li>
                <li style="color: #28a745; font-weight: bold;"> Bi-monthly tier reward: 10% (Bronze) / 15% (Silver) OFF</li>
                <li>Higher redemption options</li>
                <li>Extended voucher validity</li>
                <li>Priority email support</li>
            </ul>
            
            <h3>Ruby & Gold Tiers</h3>
            <ul>
                <li>All lower tier benefits</li>
                <li style="color: #28a745; font-weight: bold;"> Bi-monthly tier reward: 20% (Ruby) / 25% (Gold) OFF</li>
                <li>Premium redemption options</li>
                <li>Higher discount caps</li>
                <li>Lifetime spending bonuses</li>
                <li>Exclusive event invitations</li>
            </ul>
            
            <h3>Sapphire & Platinum Tiers</h3>
            <ul>
                <li>All lower tier benefits</li>
                <li style="color: #28a745; font-weight: bold;"> Bi-monthly tier reward: 30% (Sapphire) / 40% (Platinum) OFF</li>
                <li>Maximum redemption options</li>
                <li>Personalized shopping assistance</li>
                <li>Highest discount rates</li>
            </ul>
            
            <h2> How to Maximize Benefits</h2>
            <ol>
                <li>Shop regularly to earn more points (1 point per 1,000 UGX)</li>
                <li>Use referral codes to earn bonus points (100 points per referral)</li>
                <li>Redeem points for discounts (1 point = 50 UGX)</li>
                <li><strong>Claim your bi-monthly tier reward QR code every 2 months!</strong></li>
                <li>Subscribe to newsletters for exclusive offers</li>
                <li>Save and screenshot your generated QR codes</li>
                <li>Combine points for larger discounts</li>
                <li>Participate in seasonal promotions</li>
            </ol>
            
            <div style="text-align: center; margin-top: 40px;">
                <button class="btn" onclick="showDashboardSection()">View Your Benefits</button>
            </div>
        </div>

        <div id="tiersInfoPage" class="info-page hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="showDashboardSection()"> Back to Dashboard</button>
            </div>
            
            <h1>Tier System</h1>
            
            <h2> Our 7-Tier System</h2>
            <p>Progress through our carefully designed tier system to unlock increasingly valuable benefits and rewards.</p>
            
            <div class="tiers-grid">
                <div class="tier-card pearl">
                    <h3>PEARL</h3>
                    <p><strong>Points Range:</strong> 0 - 7,499</p>
                    <p><strong>Earning Rate:</strong> 1 point / 1,000 UGX</p>
                    <p><strong>Discount Value:</strong> 1 point = 50 UGX</p>
                    <p><strong>Tier Reward:</strong>  Not available</p>
                    <p><strong>Benefits:</strong></p>
                    <ul>
                        <li>Basic points earning</li>
                        <li>Discount vouchers</li>
                        <li>Newsletter access</li>
                        <li>Referral program</li>
                    </ul>
                </div>
                
                <div class="tier-card bronze">
                    <h3>BRONZE</h3>
                    <p><strong>Points Range:</strong> 7,500 - 24,999</p>
                    <p><strong>Earning Rate:</strong> 1 point / 1,000 UGX</p>
                    <p><strong>Discount Value:</strong> 1 point = 50 UGX</p>
                    <p><strong>Tier Reward:</strong>  10% OFF (max 100,000 UGX)</p>
                    <p><strong>Benefits:</strong></p>
                    <ul>
                        <li>All Pearl benefits</li>
                        <li>Bi-monthly reward QR code</li>
                        <li>8% spending redemption</li>
                        <li>Extended support</li>
                    </ul>
                </div>
                
                <div class="tier-card silver">
                    <h3>SILVER</h3>
                    <p><strong>Points Range:</strong> 25,000 - 99,999</p>
                    <p><strong>Earning Rate:</strong> 1 point / 1,000 UGX</p>
                    <p><strong>Discount Value:</strong> 1 point = 50 UGX</p>
                    <p><strong>Tier Reward:</strong>  15% OFF (max 200,000 UGX)</p>
                    <p><strong>Benefits:</strong></p>
                    <ul>
                        <li>10% spending redemption</li>
                        <li>Bi-monthly reward QR code</li>
                        <li>Pay-with-points option</li>
                        <li>Priority support</li>
                        <li>Early sale access</li>
                    </ul>
                </div>
                
                <div class="tier-card ruby">
                    <h3>RUBY</h3>
                    <p><strong>Points Range:</strong> 100,000 - 249,999</p>
                    <p><strong>Earning Rate:</strong> 1 point / 1,000 UGX</p>
                    <p><strong>Discount Value:</strong> 1 point = 50 UGX</p>
                    <p><strong>Tier Reward:</strong>  20% OFF (max 400,000 UGX)</p>
                    <p><strong>Benefits:</strong></p>
                    <ul>
                        <li>12% spending redemption</li>
                        <li>Bi-monthly reward QR code</li>
                        <li>Higher discount caps</li>
                        <li>Exclusive offers</li>
                        <li>Faster processing</li>
                    </ul>
                </div>
                
                <div class="tier-card gold">
                    <h3>GOLD</h3>
                    <p><strong>Points Range:</strong> 250,000 - 499,999</p>
                    <p><strong>Earning Rate:</strong> 1 point / 1,000 UGX</p>
                    <p><strong>Discount Value:</strong> 1 point = 50 UGX</p>
                    <p><strong>Tier Reward:</strong>  25% OFF (max 800,000 UGX)</p>
                    <p><strong>Benefits:</strong></p>
                    <ul>
                        <li>15% spending redemption</li>
                        <li>Bi-monthly reward QR code</li>
                        <li>Loyalty bonuses</li>
                        <li>VIP treatment</li>
                        <li>Event invitations</li>
                    </ul>
                </div>
                
                <div class="tier-card sapphire">
                    <h3>SAPPHIRE</h3>
                    <p><strong>Points Range:</strong> 500,000 - 999,999</p>
                    <p><strong>Earning Rate:</strong> 1 point / 1,000 UGX</p>
                    <p><strong>Discount Value:</strong> 1 point = 50 UGX</p>
                    <p><strong>Tier Reward:</strong>  30% OFF (max 1,500,000 UGX)</p>
                    <p><strong>Benefits:</strong></p>
                    <ul>
                        <li>18% + 2% lifetime bonus</li>
                        <li>Bi-monthly reward QR code</li>
                        <li>Maximum discounts</li>
                        <li>Personal assistant</li>
                        <li>Custom fittings</li>
                    </ul>
                </div>
                
                <div class="tier-card platinum">
                    <h3>PLATINUM</h3>
                    <p><strong>Points Range:</strong> 1,000,000+</p>
                    <p><strong>Earning Rate:</strong> 1 point / 1,000 UGX</p>
                    <p><strong>Discount Value:</strong> 1 point = 50 UGX</p>
                    <p><strong>Tier Reward:</strong>  40% OFF (max 3,000,000 UGX)</p>
                    <p><strong>Benefits:</strong></p>
                    <ul>
                        <li>25% + 5% lifetime bonus</li>
                        <li>Bi-monthly reward QR code</li>
                        <li>All redemption options</li>
                        <li>Exclusive collections</li>
                        <li>Highest privileges</li>
                    </ul>
                </div>
            </div>
            
            <h2> Points System Explained</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h3>Simple & Rewarding</h3>
                <p><strong>Earning Points:</strong> All tiers earn 1 point for every 1,000 UGX you spend.</p>
                
                <p><strong>Example for all tiers:</strong></p>
                <ul>
                    <li>Spend 10,000 UGX = 10 points</li>
                    <li>Spend 50,000 UGX = 50 points</li>
                    <li>Spend 100,000 UGX = 100 points</li>
                </ul>
                
                <p><strong>Redeeming Points:</strong> Each point is worth 50 UGX in discount.</p>
            </div>
            
            <h2> Tier Progression</h2>
            <p>Your tier is automatically calculated based on your total points. Points never expire and tiers only go up - once you reach a tier, you never downgrade!</p>
            
            <h3>How to Move Up Tiers</h3>
            <ol>
                <li><strong>Make Purchases:</strong> Every purchase earns points at the same rate for all tiers</li>
                <li><strong>Refer Friends:</strong> Earn 100 points for each successful referral</li>
                <li><strong>Participate in Promotions:</strong> Seasonal events offer bonus points</li>
                <li><strong>Be Consistent:</strong> Regular shopping accelerates tier progression</li>
            </ol>
            
            <h3>Important Notes</h3>
            <ul>
                <li>Points are permanent and never expire</li>
                <li>Tiers only increase - no downgrading</li>
                <li>All tiers earn at the same rate: 1 point per 1,000 UGX</li>
                <li>All tiers redeem at the same rate: 1 point = 50 UGX</li>
                <li><strong>Bi-monthly tier rewards for Bronze+ members only</strong></li>
                <li>Reward QR codes are issued on the 1st of reward months (Jan, Mar, May, Jul, Sep, Nov)</li>
                <li>QR codes expire after 60 days and can only be generated ONCE</li>
            </ul>
            
            <div style="text-align: center; margin-top: 40px;">
                <button class="btn" onclick="showDashboardSection()">Check Your Tier Progress</button>
            </div>
        </div>

        <div id="rewardsInfoPage" class="info-page hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="showDashboardSection()"> Back to Dashboard</button>
            </div>
            
            <h1> Tier Rewards Program</h1>
            
            <div style="background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%); padding: 30px; border-radius: 15px; margin: 20px 0; border-left: 4px solid #FFD700;">
                <h2 style="color: #333; margin-top: 0;">Bi-Monthly Rewards for Bronze+ Members</h2>
                <p style="color: #555; font-size: 18px;">Every 2 months, eligible members receive a <strong>FREE discount QR code</strong> based on their tier!</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px;">
                    <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 36px; margin-bottom: 10px;"></div>
                        <h3 style="margin: 10px 0;">Automatic</h3>
                        <p style="color: #666;">Rewards are issued automatically on the 1st of reward months</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 36px; margin-bottom: 10px;"></div>
                        <h3 style="margin: 10px 0;">One-Time Generation</h3>
                        <p style="color: #666;">Generate QR code ONCE and save it - cannot be regenerated</p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 36px; margin-bottom: 10px;"></div>
                        <h3 style="margin: 10px 0;">60 Days Validity</h3>
                        <p style="color: #666;">Use your reward within 60 days of issuance</p>
                    </div>
                </div>
            </div>
            
            <h2> Reward Tiers</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #B76E79;">
                    <h3 style="margin-top: 0; color: #B76E79;">BRONZE</h3>
                    <div style="font-size: 28px; font-weight: bold; color: #B76E79;">10% OFF</div>
                    <p style="color: #666;">Maximum discount: 100,000 UGX</p>
                    <p style="color: #666; margin-top: 10px;">Perfect for trying new styles</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #2C3E50;">
                    <h3 style="margin-top: 0; color: #2C3E50;">SILVER</h3>
                    <div style="font-size: 28px; font-weight: bold; color: #2C3E50;">15% OFF</div>
                    <p style="color: #666;">Maximum discount: 200,000 UGX</p>
                    <p style="color: #666; margin-top: 10px;">Save more on premium denim</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #8B475D;">
                    <h3 style="margin-top: 0; color: #8B475D;">RUBY</h3>
                    <div style="font-size: 28px; font-weight: bold; color: #8B475D;">20% OFF</div>
                    <p style="color: #666;">Maximum discount: 400,000 UGX</p>
                    <p style="color: #666; margin-top: 10px;">Significant savings on bulk purchases</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #FFD700;">
                    <h3 style="margin-top: 0; color: #FFD700;">GOLD</h3>
                    <div style="font-size: 28px; font-weight: bold; color: #FFD700;">25% OFF</div>
                    <p style="color: #666;">Maximum discount: 800,000 UGX</p>
                    <p style="color: #666; margin-top: 10px;">Premium rewards for loyal customers</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #34495E;">
                    <h3 style="margin-top: 0; color: #34495E;">SAPPHIRE</h3>
                    <div style="font-size: 28px; font-weight: bold; color: #34495E;">30% OFF</div>
                    <p style="color: #666;">Maximum discount: 1,500,000 UGX</p>
                    <p style="color: #666; margin-top: 10px;">Elite-level savings</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #2F4F4F;">
                    <h3 style="margin-top: 0; color: #2F4F4F;">PLATINUM</h3>
                    <div style="font-size: 28px; font-weight: bold; color: #2F4F4F;">40% OFF</div>
                    <p style="color: #666;">Maximum discount: 3,000,000 UGX</p>
                    <p style="color: #666; margin-top: 10px;">Ultimate VIP reward</p>
                </div>
            </div>
            
            <h2> Reward Schedule</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h3 style="margin-top: 0;">Reward Months: January, March, May, July, September, November</h3>
                <p>On the 1st of each reward month, eligible members will see a "Reward Available" banner in their dashboard.</p>
                <ul style="margin-top: 15px;">
                    <li><strong>Issued:</strong> Automatically on the 1st</li>
                    <li><strong>Generate:</strong> Click the button to create your unique QR code</li>
                    <li><strong>Save:</strong> Screenshot or download the QR code - you can only generate it ONCE!</li>
                    <li><strong>Use:</strong> Present at checkout within 60 days</li>
                </ul>
            </div>
            
            <h2> Frequently Asked Questions</h2>
            
            <h3>Who is eligible for tier rewards?</h3>
            <p>All Bronze, Silver, Ruby, Gold, Sapphire, and Platinum members are eligible. Pearl members must reach Bronze to unlock rewards.</p>
            
            <h3>What happens if I don't generate the QR code?</h3>
            <p>The reward is available for the entire 60-day validity period. However, you must generate the QR code before the 60 days expire. Once generated, you have the remaining validity days to use it.</p>
            
            <h3>Can I generate the QR code multiple times?</h3>
            <p><strong>NO.</strong> You can only generate the QR code <strong>ONCE</strong>. Please screenshot or download it immediately. If you lose it, the reward cannot be reissued.</p>
            
            <h3>Can I combine tier rewards with other discounts?</h3>
            <p>No, tier rewards cannot be combined with other promotions or discount vouchers. Choose the best discount for your purchase.</p>
            
            <h3>What if my tier upgrades during the reward cycle?</h3>
            <p>Your reward is based on your tier on the 1st of the reward month. Future rewards will reflect your higher tier.</p>
            
            <div style="text-align: center; margin-top: 40px; padding: 20px; background: #e7f3ff; border-radius: 10px;">
                <h3 style="color: #2196F3;">Ready to claim your reward?</h3>
                <p style="color: #666;">Log in to your dashboard to check your reward status!</p>
                <button class="btn" onclick="showDashboardSection()" style="margin-top: 10px;">Go to Dashboard</button>
            </div>
        </div>

        <div id="contactInfoPage" class="info-page hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="showDashboardSection()"> Back to Dashboard</button>
            </div>
            
            <h1>Contact Us</h1>
            
            <h2> Get in Touch</h2>
            <p>We're here to help you with any questions about your Jeans Club membership, points, tier rewards, or general inquiries.</p>
            
            <div class="benefits-list">
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Email</h3>
                    <p><strong>Primary:</strong> oliviakamukama@gmail.com</p>
                    <p><strong>Support:</strong> support@jeansclub.com</p>
                </div>
                
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Phone</h3>
                    <p><strong>Customer Service:</strong> +256 772558913</p>
                    <p><strong>WhatsApp:</strong> +256 772558913</p>
                </div>
                
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Business Hours</h3>
                    <p><strong>Monday - Saturday:</strong> 8:00 AM - 9:00 PM</p>
                    <p><strong>Sunday:</strong> Closed</p>
                </div>
                
                <div class="benefit-item">
                    <div class="benefit-icon"></div>
                    <h3>Location</h3>
                    <p>Kampala, Uganda</p>
                    <p>Premium Denim Boutique</p>
                </div>
            </div>
            
            <h2> Connect With Us</h2>
            <p>Follow us on social media for the latest updates, style tips, and exclusive offers:</p>
            
            <div class="social-links" style="justify-content: center; margin: 30px 0;">
                <a href="https://www.tiktok.com/@jeansclubug?_r=1&_t=ZM-91wJ0p98EMG" target="_blank" class="social-link social-tiktok">
                    <span></span> TikTok
                </a>
                <a href="https://www.instagram.com/jeans_club_ug?igsh=NmFkNTI5MDYzMTZk" target="_blank" class="social-link social-instagram">
                    <span></span> Instagram
                </a>
                <a href="https://x.com/jeansclub_ug?s=20" target="_blank" class="social-link social-x">
                    <span></span> X (Twitter)
                </a>
            </div>
            
            <h2> Frequently Asked Questions</h2>
            
            <h3>Membership Questions</h3>
            <p><strong>Q: How do I join Jeans Club?</strong><br>
            A: Click "Sign Up" on our website and follow the simple registration process.</p>
            
            <p><strong>Q: Is there a membership fee?</strong><br>
            A: No, Jeans Club membership is completely free!</p>
            
            <p><strong>Q: How do I check my points balance?</strong><br>
            A: Log into your dashboard to see your current points and tier status.</p>
            
            <h3>Tier Rewards</h3>
            <p><strong>Q: When do I get my tier reward?</strong><br>
            A: Rewards are issued on the 1st of January, March, May, July, September, and November.</p>
            
            <p><strong>Q: I'm Pearl tier - why don't I see a reward?</strong><br>
            A: Tier rewards are available for Bronze members and above. Reach 7,500 points to unlock Bronze and your first reward!</p>
            
            <p><strong>Q: I lost my QR code! Can I regenerate it?</strong><br>
            A: No, QR codes can only be generated ONCE. Please screenshot and save it immediately.</p>
            
            <p><strong>Q: How long is my reward valid?</strong><br>
            A: Tier reward QR codes are valid for 60 days from the issue date.</p>
            
            <h3>Points & Redemptions</h3>
            <p><strong>Q: How do I earn points?</strong><br>
            A: All tiers earn 1 point for every 1,000 UGX you spend.</p>
            
            <p><strong>Q: How much is 1 point worth?</strong><br>
            A: Each point is worth 50 UGX in discount value for all tiers.</p>
            
            <p><strong>Q: How do I redeem points?</strong><br>
            A: You can create discount vouchers from your dashboard for instant savings.</p>
            
            <p><strong>Q: Do points expire?</strong><br>
            A: No, your points never expire as long as your account remains active.</p>
            
            <h3>Tier System</h3>
            <p><strong>Q: How do I move to a higher tier?</strong><br>
            A: Accumulate points through purchases and referrals to automatically progress to higher tiers.</p>
            
            <p><strong>Q: Can I be downgraded to a lower tier?</strong><br>
            A: No, once you reach a tier, you never go down. Our system only allows tier upgrades.</p>
            
            <h2> Need Immediate Help?</h2>
            <p>For urgent issues or assistance during checkout, please call us directly at <strong>+256 772558913</strong> during business hours.</p>
            
            <div style="text-align: center; margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3>Ready to Shop?</h3>
                <p>Visit our store or contact us for personalized shopping assistance!</p>
                <button class="btn" onclick="showDashboardSection()">Go to Dashboard</button>
            </div>
        </div>
 
        <!-- Signup Section -->
        <div id="signupSection" class="card">
            <h2 class="section-title">Create Account</h2>
            <div class="form-group">
                <label for="userName">Full Name</label>
                <input type="text" id="userName" placeholder="Enter your full name" autocomplete="off">
            </div>
            <div class="form-group">
                <label for="userEmail">Email Address</label>
                <input type="email" id="userEmail" placeholder="Enter your email" autocomplete="off">
                <small style="color: #666; display: block; margin-top: 5px;">Use your real email address. Temporary/disposable emails are blocked.</small>
            </div>
            <div class="form-group">
                <label for="userPassword">Password</label>
                <input type="password" id="userPassword" placeholder="Create a password" autocomplete="new-password">
            </div>
            <div class="form-group">
                <label for="referralCode">Referral Code (Optional)</label>
                <input type="text" id="referralCode" placeholder="Enter referral code if any" autocomplete="off">
                <small style="color: #666; display: block; margin-top: 5px;">Cannot use your own referral code</small>
            </div>
            
            <div class="newsletter-checkbox">
                <input type="checkbox" id="newsletterSignup" checked>
                <label for="newsletterSignup">Subscribe to our newsletter for exclusive deals and updates</label>
            </div>
            
            <button class="btn" onclick="signUpWithEmail()">Create Account</button>
            <div class="form-group" style="text-align: center; margin: 20px 0;">
                <div style="border-bottom: 1px solid #ddd; line-height: 0.1em; margin: 10px 0 20px;">
                    <span style="background: white; padding: 0 10px; color: #666;">OR</span>
                </div>
                <div class="google-signin-button"></div>
            </div>
            <div class="form-group" style="text-align: center;">
                <p>Already have an account? <a href="#" onclick="showLoginScreen()" style="color: #667eea; text-decoration: none;">Login here</a></p>
            </div>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="card hidden">
            <h2 class="section-title">Login to Your Account</h2>
            <div class="form-group">
                <label for="loginJCId">JC ID</label>
                <input type="text" id="loginJCId" placeholder="Enter your JC ID" autocomplete="off">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Enter your password" autocomplete="current-password">
            </div>
            <button class="btn" onclick="loginWithCredentials()">Login</button>
            
            <div class="form-group" style="text-align: center; margin: 20px 0;">
                <a href="#" onclick="showPasswordResetScreen()" style="color: #667eea; text-decoration: none;">Forgot Password?</a>
            </div>
            
            <div class="form-group" style="text-align: center; margin: 20px 0;">
                <div style="border-bottom: 1px solid #ddd; line-height: 0.1em; margin: 10px 0 20px;">
                    <span style="background: white; padding: 0 10px; color: #666;">OR</span>
                </div>
                <div class="google-login-button"></div>
            </div>
            <div class="form-group" style="text-align: center;">
                <p>Don't have an account? <a href="#" onclick="showSignupScreen()" style="color: #667eea; text-decoration: none;">Sign up here</a></p>
            </div>
            <div class="form-group" style="text-align: center; margin-top: 20px;">
                <button class="btn secondary" onclick="showAdminLogin()">Staff Login</button>
            </div>
        </div>

        <!-- Password Reset Section -->
        <div id="passwordResetSection" class="card hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="showLoginScreen()">Back to Login</button>
            </div>

            <h2 class="section-title">Reset Your Password</h2>
            
            <div class="info-card">
                <h3>Request Password Reset</h3>
                <div class="form-group">
                    <label for="resetJCId">Your JC ID</label>
                    <input type="text" id="resetJCId" placeholder="Enter your JC ID">
                </div>
                <button class="btn" onclick="requestPasswordReset()">Send Reset Code</button>
                <div id="resetRequestResult" style="margin-top: 10px;"></div>
            </div>

            <div id="resetForm" class="info-card hidden">
                <h3>Enter Reset Code & New Password</h3>
                <div class="form-group">
                    <label for="resetToken">Reset Code (Check your email)</label>
                    <input type="text" id="resetToken" placeholder="Enter the reset code from email">
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" placeholder="Enter new password">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm new password">
                </div>
                <button class="btn" onclick="executePasswordReset()">Reset Password</button>
                <div id="resetExecuteResult" style="margin-top: 10px;"></div>
            </div>

            <div class="info-card">
                <h3>Need Help?</h3>
                <p>If you're having trouble resetting your password:</p>
                <ul>
                    <li>Make sure you're entering the correct JC ID</li>
                    <li>Check your spam folder for the reset email</li>
                    <li>Reset codes expire after 1 hour</li>
                    <li>Google accounts don't use passwords - use Google Sign-In</li>
                </ul>
            </div>
        </div>

        <!-- Dashboard Section - UPDATED WITH TIER REWARD SYSTEM -->
        <div id="dashboardSection" class="card hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="logout()">Logout</button>
                <button class="btn" onclick="refreshData()">Refresh Data</button>
                
            </div>
            
            <h2 class="section-title">Member Dashboard</h2>
            
            <!-- IMPROVED MEMBER CARD DISPLAY -->
            <div class="member-card-container">
                <div id="memberCard" class="member-card">
                    <div class="card-background-pattern"></div>
                    <div class="card-logo">
                        <img src="https://i.ibb.co.com/zTqxQvwv/jeans-club.jpg" alt="JC" class="card-logo-img">
                    </div>
                    <div class="card-chip"></div>
                    <div class="card-hologram"></div>
                    <div class="card-number" id="cardNumber">XXXX XXXX XXXX XXXX</div>
                    <div class="card-holder">
                        CARD HOLDER
                        <div class="card-holder-name" id="cardHolderName">-</div>
                    </div>
                    <div class="card-tier" id="cardTier">-</div>
                    <div class="card-date" id="cardDate">MM/YY</div>
                </div>
            </div>
            
            <div class="member-info">
                <div class="info-card">
                    <h3>JC ID</h3>
                    <p id="memberJcId">-</p>
                </div>
                <div class="info-card">
                    <h3>Name</h3>
                    <p id="memberName">-</p>
                </div>
                <div class="info-card">
                    <h3>Email</h3>
                    <p id="memberEmail">-</p>
                </div>
                <div class="info-card">
                    <h3>Login Method</h3>
                    <p id="memberLoginMethod">-</p>
                </div>
            </div>

            <div class="member-info">
                <div class="info-card">
                    <h3>Current Tier</h3>
                    <p id="memberTier">-</p>
                </div>
                <div class="info-card">
                    <h3>Points Balance</h3>
                    <p id="memberPoints">-</p>
                </div>
                <div class="info-card">
                    <h3>Total Spent</h3>
                    <p id="totalSpent">- UGX</p>
                </div>
                <div class="info-card">
                    <h3>Referral Code</h3>
                    <p id="memberReferralCode">-</p>
                </div>
            </div>

            <div class="info-card">
                <h3>Tier Progress</h3>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
                <p id="tierProgressText">Loading progress...</p>
            </div>

            <!-- TIER REWARD CARD - DYNAMICALLY INSERTED HERE BY JAVASCRIPT -->
            

            <div class="info-card">
                <h3>Points System</h3>
                <p><strong>Earn:</strong> 1 point for every 1,000 UGX spent</p>
                <p><strong>Redeem:</strong> 1 point = 50 UGX discount</p>
                <p><small>All tiers earn at the same rate</small></p>
            </div>

            <div class="info-card">
                <h3>Newsletter Preferences</h3>
                <p>Get exclusive deals, new arrivals, and style tips delivered to your inbox</p>
                <button class="btn" onclick="toggleNewsletter()" id="newsletterToggle">
                    Subscribe to Newsletter
                </button>
            </div>

            <div class="info-card">
                <h3>Referral Stats</h3>
                <p id="referralStats">Loading stats...</p>
                <button class="btn" onclick="shareReferral()" style="margin-top: 10px;">Share Referral Code</button>
            </div>

            <div class="info-card">
                <h3>Redeem Points for Discount</h3>
                <div class="form-group">
                    <label for="discountPoints">Points to Use (Min: 4)</label>
                    <input type="number" id="discountPoints" placeholder="Enter points to redeem" min="4">
                </div>
                <button class="btn" onclick="calculateDiscount()">Calculate Discount</button>
                <div id="discountResult" class="discount-result"></div>
                <button class="btn" onclick="redeemPoints()" style="margin-top: 10px;">Generate Discount Voucher</button>
            </div>

            <!-- NEW VOUCHER MANAGEMENT SECTION -->
            <div class="info-card voucher-management-section">
                <h3>My Discount Vouchers</h3>
                <div id="vouchersList" class="activity-log">
                    <div class="activity-item">Loading vouchers...</div>
                </div>
            </div>

            <div class="info-card">
                <h3>Recent Activity</h3>
                <div id="activityLog" class="activity-log">
                    <div class="activity-item">Loading activity...</div>
                </div>
            </div>
        </div>

        <!-- Admin Section with Quick Scan Button -->
        <div id="adminSection" class="card hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="logout()">Logout</button>
                <button class="btn" onclick="showAdminPanel()">Refresh Members</button>
                <button class="btn secondary" onclick="showDeleteMemberSection()">Delete Member</button>
                <button class="btn" onclick="showVoucherManagementPanel()">Manage Vouchers</button>
            </div>

            <h2 class="section-title">Staff Admin Panel</h2>
            
            <div class="info-card">
                <h3>Add Purchase</h3>
                <div class="form-group">
                    <label for="purchaseJCId">Member JC ID</label>
                    <input type="text" id="purchaseJCId" placeholder="Enter JC ID">
                </div>
                <div class="form-group">
                    <label for="purchaseAmount">Amount (UGX)</label>
                    <input type="number" id="purchaseAmount" placeholder="Enter amount">
                </div>
                <div class="form-group">
                    <label for="purchaseDescription">Description</label>
                    <input type="text" id="purchaseDescription" placeholder="Purchase description">
                </div>
                <button class="btn" onclick="adminAddPurchase()">Add Purchase</button>
                <div id="purchaseResult" style="margin-top: 10px;"></div>
            </div>

            <!-- ENHANCED VOUCHER SCANNING SECTION - ALSO HANDLES TIER REWARDS -->
            <div class="scan-voucher-section">
                <h3> Scan & Redeem Voucher / Tier Reward</h3>
                
                <!-- Quick Scan Option -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <button class="quick-scan-btn" onclick="openCameraScanner()">
                         Quick Scan QR
                    </button>
                    <p style="color: #666; font-size: 14px; margin-top: 10px;">OR enter code manually below</p>
                </div>
                
                <div class="form-group">
                    <label for="voucherCodeInput">Voucher Code or QR Data</label>
                    <input type="text" id="voucherCodeInput" placeholder="Enter voucher code or scan QR code">
                </div>
                <div class="form-group">
                    <label for="salespersonName">Your Name (Salesperson)</label>
                    <input type="text" id="salespersonName" placeholder="Enter your name" required>
                </div>
                <button class="btn" onclick="processScan()">Process Scan</button>
                <div id="scanDetails" class="voucher-details-display hidden" style="margin-top: 20px;">
                    <!-- Details will be shown here -->
                </div>
                <div id="voucherRedeemResult" style="margin-top: 10px;"></div>
                
                <!-- Scan Results Display -->
                <div id="scanResults" class="scan-results hidden"></div>
            </div>

            <div class="info-card">
                <h3>Send Newsletter</h3>
                <div class="form-group">
                    <label for="newsletterSubject">Subject</label>
                    <input type="text" id="newsletterSubject" placeholder="Enter newsletter subject">
                </div>
                <div class="form-group">
                    <label for="newsletterContent">Content</label>
                    <textarea id="newsletterContent" placeholder="Enter newsletter content" rows="6" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; font-family: inherit;"></textarea>
                </div>
                <button class="btn" onclick="sendNewsletter()">Send Newsletter to All Subscribers</button>
                <div id="newsletterResult" style="margin-top: 10px;"></div>
            </div>

            <div id="adminContent">
                <!-- Members list will be loaded here -->
            </div>
        </div>

        <!-- Delete Member Section -->
        <div id="deleteMemberSection" class="card hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="showAdminPanel()">Back to Admin</button>
            </div>

            <h2 class="section-title">Delete Member Account</h2>
            
            <div class="info-card" style="border-left-color: #dc3545;">
                <h3 style="color: #dc3545;">Warning: This action cannot be undone</h3>
                <div class="form-group">
                    <label for="deleteJCId">Member JC ID to Delete</label>
                    <input type="text" id="deleteJCId" placeholder="Enter JC ID to delete">
                </div>
                <button class="btn" style="background: #dc3545;" onclick="confirmDeleteMember()">Delete Member Account</button>
                <div id="deleteResult" style="margin-top: 10px;"></div>
            </div>
        </div>

        <!-- NEW Voucher Management Section -->
        <div id="voucherManagementSection" class="card hidden">
            <div class="nav-buttons">
                <button class="btn secondary" onclick="showAdminPanel()">Back to Admin</button>
                <button class="btn" onclick="refreshVouchers()">Refresh Vouchers</button>
            </div>

            <h2 class="section-title">Voucher Management</h2>
            
            <div class="info-card">
                <h3>All Vouchers</h3>
                <div id="allVouchersList" class="activity-log">
                    <div class="activity-item">Loading all vouchers...</div>
                </div>
            </div>

            <div class="info-card">
                <h3>Voucher Statistics</h3>
                <div id="voucherStats" style="margin-top: 10px;">
                    Loading voucher statistics...
                </div>
            </div>
        </div>

        <!-- QR Code Section -->
        <div class="card qr-share-section" style="text-align: center; margin-top: 20px;">
            <h3 style="color: #333; margin-bottom: 20px;">Share Jeans Club</h3>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://elijah787.github.io/jeans-club" 
                 alt="QR Code for Jeans Club"
                 style="border: 2px solid #ddd; border-radius: 10px; padding: 10px; display: block; margin: 0 auto;">
            <p style="color: #666; margin-top: 15px;">Scan to share with friends</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Jeans Club</h3>
                <p>Premium Denim Loyalty Program with Tiered Privileges and Bi-Monthly Rewards for our valued members.</p>
                <p><strong>Earn 1 point per 1,000 UGX | Redeem 1 point for 50 UGX discount</strong></p>
                <p><strong> Bronze+ get FREE 10-40% OFF every 2 months!</strong></p>
                <p>Raised on Denim, Elevated by Experience.</p>
                <div class="social-links">
                    <a href="https://www.tiktok.com/@jeansclubug?_r=1&_t=ZM-91wJ0p98EMG" target="_blank" class="social-link social-tiktok">
                        <span></span> TikTok
                    </a>
                    <a href="https://www.instagram.com/jeans_club_ug?igsh=NmFkNTI5MDYzMTZk" target="_blank" class="social-link social-instagram">
                        <span></span> Instagram
                    </a>
                    <a href="https://x.com/jeansclub_ug?s=20" target="_blank" class="social-link social-x">
                        <span></span> X
                    </a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <p><a href="#" onclick="showSignupScreen()" style="color: #999; text-decoration: none;">Sign Up</a></p>
                <p><a href="#" onclick="showLoginScreen()" style="color: #999; text-decoration: none;">Login</a></p>
                <p><a href="#" onclick="showBenefits()" style="color: #999; text-decoration: none;">Benefits</a></p>
                <p><a href="#" onclick="showTiers()" style="color: #999; text-decoration: none;">Tiers</a></p>
                <p><a href="#" onclick="showRewards()" style="color: #999; text-decoration: none;">Tier Rewards</a></p>
            </div>
            
            <div class="footer-section">
                <h3>Contact</h3>
                <p>Email: oliviakamukama@gmail.com</p>
                <p>Phone: +256 772558913</p>
                <p>Hours: Mon-Saturday 8AM-9PM</p>
                <p> Kampala, Uganda</p>
            </div>
            
            
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2026 Jeans Club. All rights reserved. | Premium Denim Benefits | Bi-Monthly Tier Rewards</p>
        </div>
    </footer>

    <script>
      
        
       

        // ===========================
        // GLOBAL VARIABLE DECLARATIONS
        // ===========================
        
        let voucherSystem;
        
        let clubManager;
        
        // ===========================
        // NEW IMPROVED CAMERA SCANNER FUNCTIONALITY
        // ===========================
        
        let scannerStream = null;
        let scannerScanning = false;
        let scannerFacingMode = 'environment';
        let scannerCameras = [];
        let scannerCanvasContext = null;

        // Open camera scanner
        function openCameraScanner() {
            if (!clubManager.isAdmin) {
                showToast("Please login as staff first", "error");
                return;
            }

            const modal = document.getElementById('cameraScannerModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Initialize scanner
            initScanner();
        }

        // Initialize scanner
        async function initScanner() {
            try {
                // Get canvas context
                const canvas = document.getElementById('cameraCanvas');
                scannerCanvasContext = canvas.getContext('2d');
                
                // Get available cameras
                await getAvailableCameras();
                
                // Set up event listeners
                document.getElementById('startScannerBtn').onclick = startScanner;
                document.getElementById('stopScannerBtn').onclick = stopScanner;
                document.getElementById('switchCameraBtn').onclick = switchScannerCamera;
                document.getElementById('cameraSelect').onchange = handleCameraSelectChange;
                
                // Update status
                updateScannerStatus('Click Start Scanner to begin', false);
                
            } catch (error) {
                console.error("Scanner initialization error:", error);
                updateScannerStatus("Scanner initialization failed: " + error.message, false);
            }
        }

        // Get available cameras
        async function getAvailableCameras() {
            try {
                // First get permission to access cameras
                await navigator.mediaDevices.getUserMedia({ video: true });
                
                // Then enumerate devices
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                // Clear previous options
                const cameraSelect = document.getElementById('cameraSelect');
                cameraSelect.innerHTML = '<option value="">Select Camera</option>';
                
                // Add camera options
                videoDevices.forEach((device, index) => {
                    const option = document.createElement('option');
                    option.value = device.deviceId;
                    option.text = device.label || `Camera ${index + 1}`;
                    cameraSelect.appendChild(option);
                });
                
                scannerCameras = videoDevices;
                
                // Auto-select first camera
                if (videoDevices.length > 0) {
                    cameraSelect.value = videoDevices[0].deviceId;
                }
                
            } catch (error) {
                console.error("Error getting cameras:", error);
                updateScannerStatus("Could not access camera: " + error.message, false);
            }
        }

        // Start scanner
        async function startScanner() {
            try {
                if (scannerScanning) return;
                
                const cameraSelect = document.getElementById('cameraSelect');
                const selectedDeviceId = cameraSelect.value;
                
                // Stop any existing stream
                if (scannerStream) {
                    scannerStream.getTracks().forEach(track => track.stop());
                }
                
                // Constraints for video stream
                const constraints = {
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: selectedDeviceId ? undefined : scannerFacingMode
                    }
                };
                
                // If a specific device is selected, use it
                if (selectedDeviceId) {
                    constraints.video.deviceId = { exact: selectedDeviceId };
                }
                
                // Get video stream
                scannerStream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('cameraVideo');
                video.srcObject = scannerStream;
                
                // Wait for video to load
                await new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
                
                // Set canvas dimensions
                const canvas = document.getElementById('cameraCanvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Update UI
                document.getElementById('startScannerBtn').disabled = true;
                document.getElementById('stopScannerBtn').disabled = false;
                scannerScanning = true;
                
                updateScannerStatus('Scanner active - Point at QR code', true);
                
                // Start scanning loop
                scanQRCode();
                
            } catch (error) {
                console.error("Error starting scanner:", error);
                updateScannerStatus("Failed to start scanner: " + error.message, false);
                showToast("Camera error: " + error.message, "error");
            }
        }

        // Stop scanner
        function stopScanner() {
            scannerScanning = false;
            
            // Stop video stream
            if (scannerStream) {
                scannerStream.getTracks().forEach(track => track.stop());
                scannerStream = null;
            }
            
            // Clear video source
            const video = document.getElementById('cameraVideo');
            video.srcObject = null;
            
            // Update UI
            document.getElementById('startScannerBtn').disabled = false;
            document.getElementById('stopScannerBtn').disabled = true;
            
            updateScannerStatus('Scanner stopped', false);
        }

        // Switch camera
        function switchScannerCamera() {
            if (!scannerScanning) return;
            
            // Toggle facing mode
            scannerFacingMode = scannerFacingMode === 'environment' ? 'user' : 'environment';
            
            // Restart scanner with new facing mode
            stopScanner();
            setTimeout(startScanner, 500);
        }

        // Handle camera select change
        function handleCameraSelectChange() {
            if (scannerScanning) {
                // Restart with selected camera
                stopScanner();
                setTimeout(startScanner, 500);
            }
        }

        // Scan for QR codes
        function scanQRCode() {
            if (!scannerScanning) return;
            
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                // Draw video frame to canvas
                scannerCanvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Get image data from canvas
                const imageData = scannerCanvasContext.getImageData(0, 0, canvas.width, canvas.height);
                
                // Try to decode QR code
                const code = jsQR(imageData.data, imageData.width, imageData.height, {
                    inversionAttempts: "dontInvert",
                });
                
                // If QR code found
                if (code) {
                    handleQRCodeDetected(code.data);
                    
                    // Draw rectangle around QR code
                    scannerCanvasContext.strokeStyle = '#28a745';
                    scannerCanvasContext.lineWidth = 4;
                    scannerCanvasContext.strokeRect(
                        code.location.topLeftCorner.x,
                        code.location.topLeftCorner.y,
                        code.location.bottomRightCorner.x - code.location.topLeftCorner.x,
                        code.location.bottomRightCorner.y - code.location.topLeftCorner.y
                    );
                }
            }
            
            // Continue scanning
            if (scannerScanning) {
                requestAnimationFrame(scanQRCode);
            }
        }

        // Handle detected QR code
        async function handleQRCodeDetected(qrData) {
            console.log("QR Code detected:", qrData);
            
            // Stop scanner immediately
            scannerScanning = false;
            
            // Update result display
            const resultElement = document.getElementById('scannerResult');
            if (resultElement) {
                resultElement.textContent = qrData;
                resultElement.style.backgroundColor = '#d4edda';
                resultElement.style.color = '#155724';
                resultElement.style.borderColor = '#28a745';
                resultElement.style.fontWeight = 'bold';
                resultElement.style.padding = '15px';
                resultElement.style.whiteSpace = 'pre-wrap';
                resultElement.style.wordBreak = 'break-word';
                resultElement.classList.remove('hidden');
                
                const scannerResults = document.querySelector('.scanner-results');
                if (scannerResults) {
                    scannerResults.style.display = 'block';
                    scannerResults.style.visibility = 'visible';
                    scannerResults.style.opacity = '1';
                    scannerResults.classList.remove('hidden');
                }
            }
            
            // Play scan beep sound
            playScanBeep();
            
            // Show success message
            updateScannerStatus('QR Code detected! Processing...', true);
            
            // Close scanner and redirect to admin panel
            setTimeout(() => {
                closeCameraScanner();
                showAdminPanel();
                
                // Focus on salesperson name field
                setTimeout(() => {
                    const salespersonInput = document.getElementById('salespersonName');
                    if (salespersonInput) {
                        salespersonInput.focus();
                        salespersonInput.select();
                    }
                    
                    // Fill the voucher code input with scanned data
                    const voucherInput = document.getElementById('voucherCodeInput');
                    if (voucherInput) {
                        voucherInput.value = qrData;
                    }
                    
                    showToast("QR code scanned! Please enter your name and click 'Process Scan'", "info");
                }, 500);
            }, 1000);
        }

        // Play scan beep sound
        function playScanBeep() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Sound not critical
            }
        }

        // Update scanner status
        function updateScannerStatus(message, active) {
            const statusElement = document.getElementById('scanStatus');
            statusElement.textContent = message;
            statusElement.className = 'scan-status' + (active ? ' active' : '');
        }

        // Close camera scanner
        function closeCameraScanner() {
            const modal = document.getElementById('cameraScannerModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            stopScanner();
        }

        // ===========================
        // VOUCHER SYSTEM IMPLEMENTATION
        // ===========================
        
        class VoucherSystem {
            constructor() {
                this.vouchers = JSON.parse(localStorage.getItem('jeansClubVouchers') || '[]');
                this.voucherActivity = JSON.parse(localStorage.getItem('jeansClubVoucherActivity') || '[]');
                this.cleanupInterval = null;
                this.startAutoCleanup();
                
                // TIER LIMITS FOR VOUCHERS
                this.TIER_VOUCHER_LIMITS = {
                    PEARL: { daily: 1, weekly: 2, monthly: 5 },
                    BRONZE: { daily: 2, weekly: 4, monthly: 10 },
                    SILVER: { daily: 3, weekly: 8, monthly: 25 },
                    RUBY: { daily: 5, weekly: 12, monthly: 40 },
                    GOLD: { daily: 8, weekly: 20, monthly: 60 },
                    SAPPHIRE: { daily: 12, weekly: 30, monthly: 90 },
                    PLATINUM: { daily: 20, weekly: 50, monthly: 150 }
                };
            }

            startAutoCleanup() {
                // Cleanup expired vouchers on startup
                this.cleanupExpiredVouchers();
                
                // Schedule cleanup every 24 hours
                this.cleanupInterval = setInterval(() => {
                    this.cleanupExpiredVouchers();
                }, 24 * 60 * 60 * 1000);
            }

            cleanupExpiredVouchers() {
                const now = new Date();
                const thirtyDaysAgo = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000));
                
                // Filter out vouchers that expired more than 30 days ago
                const originalCount = this.vouchers.length;
                this.vouchers = this.vouchers.filter(voucher => {
                    if (voucher.status === 'expired') {
                        const expiryDate = new Date(voucher.expiryDate);
                        return expiryDate > thirtyDaysAgo;
                    }
                    return true;
                });
                
                const removedCount = originalCount - this.vouchers.length;
                if (removedCount > 0) {
                    this.saveVouchers();
                    console.log(`Cleaned up ${removedCount} old expired vouchers`);
                }
            }

            // Check if member can create more vouchers based on tier limits
            canCreateVoucher(memberJCId, memberTier) {
                const limits = this.TIER_VOUCHER_LIMITS[memberTier] || this.TIER_VOUCHER_LIMITS.PEARL;
                
                // Get today's date
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const sevenDaysAgo = new Date(today.getTime() - (7 * 24 * 60 * 60 * 1000));
                const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
                
                // Count vouchers by period
                let dailyCount = 0;
                let weeklyCount = 0;
                let monthlyCount = 0;

                this.vouchers.forEach(voucher => {
                    if (voucher.memberJCId === memberJCId && voucher.status !== 'expired') {
                        const createdDate = new Date(voucher.createdDate);

                        if (createdDate >= today) {
                            dailyCount++;
                        }
                        if (createdDate >= sevenDaysAgo) {
                            weeklyCount++;
                        }
                        if (createdDate >= thirtyDaysAgo) {
                            monthlyCount++;
                        }
                    }
                });
                
                return {
                    canCreate: dailyCount < limits.daily && 
                              weeklyCount < limits.weekly && 
                              monthlyCount < limits.monthly,
                    limits: limits,
                    current: {
                        daily: dailyCount,
                        weekly: weeklyCount,
                        monthly: monthlyCount
                    },
                    remaining: {
                        daily: limits.daily - dailyCount,
                        weekly: limits.weekly - weeklyCount,
                        monthly: limits.monthly - monthlyCount
                    }
                };
            }

            generateVoucherCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 8; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return 'JC' + code;
            }

            generateQRCodeData(voucherCode) {
                return voucherCode;
            }

            async createVoucher(memberJCId, memberName, pointsUsed, discountPercentage, expiryDays = 30) {
                const voucherCode = this.generateVoucherCode();
                const createdDate = new Date();
                const expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + expiryDays);

                const voucher = {
                    id: 'voucher_' + Date.now(),
                    code: voucherCode,
                    memberJCId: memberJCId,
                    memberName: memberName,
                    pointsUsed: pointsUsed,
                    discountPercentage: discountPercentage,
                    createdDate: createdDate.toISOString(),
                    expiryDate: expiryDate.toISOString(),
                    status: 'active',
                    usedDate: null,
                    qrCodeData: this.generateQRCodeData(voucherCode)
                };

                this.vouchers.push(voucher);
                this.saveVouchers();
                
                // Save to Supabase
                await this.saveVoucherToSupabase(voucher);

                this.logVoucherActivity(voucherCode, 'created', memberJCId, `Voucher created: ${discountPercentage}% discount`);

                return voucher;
            }

            getMemberVouchers(memberJCId) {
                return this.vouchers.filter(v => v.memberJCId === memberJCId)
                    .sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
            }

            getAllVouchers() {
                return this.vouchers.sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
            }

            async getVoucherByCode(code) {
                // First check local storage
                let voucher = this.vouchers.find(v => v.code === code);
                
                // If not found locally, try Supabase
                if (!voucher) {
                    voucher = await this.getVoucherFromSupabase(code);
                    if (voucher) {
                        // Add to local cache
                        this.vouchers.push(voucher);
                        this.saveVouchers();
                    }
                }
                
                return voucher;
            }

         async redeemVoucher(voucherCode, redeemedBy = 'system') {
    let voucher = await this.getVoucherByCode(voucherCode);
    if (!voucher) {
        return { success: false, message: "Voucher not found" };
    }

    if (voucher.status === 'used') {
        return { success: false, message: "Voucher has already been used" };
    }

    if (voucher.status === 'expired') {
        return { success: false, message: "Voucher has expired" };
    }

    if (new Date() > new Date(voucher.expiryDate)) {
        voucher.status = 'expired';
        this.saveVouchers();
        await this.saveVoucherToSupabase(voucher);
        return { success: false, message: "Voucher has expired" };
    }

    //  UPDATE STATUS TO USED
    voucher.status = 'used';
    voucher.usedDate = new Date().toISOString();
    voucher.redeemedBy = redeemedBy;
    
    //  SAVE TO BOTH STORAGES
    this.saveVouchers();              // Update local storage
    await this.saveVoucherToSupabase(voucher);  // Update Supabase

    this.logVoucherActivity(voucherCode, 'redeemed', voucher.memberJCId, `Voucher redeemed by ${redeemedBy}`);

    //  FORCE MEMBER DASHBOARD REFRESH IF ONLINE
    if (clubManager && clubManager.currentMember && clubManager.currentMember.jcId === voucher.memberJCId) {
        // Member is currently logged in - force refresh their data
        const updatedMember = await clubManager.db.getMemberByJCId(voucher.memberJCId);
        if (updatedMember) {
            clubManager.currentMember = updatedMember;
            localStorage.setItem('jeansClubCurrentMember', JSON.stringify(updatedMember));
            
            // Update dashboard if visible
            if (!document.getElementById('dashboardSection').classList.contains('hidden')) {
                updateMemberDashboard(updatedMember);
            }
        }
    }

    return { 
        success: true, 
        message: `Voucher redeemed successfully! ${voucher.discountPercentage}% discount applied.`,
        voucher: voucher
    };
}

            updateVoucherStatuses() {
                const now = new Date();
                let updated = false;

                this.vouchers.forEach(voucher => {
                    if (voucher.status === 'active' && new Date(voucher.expiryDate) < now) {
                        voucher.status = 'expired';
                        updated = true;
                    }
                });

                if (updated) {
                    this.saveVouchers();
                }
            }

            getVoucherStats() {
                this.updateVoucherStatuses();
                
                const total = this.vouchers.length;
                const active = this.vouchers.filter(v => v.status === 'active').length;
                const used = this.vouchers.filter(v => v.status === 'used').length;
                const expired = this.vouchers.filter(v => v.status === 'expired').length;
                
                const totalDiscount = this.vouchers
                    .filter(v => v.status === 'used')
                    .reduce((sum, v) => sum + v.discountPercentage, 0);
                
                const avgDiscount = used > 0 ? (totalDiscount / used).toFixed(1) : 0;

                return {
                    total,
                    active,
                    used,
                    expired,
                    avgDiscount,
                    redemptionRate: total > 0 ? ((used / total) * 100).toFixed(1) + '%' : '0%'
                };
            }

            logVoucherActivity(voucherCode, action, memberJCId, description) {
                const activity = {
                    timestamp: new Date().toISOString(),
                    voucherCode: voucherCode,
                    action: action,
                    memberJCId: memberJCId,
                    description: description
                };

                this.voucherActivity.unshift(activity);
                if (this.voucherActivity.length > 100) {
                    this.voucherActivity = this.voucherActivity.slice(0, 100);
                }
                localStorage.setItem('jeansClubVoucherActivity', JSON.stringify(this.voucherActivity));
            }

            saveVouchers() {
                localStorage.setItem('jeansClubVouchers', JSON.stringify(this.vouchers));
            }
            
            // Save voucher to Supabase
            async saveVoucherToSupabase(voucher) {
                try {
                    console.log(" Saving voucher to Supabase:", voucher.code);
                    
                    if (!window.supabaseDbInstance) {
                        console.error(" Supabase DB not initialized");
                        return false;
                    }
                    
                    const { supabase } = window.supabaseDbInstance;
                    
                    const voucherData = {
                        id: voucher.id,
                        code: voucher.code,
                        member_jc_id: voucher.memberJCId,
                        member_name: voucher.memberName,
                        points_used: voucher.pointsUsed,
                        discount_percentage: voucher.discountPercentage,
                        created_date: voucher.createdDate,
                        expiry_date: voucher.expiryDate,
                        status: voucher.status,
                        used_date: voucher.usedDate,
                        redeemed_by: voucher.redeemedBy,
                        qr_code_data: voucher.qrCodeData
                    };

                    console.log(" Voucher data for Supabase:", voucherData);

                    const { data, error } = await supabase
                        .from('vouchers')
                        .upsert(voucherData, { 
                            onConflict: 'code'
                        });

                    if (error) {
                        console.error(" Supabase voucher save error:", error);
                        return false;
                    }

                    console.log(" Voucher saved to Supabase:", voucher.code);
                    return true;

                } catch (error) {
                    console.error(" Failed to save voucher to Supabase:", error);
                    return false;
                }
            }

            async getVoucherFromSupabase(code) {
                try {
                    if (!window.supabaseDbInstance) {
                        console.error(" Supabase DB not initialized");
                        return null;
                    }
                    
                    const { supabase } = window.supabaseDbInstance;
                    
                    const { data: voucher, error } = await supabase
                        .from('vouchers')
                        .select('*')
                        .eq('code', code)
                        .single();

                    if (error) {
                        if (error.code === 'PGRST116') {
                            return null;
                        }
                        console.error(" Supabase voucher fetch error:", error);
                        return null;
                    }

                    if (voucher) {
                        return {
                            id: voucher.id,
                            code: voucher.code,
                            memberJCId: voucher.member_jc_id,
                            memberName: voucher.member_name,
                            pointsUsed: voucher.points_used,
                            discountPercentage: voucher.discount_percentage,
                            createdDate: voucher.created_date,
                            expiryDate: voucher.expiry_date,
                            status: voucher.status,
                            usedDate: voucher.used_date,
                            redeemedBy: voucher.redeemed_by,
                            qrCodeData: voucher.qr_code_data
                        };
                    }
                    
                    return null;
                } catch (error) {
                    console.error(" Failed to fetch voucher from Supabase:", error);
                    return null;
                }
            }
        }

        // Import Supabase
        const { createClient } = supabase;

        // Supabase Database Manager
        class SupabaseDB {
            constructor() {
                this.supabaseUrl = 'https://uoyzsyxjrfygrsfzhlao.supabase.co';
                this.anonKey = 'sb_publishable__gS2-Pd9S7I5dBlq4rmzMQ_K2QMwovA';
                
                this.supabase = createClient(this.supabaseUrl, this.anonKey, {
                    db: {
                        schema: 'public'
                    },
                    global: {
                        headers: {
                            'apikey': this.anonKey,
                            'Authorization': `Bearer ${this.anonKey}`,
                            'Content-Type': 'application/json'
                        }
                    }
                });
                
                this.cacheKey = 'jeansClubCache';
                this.init();
                console.log(' SupabaseDB initialized with URL:', this.supabaseUrl);
                
                // Store globally for easy access
                window.supabaseDbInstance = this;
            }

            async init() {
                if (!this.getCache()) {
                    this.setCache({ members: [], lastSync: 0 });
                }
            }

            getCache() {
                try {
                    const cache = localStorage.getItem(this.cacheKey);
                    return cache ? JSON.parse(cache) : null;
                } catch (error) {
                    console.error('Error reading cache:', error);
                    return null;
                }
            }

            setCache(data) {
                try {
                    localStorage.setItem(this.cacheKey, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Error writing to storage:', error);
                    return false;
                }
            }
async getAllMembers() {
    try {
        console.log(' Fetching all members from Supabase...');
        
        const { data: members, error } = await this.supabase
            .from('members')
            .select('*');

        if (error) {
            console.error(' Supabase error:', error);
            throw error;
        }

        console.log(` Loaded ${members?.length || 0} members from Supabase`);
        
        const transformedMembers = members ? members.map(member => {
            // SAFELY parse JSON fields - check if they're strings first
            let purchaseHistory = [];
            let activityLog = [];
            let referrals = [];
            let reward_history = [];
            
            try {
                purchaseHistory = typeof member.purchasehistory === 'string' 
                    ? JSON.parse(member.purchasehistory) 
                    : (member.purchasehistory || []);
            } catch (e) {
                purchaseHistory = [];
            }
            
            try {
                activityLog = typeof member.activitylog === 'string' 
                    ? JSON.parse(member.activitylog) 
                    : (member.activitylog || []);
            } catch (e) {
                activityLog = [];
            }
            
            try {
                referrals = typeof member.referrals === 'string' 
                    ? JSON.parse(member.referrals) 
                    : (member.referrals || []);
            } catch (e) {
                referrals = [];
            }
            
            try {
                reward_history = typeof member.reward_history === 'string' 
                    ? JSON.parse(member.reward_history) 
                    : (member.reward_history || []);
            } catch (e) {
                reward_history = [];
            }

            return {
                ...member,
                jcId: member.jc_id,
                referralCode: member.referral_code,
                referredBy: member.referred_by,
                joinedDate: member.joined_date,
                totalSpent: member.total_spent || 0,
                newsletterSubscribed: member.newsletter_subscribed !== false,
                ip_address: member.ip_address,
                lastLogin: member.last_login,
                createdAt: member.created_at,
                tier_reward_available: member.tier_reward_available || false,
                tier_reward_generated: member.tier_reward_generated || false,
                tier_reward_qr_code: member.tier_reward_qr_code,
                tier_reward_qr_id: member.tier_reward_qr_id,
                tier_reward_percentage: member.tier_reward_percentage,
                tier_reward_max_discount: member.tier_reward_max_discount,
                tier_reward_issued_date: member.tier_reward_issued_date,
                tier_reward_expiry_date: member.tier_reward_expiry_date,
                tier_reward_used_date: member.tier_reward_used_date,
                tier_reward_used_by: member.tier_reward_used_by,
                last_reward_cycle: member.last_reward_cycle,
                reward_history: reward_history,
                purchaseHistory: purchaseHistory,
                activityLog: activityLog,
                challenges: [],
                referrals: referrals
            };
        }) : [];

        // Update cache
        this.setCache({
            members: transformedMembers,
            lastSync: Date.now()
        });

        return transformedMembers;

    } catch (error) {
        console.error(' Failed to fetch from Supabase, using cache:', error);
        const cache = this.getCache();
        return cache?.members || [];
    }
}
           
            async saveMember(member) {
                try {
                    console.log(' Saving member to Supabase:', member.jcId);
                    
                    const memberData = {
                        id: member.id || 'member_' + Date.now(),
                        jc_id: member.jcId,
                        email: member.email,
                        normalized_email: normalizeEmailForDatabase(member.email),
                        name: member.name,
                        password: member.password || null,
                        points: member.points || 0,
                        tier: member.tier || 'PEARL',
                        referral_code: member.referralCode,
                        referred_by: member.referredBy || null,
                        joined_date: member.joinedDate || new Date().toISOString(),
                        total_spent: member.totalSpent || 0,
                        newsletter_subscribed: member.newsletterSubscribed !== false,
                    
                        
                        purchasehistory: JSON.stringify(member.purchaseHistory || []),
                        activitylog: JSON.stringify(member.activityLog || []),
                        challenges: JSON.stringify(member.challenges || []),
                        referrals: JSON.stringify(member.referrals || []),
                        
                        resettoken: member.resetToken || null,
                        resettokenexpiry: member.resetTokenExpiry || null,
                        ip_address: member.ip_address || 'unknown',
                        last_login: member.lastLogin || null,
                        created_at: member.createdAt || new Date().toISOString()
                    };

                    console.log(' Saving member to Supabase');

                    const { data, error } = await this.supabase
                        .from('members')
                        .upsert(memberData, { 
                            onConflict: 'jc_id'
                        });

                    if (error) {
                        console.error(' Supabase save error:', error);
                        throw error;
                    }

                    console.log(' Member saved successfully to Supabase');
                    
                    const cache = this.getCache();
                    if (cache) {
                        cache.lastSync = 0;
                        this.setCache(cache);
                    }

                    return true;

                } catch (error) {
                    console.error(' Failed to save member to Supabase:', error);
                    return false;
                }
            }
                   
            async deleteMember(jcId) {
                try {
                    console.log(' Deleting member from Supabase:', jcId);
                    
                    const { error } = await this.supabase
                        .from('members')
                        .delete()
                        .eq('jc_id', jcId);

                    if (error) {
                        console.error(' Supabase delete error:', error);
                        throw error;
                    }

                    console.log(' Member deleted successfully from Supabase');
                    
                    try {
                        const member = await this.getMemberByJCId(jcId);
                        if (member && member.email) {
                            await this.supabase
                                .from('newsletter_subscriptions')
                                .delete()
                                .eq('email', member.email);
                        }
                    } catch (newsletterError) {
                        console.log(' Could not delete from newsletter subscriptions:', newsletterError);
                    }
                    
                    const cache = this.getCache();
                    if (cache) {
                        cache.lastSync = 0;
                        this.setCache(cache);
                    }

                    return true;

                } catch (error) {
                    console.error(' Failed to delete member from Supabase:', error);
                    return false;
                }
            }
            
            async getMemberByJCId(jcId) {
                try {
                    console.log(' Fetching member from Supabase:', jcId);
                    
                    const { data: member, error } = await this.supabase
                        .from('members')
                        .select('*')
                        .eq('jc_id', jcId)
                        .single();

                    if (error && error.code !== 'PGRST116') {
                        console.error(' Supabase fetch error:', error);
                        throw error;
                    }

                    if (member) {
                        return {
                            ...member,
                            jcId: member.jc_id,
                            referralCode: member.referral_code,
                            referredBy: member.referred_by,
                            joinedDate: member.joined_date,
                            totalSpent: member.total_spent,
                            newsletterSubscribed: member.newsletter_subscribed,
                            ip_address: member.ip_address,
                            lastLogin: member.last_login,
                            createdAt: member.created_at,
                         
                            
                            purchaseHistory: member.purchasehistory ? JSON.parse(member.purchasehistory) : [],
                            activityLog: member.activitylog ? JSON.parse(member.activitylog) : [],
                            challenges: member.challenges ? JSON.parse(member.challenges) : [],
                            referrals: member.referrals ? JSON.parse(member.referrals) : []
                        };
                    }
                    
                    return null;
                } catch (error) {
                    console.error(' Failed to fetch member from Supabase:', error);
                    
                    const cache = this.getCache();
                    if (cache?.members) {
                        return cache.members.find(m => m.jcId === jcId) || null;
                    }
                    
                    return null;
                }
            }

            async getMemberByEmail(email) {
                try {
                    console.log(' Fetching member by email from Supabase:', email);
                    
                    const { data: member, error } = await this.supabase
                        .from('members')
                        .select('*')
                        .eq('normalized_email', normalizeEmailForDatabase(email))
                        .single();

                    if (error && error.code !== 'PGRST116') {
                        console.error(' Supabase fetch error:', error);
                        throw error;
                    }

                    if (member) {
                        return {
                            ...member,
                            jcId: member.jc_id,
                            referralCode: member.referral_code,
                            referredBy: member.referred_by,
                            joinedDate: member.joined_date,
                            totalSpent: member.total_spent,
                            newsletterSubscribed: member.newsletter_subscribed,
                            ip_address: member.ip_address,
                            lastLogin: member.last_login,
                            createdAt: member.created_at,
                        
                            
                            purchaseHistory: member.purchasehistory ? JSON.parse(member.purchasehistory) : [],
                            activityLog: member.activitylog ? JSON.parse(member.activitylog) : [],
                            challenges: member.challenges ? JSON.parse(member.challenges) : [],
                            referrals: member.referrals ? JSON.parse(member.referrals) : []
                        };
                    }
                    
                    return null;
                } catch (error) {
                    console.error(' Failed to fetch member by email from Supabase:', error);
                    
                    const cache = this.getCache();
                    if (cache?.members) {
                        return cache.members.find(m => normalizeEmailForDatabase(m.email) === normalizeEmailForDatabase(email)) || null;
                    }
                    
                    return null;
                }
            }

            async subscribeToNewsletter(email, name = null) {
                try {
                    const normalizedEmail = normalizeEmailForDatabase(email);
                    console.log(' Subscribing to newsletter:', email, 'Normalized:', normalizedEmail);
                    
                    const { data, error } = await this.supabase
                        .from('newsletter_subscriptions')
                        .upsert({
                            email: email,
                            normalized_email: normalizedEmail,
                            name: name,
                            is_active: true,
                            subscribed_at: new Date().toISOString()
                        }, { 
                            onConflict: 'email'
                        });

                    if (error) {
                        console.error(' Newsletter subscription error:', error);
                        return false;
                    }
                    return true;
                } catch (error) {
                    console.error(' Failed to subscribe:', error);
                    return false;
                }
            }
            
            async unsubscribeFromNewsletter(email) {
                try {
                    console.log(' Unsubscribing from newsletter:', email);
                    
                    const { data, error } = await this.supabase
                        .from('newsletter_subscriptions')
                        .update({ 
                            is_active: false,
                            unsubscribed_at: new Date().toISOString()
                        })
                        .eq('email', email);

                    if (error) {
                        console.error(' Newsletter unsubscribe error:', error);
                        throw error;
                    }

                    console.log(' Newsletter unsubscribe successful');
                    return true;

                } catch (error) {
                    console.error(' Failed to unsubscribe from newsletter:', error);
                    return false;
                }
            }

            async getNewsletterSubscribers(activeOnly = true) {
                try {
                    let query = this.supabase
                        .from('newsletter_subscriptions')
                        .select('*');

                    if (activeOnly) {
                        query = query.eq('is_active', true);
                    }

                    const { data: subscribers, error } = await query;

                    if (error) {
                        console.error(' Newsletter fetch error:', error);
                        throw error;
                    }

                    return subscribers || [];

                } catch (error) {
                    console.error(' Failed to fetch newsletter subscribers:', error);
                    return [];
                }
            }

            async getNewsletterStatus(email) {
                try {
                    const { data: subscription, error } = await this.supabase
                        .from('newsletter_subscriptions')
                        .select('is_active')
                        .eq('email', email)
                        .single();

                    if (error && error.code !== 'PGRST116') {
                        console.error(' Newsletter status error:', error);
                        throw error;
                    }

                    return subscription ? subscription.is_active : false;

                } catch (error) {
                    console.error(' Failed to get newsletter status:', error);
                    return false;
                }
            }
        }

        // ===========================================
        // FRAUD PREVENTION & EMAIL NORMALIZATION
        // ===========================================
        
        const DISPOSABLE_EMAIL_DOMAINS = [
            'tempmail.com', 'mailinator.com', 'guerrillamail.com', '10minutemail.com',
            'yopmail.com', 'throwawaymail.com', 'fakeinbox.com', 'temp-mail.org',
            'sharklasers.com', 'trashmail.com', 'getairmail.com', 'maildrop.cc',
            'tempmailaddress.com', 'fake-mail.com', 'tempinbox.com', 'dispostable.com',
            'mailnesia.com', 'spam4.me', 'tempail.com', 'emailondeck.com',
            'tmpmail.org', 'mailmetrash.com', 'throwawayemailaddress.com', 'deadaddress.com',
            'mailnull.com', 'getnada.com', 'mailcatch.com', 'inboxalias.com',
            'spamgourmet.com', 'spamfree24.org', 'spambox.us', 'tempomail.fr',
            'mytemp.email', 'tempemail.net', 'disposable-email.ml', 'temp-mail.io'
        ];

        function normalizeEmailForDatabase(email) {
            if (!email || typeof email !== 'string') return '';
            
            let normalized = email.trim().toLowerCase();
            
            normalized = normalized.replace('@googlemail.com', '@gmail.com');
            
            const atIndex = normalized.indexOf('@');
            if (atIndex === -1) return normalized;
            
            const localPart = normalized.substring(0, atIndex);
            const domain = normalized.substring(atIndex + 1);
            
            if (domain === 'gmail.com') {
                let cleanLocal = localPart.replace(/\./g, '');
                const plusIndex = cleanLocal.indexOf('+');
                if (plusIndex !== -1) {
                    cleanLocal = cleanLocal.substring(0, plusIndex);
                }
                return cleanLocal + '@gmail.com';
            }
            
            const plusIndex = localPart.indexOf('+');
            if (plusIndex !== -1) {
                return localPart.substring(0, plusIndex) + '@' + domain;
            }
            
            return normalized;
        }

        function isDisposableEmail(email) {
            if (!email || typeof email !== 'string') return true;
            
            const domain = email.split('@')[1]?.toLowerCase();
            if (!domain) return true;
            
            if (DISPOSABLE_EMAIL_DOMAINS.includes(domain)) {
                return true;
            }
            
            const disposablePatterns = [
                /^temp\./,
                /^tmp\./,
                /^fake\./,
                /^trash\./,
                /^spam\./,
                /^throwaway\./,
                /^disposable\./,
                /\.temp$/,
                /\.tmp$/,
                /\.mailinator\.[a-z]+$/,
                /\.yopmail\.[a-z]+$/,
                /\.10minutemail\.[a-z]+$/
            ];
            
            return disposablePatterns.some(pattern => pattern.test(domain));
        }

        function isValidEmailWithFraudPrevention(email) {
            if (!isValidEmail(email)) {
                return { valid: false, message: "Please enter a valid email address" };
            }
            
            if (isDisposableEmail(email)) {
                return { 
                    valid: false, 
                    message: "Temporary/disposable email addresses are not allowed. Please use your real email." 
                };
            }
            
            return { valid: true, message: "Email is valid" };
        }

        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip || 'unknown';
            } catch (error) {
                console.log('Could not fetch IP:', error);
                return 'unknown';
            }
        }

        function isSelfReferral(referralCode, userEmail) {
            if (!referralCode || !userEmail) return false;
            
            const cache = JSON.parse(localStorage.getItem('jeansClubCache') || '{}');
            const members = cache.members || [];
            
            const referrer = members.find(m => m.referralCode === referralCode);
            if (!referrer) return false;
            
            const normalizedReferrerEmail = normalizeEmailForDatabase(referrer.email);
            const normalizedUserEmail = normalizeEmailForDatabase(userEmail);
            
            return normalizedReferrerEmail === normalizedUserEmail;
        }

        async function checkMultipleAccountsFromIP(email, ip) {
            if (ip === 'unknown') return { allowed: true, reason: '' };
            
            try {
                const allMembers = await clubManager.db.getAllMembers();
                const accountsFromSameIP = allMembers.filter(m => 
                    m.ip_address === ip && 
                    normalizeEmailForDatabase(m.email) !== normalizeEmailForDatabase(email)
                );
                
                if (accountsFromSameIP.length >= 3) {
                    return { 
                        allowed: false, 
                        reason: "Maximum account limit reached from this device/network. Contact support if this is an error." 
                    };
                }
                
                return { allowed: true, reason: '' };
            } catch (error) {
                console.error('Error checking multiple accounts:', error);
                return { allowed: true, reason: '' };
            }
        }

        // Google Apps Script Email Service
        class GoogleAppsEmailService {
            constructor() {
                this.scriptURL = 'https://script.google.com/macros/s/AKfycbwPycPrQFn5hux5eHrbAg1KIc8aO96HwrEI-KUZG7YmITm1ACyqIDQJcWGP5pqq9kun/exec';
                this.isActive = true;
                console.log(' Email service initialized with URL:', this.scriptURL);
            }

            async sendEmailToGoogleScript(email, type, memberData, extraData = null) {
                try {
                    const emailContent = this.buildEmailContent(type, memberData, extraData);
                    const subject = this.getSubject(type, memberData, extraData);
                    
                    const payload = {
                        action: 'sendEmail',
                        emailData: {
                            email: email,
                            type: type,
                            subject: subject,
                            message: emailContent,
                            html: true
                        }
                    };

                    console.log(' Sending email via Google Apps Script:', payload.emailData.type);
                    console.log(' Using URL:', this.scriptURL);

                    try {
                        const response = await fetch(this.scriptURL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            console.log(' Email sent successfully via Google Apps Script:', result);
                            return result;
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    } catch (fetchError) {
                        console.log('Direct fetch failed, trying with no-cors:', fetchError);
                        
                        await fetch(this.scriptURL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(payload)
                        });
                        
                        console.log(' Email request sent (no-cors fallback mode)');
                        return { 
                            success: true, 
                            message: 'Email sent successfully (fallback mode)',
                            fallback: true 
                        };
                    }
                    
                } catch (error) {
                    console.error(' All Google Apps Script email attempts failed:', error);
                    return this.fallbackEmail(email, memberData, type, extraData);
                }
            }

            buildEmailContent(type, memberData, extraData = null) {
                let content = '';
                
                switch(type) {
                    case 'welcome':
                        content = this.buildWelcomeEmail(memberData);
                        break;
                    case 'purchase':
                        content = this.buildPurchaseEmail(memberData, extraData);
                        break;
                    case 'discount':
                        content = this.buildDiscountEmail(memberData, extraData);
                        break;
                    case 'referral':
                        content = this.buildReferralEmail(memberData, extraData);
                        break;
                    case 'password_reset':
                        content = this.buildPasswordResetEmail(memberData, extraData);
                        break;
                    case 'password_reset_success':
                        content = this.buildPasswordResetSuccessEmail(memberData);
                        break;
                    case 'newsletter_welcome':
                        content = this.buildNewsletterWelcomeEmail(memberData, extraData);
                        break;
                    case 'newsletter':
                        content = this.buildNewsletterEmail(memberData, extraData);
                        break;
                    case 'tier_reward':
                        content = this.buildTierRewardEmail(memberData, extraData);
                        break;
                }
                
                return content;
            }

            buildWelcomeEmail(memberData) {
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title>Welcome to Jeans Club!</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 30px; text-align: center; }
                        .content { padding: 40px 30px; }
                        .card { background: #f8f9fa; padding: 25px; margin: 25px 0; border-radius: 8px; border-left: 4px solid #667eea; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                        .btn { display: inline-block; background: #667eea; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;"> Welcome to Jeans Club!</h1>
                            <p style="margin:10px 0 0;">Your Premium Denim Experience Starts Here</p>
                        </div>
                        <div class="content">
                            <h2>Hello ${memberData.name},</h2>
                            <p>Welcome to the Jeans Club family! We're thrilled to have you as a member of our exclusive loyalty program.</p>
                            <div class="card">
                                <h3 style="margin-top:0;"> Your Membership Details</h3>
                                <p><strong>JC ID:</strong> ${memberData.jcId}</p>
                                <p><strong>Tier:</strong> ${memberData.tier}</p>
                                <p><strong>Starting Points:</strong> ${memberData.points} points</p>
                                <p><strong>Referral Code:</strong> <code style="background:#f4f4f4; padding:8px 12px; border-radius:4px;">${memberData.referralCode}</code></p>
                            </div>
                            <div style="background: #e7f3ff; padding: 20px; border-radius: 8px; margin: 20px 0;">
                                <h3 style="margin-top:0;"> New Points System</h3>
                                <p><strong>Earn:</strong> 1 point for every 1,000 UGX spent</p>
                                <p><strong>Redeem:</strong> 1 point = 50 UGX discount</p>
                            </div>
                            <div style="background: #fff3cd; padding: 25px; border-radius: 8px; text-align: center; margin: 25px 0; border: 2px dashed #ffc107;">
                                <h3 style="margin-top:0;"> Bronze+ Get Bi-Monthly Rewards!</h3>
                                <p>Reach 7,500 points to unlock Bronze and receive FREE 10-40% discount QR codes every 2 months!</p>
                            </div>
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" class="btn">Visit Your Dashboard</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Thank you for choosing Jeans Club!</p>
                            <p style="margin:5px 0; color:#666;"> Visit us: https://elijah787.github.io/jeans-club</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            buildTierRewardEmail(memberData, extraData) {
                const qrData = extraData?.qrData || '';
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrData)}`;
                
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title> Your Tier Reward QR Code | Jeans Club</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #333; padding: 40px 30px; text-align: center; }
                        .content { padding: 40px 30px; }
                        .qr-container { background: white; padding: 30px; border-radius: 10px; text-align: center; border: 2px solid #ddd; margin: 25px 0; }
                        .qr-code { width: 200px; height: 200px; margin: 0 auto; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                        .warning { background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107; margin: 20px 0; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;"> Your Tier Reward QR Code</h1>
                            <p style="margin:10px 0 0;">${memberData.tier} Tier  ${extraData?.percentage}% OFF</p>
                        </div>
                        <div class="content">
                            <h2>Hello ${memberData.name},</h2>
                            <p>Your bi-monthly tier reward QR code is ready! Save this email or screenshot the QR code.</p>
                            
                            <div class="qr-container">
                                <h3 style="margin-top:0;">Scan at Checkout</h3>
                                <img src="${qrCodeUrl}" alt="Tier Reward QR Code" class="qr-code">
                                <p style="margin:15px 0 0; font-family: monospace; font-size: 14px;">
                                    <strong>Reward ID:</strong> ${extraData?.qrId}
                                </p>
                            </div>
                            
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                                <h3 style="margin-top:0;"> Reward Details</h3>
                                <p><strong>Discount:</strong> ${extraData?.percentage}% OFF</p>
                                <p><strong>Maximum Discount:</strong> ${extraData?.maxDiscount?.toLocaleString()} UGX</p>
                                <p><strong>Valid Until:</strong> ${new Date(extraData?.expiryDate).toLocaleDateString()}</p>
                                <p><strong>Tier:</strong> ${memberData.tier}</p>
                            </div>
                            
                            <div class="warning">
                                <h4 style="margin-top:0; color:#856404;"> IMPORTANT</h4>
                                <p style="margin-bottom:0;">This QR code can only be generated <strong>ONCE</strong>. Screenshot and save it immediately. If lost, it cannot be regenerated.</p>
                            </div>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" class="btn" style="background: #667eea; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; display: inline-block;">Go to Dashboard</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Thank you for being a Jeans Club ${memberData.tier} member!</p>
                            <p style="margin:5px 0;">Next reward: ${extraData?.nextRewardDate || 'Next reward cycle'}</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            buildPurchaseEmail(memberData, extraData) {
                const amount = extraData?.amount || 0;
                const description = extraData?.description || 'Purchase';
                const pointsEarned = extraData?.pointsEarned || 0;
                const newBalance = extraData?.newBalance || 0;
                
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title> Purchase Recorded | Jeans Club</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 30px; text-align: center; }
                        .content { padding: 40px 30px; }
                        .card { background: #f8f9fa; padding: 25px; margin: 25px 0; border-radius: 8px; border-left: 4px solid #28a745; }
                        .points-earned { background: #e7f3ff; padding: 25px; border-radius: 8px; text-align: center; margin: 25px 0; border: 2px solid #2196F3; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;"> Purchase Recorded!</h1>
                            <p style="margin:10px 0 0;">You've Earned Points</p>
                        </div>
                        <div class="content">
                            <h2>Hello ${memberData.name},</h2>
                            <p>Thank you for your purchase at Jeans Club!</p>
                            
                            <div class="card">
                                <h3 style="margin-top:0;"> Purchase Details</h3>
                                <p><strong>Description:</strong> ${description}</p>
                                <p><strong>Amount:</strong> ${amount.toLocaleString()} UGX</p>
                                <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                            </div>
                            
                            <div class="points-earned">
                                <h3 style="margin-top:0;"> Points Earned</h3>
                                <div style="font-size: 36px; font-weight: bold; color: #2196F3; margin: 10px 0;">+${pointsEarned} points</div>
                                <p>Your new balance: ${newBalance.toLocaleString()} points</p>
                            </div>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" style="background: #667eea; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; display: inline-block;">View Dashboard</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Thank you for shopping with Jeans Club!</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            buildDiscountEmail(memberData, extraData) {
                const voucherCode = extraData?.voucherCode || 'N/A';
                const discountPercentage = extraData?.discountPercentage || 0;
                const expiryDate = extraData?.expiryDate ? new Date(extraData.expiryDate).toLocaleDateString() : 'N/A';
                
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title> Discount Voucher Created | Jeans Club</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 30px; text-align: center; }
                        .voucher-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin: 25px 0; text-align: center; }
                        .voucher-code { font-size: 32px; font-weight: bold; letter-spacing: 5px; margin: 20px 0; font-family: 'Courier New', monospace; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;"> Discount Voucher Created!</h1>
                        </div>
                        <div class="content">
                            <h2>Hello ${memberData.name},</h2>
                            <p>Your discount voucher is ready to use!</p>
                            
                            <div class="voucher-card">
                                <h3 style="color:white; margin-top:0;">YOUR VOUCHER</h3>
                                <div style="background: white; color: #667eea; padding: 10px 25px; border-radius: 30px; font-size: 24px; font-weight: bold; display: inline-block; margin: 15px 0;">${discountPercentage}% OFF</div>
                                <div class="voucher-code">${voucherCode}</div>
                                <p style="color: rgba(255,255,255,0.9);">Valid until: ${expiryDate}</p>
                            </div>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" style="background: #667eea; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; display: inline-block;">Create More Vouchers</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Enjoy your discount at Jeans Club!</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            buildReferralEmail(memberData, extraData) {
                const referredName = extraData?.referredName || 'New Member';
                const pointsEarned = extraData?.pointsEarned || 100;
                
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title> Referral Successful! | Jeans Club</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #333; padding: 40px 30px; text-align: center; }
                        .celebration { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); padding: 30px; border-radius: 10px; margin: 25px 0; text-align: center; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;"> Referral Successful!</h1>
                        </div>
                        <div class="content">
                            <h2>Congratulations ${memberData.name}!</h2>
                            <p>Your friend <strong>${referredName}</strong> has made their first purchase. You've earned bonus points!</p>
                            
                            <div class="celebration">
                                <h3 style="color:#333; margin-top:0;"> BONUS POINTS AWARDED</h3>
                                <div style="font-size: 48px; font-weight: bold; color: #333; margin: 15px 0;">+${pointsEarned} points</div>
                            </div>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" style="background: #667eea; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; display: inline-block;">Share More & Earn More</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Thank you for growing the Jeans Club community!</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            buildPasswordResetEmail(memberData, extraData) {
                const token = extraData?.token || 'N/A';
                
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title> Password Reset Request | Jeans Club</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 30px; text-align: center; }
                        .reset-code { background: #fff3cd; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0; border: 2px dashed #ffc107; }
                        .code-display { font-size: 36px; font-weight: bold; letter-spacing: 8px; color: #333; font-family: 'Courier New', monospace; margin: 15px 0; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;"> Password Reset Request</h1>
                        </div>
                        <div class="content">
                            <h2>Hello ${memberData.name},</h2>
                            <p>We received a request to reset your password. Use the code below:</p>
                            
                            <div class="reset-code">
                                <div class="code-display">${token}</div>
                                <p style="color:#856404;">This code expires in 1 hour</p>
                            </div>
                            
                            <p>If you didn't request this, please ignore this email.</p>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" style="background: #667eea; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; display: inline-block;">Go to Password Reset</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Stay secure with Jeans Club!</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            buildPasswordResetSuccessEmail(memberData) {
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title> Password Reset Successful | Jeans Club</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 40px 30px; text-align: center; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;"> Password Reset Successful!</h1>
                        </div>
                        <div class="content">
                            <h2>Hello ${memberData.name},</h2>
                            <p>Your Jeans Club account password has been successfully reset. You can now login with your new password.</p>
                            
                            <div style="background: #d4edda; padding: 25px; border-radius: 8px; margin: 25px 0; text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 15px;"></div>
                                <h3 style="color: #155724; margin-top: 0;">Password Reset Complete!</h3>
                            </div>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" style="background: #28a745; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; display: inline-block;">Login to Your Account</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Thank you for securing your Jeans Club account!</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            buildNewsletterWelcomeEmail(memberData, extraData) {
                const subject = extraData?.subject || " Welcome to Jeans Club Newsletter!";
                const message = extraData?.message || "We're thrilled to welcome you to our exclusive newsletter community!";
                
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title>${subject}</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 30px; text-align: center; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;"> Welcome to Jeans Club Newsletter!</h1>
                        </div>
                        <div class="content">
                            <h2>Hello ${memberData?.name || 'Valued Member'},</h2>
                            <p>${message}</p>
                            <p>As a newsletter subscriber, you'll receive exclusive offers, new arrivals, and style tips!</p>
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" style="background: #667eea; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; display: inline-block;">Visit Jeans Club</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Thank you for subscribing to Jeans Club Newsletter!</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            buildNewsletterEmail(memberData, extraData) {
                const subject = extraData?.subject || " Jeans Club Newsletter";
                const message = extraData?.message || "Here are your latest updates from Jeans Club!";
                
                return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title>${subject}</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f9f9f9; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 30px; text-align: center; }
                        .content { padding: 40px 30px; }
                        .footer { text-align: center; padding: 25px; color: #666; font-size: 14px; border-top: 1px solid #eee; background: #f8f9fa; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1 style="margin:0;">${subject}</h1>
                        </div>
                        <div class="content">
                            <h2>Hello ${memberData?.name || 'Valued Member'},</h2>
                            <div style="line-height: 1.8; color: #555;">
                                ${message}
                            </div>
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://elijah787.github.io/jeans-club" style="background: #667eea; color: white; padding: 14px 32px; text-decoration: none; border-radius: 5px; display: inline-block;">Visit Jeans Club</a>
                            </div>
                        </div>
                        <div class="footer">
                            <p>Thank you for being a Jeans Club member!</p>
                        </div>
                    </div>
                </body>
                </html>`;
            }

            getSubject(type, memberData, extraData) {
                switch(type) {
                    case 'welcome': return ' Welcome to Jeans Club! Your Premium Denim Journey Starts Here';
                    case 'purchase': return ' Purchase Recorded - ' + (extraData?.description || '') + ' | Points Earned!';
                    case 'discount': return ' ' + (extraData?.discountPercentage || 0) + '% Discount Voucher | Jeans Club Rewards';
                    case 'referral': return ' Referral Success! +100 Points | Keep Sharing the Love';
                    case 'password_reset': return ' Password Reset Request | Jeans Club Account Security';
                    case 'password_reset_success': return ' Password Reset Successful | Jeans Club Account Secured';
                    case 'newsletter_welcome': return " Welcome to Jeans Club Newsletter!";
                    case 'newsletter': return extraData?.subject || " Jeans Club Newsletter";
                    case 'tier_reward': return ` Your ${memberData.tier} Tier Reward QR Code is Ready!`;
                    default: return ' Message from Jeans Club';
                }
            }

            async sendWelcomeEmail(email, memberData) {
                console.log('Attempting to send welcome email to:', email);
                return this.sendEmailToGoogleScript(email, 'welcome', memberData);
            }

            async sendPurchaseEmail(email, memberData, purchaseData) {
                console.log('Attempting to send purchase email to:', email);
                return this.sendEmailToGoogleScript(email, 'purchase', memberData, purchaseData);
            }    

            async sendDiscountEmail(email, memberData, discountData) {
                console.log('Attempting to send discount email to:', email);
                return this.sendEmailToGoogleScript(email, 'discount', memberData, discountData);
            }

            async sendReferralEmail(email, memberData, referralData) {
                console.log('Attempting to send referral email to:', email);
                return this.sendEmailToGoogleScript(email, 'referral', memberData, referralData);
            }
            
            async sendPasswordResetEmail(email, memberData, resetData) {
                console.log('Attempting to send password reset email to:', email);
                return this.sendEmailToGoogleScript(email, 'password_reset', memberData, resetData);
            }

            async sendPasswordResetSuccessEmail(email, memberData) {
                console.log('Attempting to send password reset success email to:', email);
                return this.sendEmailToGoogleScript(email, 'password_reset_success', memberData);
            }

            async sendNewsletterWelcomeEmail(email, memberData, newsletterData) {
                console.log('Attempting to send newsletter welcome email to:', email);
                return this.sendEmailToGoogleScript(email, 'newsletter_welcome', memberData, newsletterData);
            }

            async sendNewsletterEmail(email, memberData, newsletterData) {
                console.log('Attempting to send newsletter email to:', email);
                return this.sendEmailToGoogleScript(email, 'newsletter', memberData, newsletterData);
            }

            async sendTierRewardEmail(email, memberData, rewardData) {
                console.log('Attempting to send tier reward email to:', email);
                return this.sendEmailToGoogleScript(email, 'tier_reward', memberData, rewardData);
            }

            fallbackEmail(email, memberData, type, extraData = null) {
                console.log(' Using fallback email system for:', type);
                
                const subject = this.getSubject(type, memberData, extraData);
                let message = '';
                
                switch(type) {
                    case 'welcome':
                        message = `Welcome to Jeans Club!\n\nDear ${memberData.name},\n\nYour account has been created successfully!\n\nJC ID: ${memberData.jcId}\nTier: ${memberData.tier}\nPoints: ${memberData.points}\nReferral Code: ${memberData.referralCode}\n\nVisit: https://elijah787.github.io/jeans-club`;
                        break;
                    case 'password_reset':
                        message = `Password Reset Request\n\nA password reset has been requested for your account.\nReset Code: ${extraData?.token || 'N/A'}\n\nIf you didn't request this, please ignore this email.`;
                        break;
                    default:
                        message = `Jeans Club Update\n\nType: ${type}\nDetails available in your dashboard.`;
                }
                
                console.log(' Fallback email would send:', { email, subject });
                return { success: true, message: 'Email queued for sending', fallback: true };
            }

            async sendBulkNewsletter(emails, subject, message) {
                try {
                    console.log(` Sending newsletter to ${emails.length} subscribers`);
                    
                    let successCount = 0;
                    let failCount = 0;
                    const results = [];
                    
                    for (const email of emails) {
                        try {
                            const memberData = {
                                name: email.split('@')[0],
                                email: email
                            };
                            
                            if (window.clubManager && window.clubManager.db) {
                                const member = await window.clubManager.db.getMemberByEmail(email);
                                if (member) {
                                    memberData.name = member.name;
                                    memberData.jcId = member.jcId;
                                }
                            }
                            
                            const result = await this.sendEmailToGoogleScript(
                                email,
                                'newsletter',
                                memberData,
                                { subject, message }
                            );
                            
                            if (result.success) {
                                successCount++;
                                results.push({ email, success: true });
                            } else {
                                failCount++;
                                results.push({ email, success: false, error: result });
                            }
                            
                            await new Promise(resolve => setTimeout(resolve, 100));
                            
                        } catch (emailError) {
                            console.error(` Failed to send to ${email}:`, emailError);
                            failCount++;
                            results.push({ email, success: false, error: emailError.message });
                        }
                    }
                    
                    console.log(` Newsletter complete: ${successCount} sent, ${failCount} failed`);
                    
                    return {
                        success: successCount > 0,
                        message: `Newsletter sent: ${successCount} successful, ${failCount} failed`,
                        results: results,
                        successCount,
                        failCount
                    };
                    
                } catch (error) {
                    console.error(' Newsletter error:', error);
                    return {
                        success: false,
                        message: `Failed to send newsletter: ${error.message}`,
                        error: error.toString()
                    };
                }
            }
        }

        // ===========================
        // CLUB MANAGER IMPLEMENTATION
        // ===========================
        
        class ClubManager {
            constructor() {
                this.db = new SupabaseDB();
                this.emailService = new GoogleAppsEmailService();
                this.currentMember = null;
                this.isAdmin = false;
                
                // Initialize systems
                this.voucherSystem = new VoucherSystem();
                
                
                console.log(' ClubManager initialized with:');
                console.log('- Voucher System:', !!this.voucherSystem);
                
                
                // Set global references
                window.voucherSystem = this.voucherSystem;
                
                
                this.init();
            }

            async init() {
                
                
                // Check if user is already logged in
                const savedMember = localStorage.getItem('jeansClubCurrentMember');
                const adminStatus = localStorage.getItem('jeansClubIsAdmin');
                
                if (savedMember) {
                    this.currentMember = JSON.parse(savedMember);
                    this.isAdmin = adminStatus === 'true';
                    
                    // Check for tier reward on login
                    if (this.currentMember && !this.isAdmin) {
                        
                        // Refresh member data
                        const updatedMember = await this.db.getMemberByJCId(this.currentMember.jcId);
                        if (updatedMember) {
                            this.currentMember = updatedMember;
                            localStorage.setItem('jeansClubCurrentMember', JSON.stringify(updatedMember));
                        }
                    }
                    
                    if (this.isAdmin) {
                        showAdminPanel();
                    } else {
                        showDashboard(this.currentMember);
                    }
                } else {
                    showSignupScreen();
                }
                
                // Update voucher statuses on startup
                this.voucherSystem.updateVoucherStatuses();
                
                // Initialize Google Sign-In
                this.initializeGoogleSignIn();
            }

            initializeGoogleSignIn() {
                // Google Sign-In for signup
                google.accounts.id.initialize({
                    client_id: '607807821474-43243foqc9ml9eq3e0ugu04fnsigbqc5.apps.googleusercontent.com',
                    callback: this.handleGoogleSignIn.bind(this),
                    context: 'signup',
                    ux_mode: 'popup'
                });
                
                // Google Sign-In for login
                google.accounts.id.initialize({
                    client_id: '607807821474-43243foqc9ml9eq3e0ugu04fnsigbqc5.apps.googleusercontent.com',
                    callback: this.handleGoogleLogin.bind(this),
                    context: 'login',
                    ux_mode: 'popup'
                });
                
                // Render buttons
                setTimeout(() => {
                    const signupButton = document.querySelector('.google-signin-button');
                    const loginButton = document.querySelector('.google-login-button');
                    
                    if (signupButton) {
                        google.accounts.id.renderButton(
                            signupButton,
                            { 
                                theme: 'outline',
                                size: 'large',
                                width: '100%',
                                text: 'signup_with'
                            }
                        );
                    }
                    
                    if (loginButton) {
                        google.accounts.id.renderButton(
                            loginButton,
                            { 
                                theme: 'outline',
                                size: 'large',
                                width: '100%',
                                text: 'signin_with'
                            }
                        );
                    }
                }, 1000);
            }

            async handleGoogleSignIn(response) {
                try {
                    console.log('Google Sign-In response:', response);
                    
                    const payload = JSON.parse(atob(response.credential.split('.')[1]));
                    const email = payload.email;
                    const name = payload.name;
                    const googleId = payload.sub;
                    
                    const emailValidation = isValidEmailWithFraudPrevention(email);
                    if (!emailValidation.valid) {
                        showToast(emailValidation.message, 'error');
                        return;
                    }
                    
                    let member = await this.db.getMemberByEmail(email);
                    
                    if (member) {
                        this.currentMember = member;
                        this.isAdmin = false;
                        localStorage.setItem('jeansClubCurrentMember', JSON.stringify(member));
                        localStorage.setItem('jeansClubIsAdmin', 'false');
                        
                        member.lastLogin = new Date().toISOString();
                        await this.db.saveMember(member);
                        
                        await this.tierRewardSystem.checkAndIssueReward(member.jcId);
                        const updatedMember = await this.db.getMemberByJCId(member.jcId);
                        if (updatedMember) {
                            this.currentMember = updatedMember;
                            localStorage.setItem('jeansClubCurrentMember', JSON.stringify(updatedMember));
                        }
                        
                        showDashboard(this.currentMember);
                        showToast(`Welcome back ${member.name}!`, 'success');
                    } else {
                        const jcId = this.generateJCId();
                        const referralCode = this.generateReferralCode();
                        
                        member = {
                            jcId: jcId,
                            email: email,
                            name: name,
                            googleId: googleId,
                            loginMethod: 'google',
                            points: 10,
                            tier: 'PEARL',
                            referralCode: referralCode,
                            joinedDate: new Date().toISOString(),
                            totalSpent: 0,
                            newsletterSubscribed: true,
                            purchaseHistory: [],
                            activityLog: [],
                            challenges: [],
                            referrals: [],
                            lastLogin: new Date().toISOString(),
                            createdAt: new Date().toISOString(),
                            tier_reward_available: false,
                            tier_reward_generated: false,
                            reward_history: []
                        };
                        
                        member.activityLog.unshift({
                            timestamp: new Date().toISOString(),
                            action: 'account_created',
                            description: 'Account created via Google Sign-In',
                            points: 10
                        });
                        
                        const saved = await this.db.saveMember(member);
                        if (saved) {
                            this.currentMember = member;
                            this.isAdmin = false;
                            localStorage.setItem('jeansClubCurrentMember', JSON.stringify(member));
                            localStorage.setItem('jeansClubIsAdmin', 'false');
                            
                            this.emailService.sendWelcomeEmail(email, member);
                            this.db.subscribeToNewsletter(email, name);
                            
                            showDashboard(member);
                            showToast(`Welcome to Jeans Club ${name}!`, 'success');
                        } else {
                            showToast('Failed to create account. Please try again.', 'error');
                        }
                    }
                    
                } catch (error) {
                    console.error('Google Sign-In error:', error);
                    showToast('Google Sign-In failed. Please try again.', 'error');
                }
            }

            async handleGoogleLogin(response) {
                try {
                    console.log('Google Login response:', response);
                    
                    const payload = JSON.parse(atob(response.credential.split('.')[1]));
                    const email = payload.email;
                    
                    const member = await this.db.getMemberByEmail(email);
                    
                    if (member) {
                        if (member.loginMethod === 'email') {
                            showToast('Please use email/password to login to this account.', 'error');
                            return;
                        }
                        
                        member.lastLogin = new Date().toISOString();
                        await this.db.saveMember(member);
                        
                        this.currentMember = member;
                        this.isAdmin = false;
                        localStorage.setItem('jeansClubCurrentMember', JSON.stringify(member));
                        localStorage.setItem('jeansClubIsAdmin', 'false');
                        
                        await this.tierRewardSystem.checkAndIssueReward(member.jcId);
                        const updatedMember = await this.db.getMemberByJCId(member.jcId);
                        if (updatedMember) {
                            this.currentMember = updatedMember;
                            localStorage.setItem('jeansClubCurrentMember', JSON.stringify(updatedMember));
                        }
                        
                        showDashboard(this.currentMember);
                        showToast(`Welcome back ${member.name}!`, 'success');
                    } else {
                        showToast('No account found with this Google email. Please sign up first.', 'error');
                        showSignupScreen();
                    }
                    
                } catch (error) {
                    console.error('Google Login error:', error);
                    showToast('Google Login failed. Please try again.', 'error');
                }
            }

            generateJCId() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let id = 'JC';
                for (let i = 0; i < 4; i++) {
                    id += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return id;
            }

            generateReferralCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 6; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return code;
            }

            calculateTier(points) {
                const tiers = [
                    { name: 'PEARL', min: 0, max: 7499 },
                    { name: 'BRONZE', min: 7500, max: 24999 },
                    { name: 'SILVER', min: 25000, max: 99999 },
                    { name: 'RUBY', min: 100000, max: 249999 },
                    { name: 'GOLD', min: 250000, max: 499999 },
                    { name: 'SAPPHIRE', min: 500000, max: 999999 },
                    { name: 'PLATINUM', min: 1000000, max: Infinity }
                ];
                
                for (const tier of tiers) {
                    if (points >= tier.min && points <= tier.max) {
                        return tier.name;
                    }
                }
                return 'PEARL';
            }

            async signUpWithEmail(name, email, password, referralCode = null) {
                try {
                    if (!name || !email || !password) {
                        showToast('Please fill in all required fields', 'error');
                        return false;
                    }
                    
                    const emailValidation = isValidEmailWithFraudPrevention(email);
                    if (!emailValidation.valid) {
                        showToast(emailValidation.message, 'error');
                        return false;
                    }
                    
                    const existingMember = await this.db.getMemberByEmail(email);
                    if (existingMember) {
                        showToast('An account with this email already exists', 'error');
                        return false;
                    }
                    
                    if (referralCode && isSelfReferral(referralCode, email)) {
                        showToast('You cannot use your own referral code', 'error');
                        return false;
                    }
                    
                    const clientIP = await getClientIP();
                    
                    const ipCheck = await checkMultipleAccountsFromIP(email, clientIP);
                    if (!ipCheck.allowed) {
                        showToast(ipCheck.reason, 'error');
                        return false;
                    }
                    
                    const jcId = this.generateJCId();
                    const memberReferralCode = this.generateReferralCode();
                    
                    let referredBy = null;
                    let referralPoints = 10;
                    
                    if (referralCode) {
                        const allMembers = await this.db.getAllMembers();
                        const referrer = allMembers.find(m => m.referralCode === referralCode);
                        
                        if (referrer) {
                            referredBy = referrer.jcId;
                            referralPoints = 20;
                            
                            referrer.referrals.push({
                                referredJCId: jcId,
                                referredName: name,
                                referralDate: new Date().toISOString(),
                                status: 'pending'
                            });
                            await this.db.saveMember(referrer);
                        } else {
                            showToast('Invalid referral code', 'error');
                            return false;
                        }
                    }
                    
                    const member = {
                        jcId: jcId,
                        email: email,
                        name: name.trim(),
                        password: password,
                        loginMethod: 'email',
                        points: referralPoints,
                        tier: 'PEARL',
                        referralCode: memberReferralCode,
                        referredBy: referredBy,
                        joinedDate: new Date().toISOString(),
                        totalSpent: 0,
                        newsletterSubscribed: document.getElementById('newsletterSignup')?.checked || true,
                        purchaseHistory: [],
                        activityLog: [],
                        challenges: [],
                        referrals: [],
                        ip_address: clientIP,
                        lastLogin: new Date().toISOString(),
                        createdAt: new Date().toISOString(),
                        tier_reward_available: false,
                        tier_reward_generated: false,
                        reward_history: []
                    };
                    
                    member.activityLog.unshift({
                        timestamp: new Date().toISOString(),
                        action: 'account_created',
                        description: 'Account created with email',
                        points: referralPoints
                    });
                    
                    const saved = await this.db.saveMember(member);
                    if (!saved) {
                        showToast('Failed to create account. Please try again.', 'error');
                        return false;
                    }
                    
                    this.currentMember = member;
                    this.isAdmin = false;
                    localStorage.setItem('jeansClubCurrentMember', JSON.stringify(member));
                    localStorage.setItem('jeansClubIsAdmin', 'false');
                    
                    this.emailService.sendWelcomeEmail(email, member);
                    
                    if (member.newsletterSubscribed) {
                        this.db.subscribeToNewsletter(email, name);
                        this.emailService.sendNewsletterWelcomeEmail(email, member, {
                            subject: "Welcome to Jeans Club Newsletter!",
                            message: "Thank you for subscribing to our newsletter. You'll receive exclusive offers and updates."
                        });
                    }
                    
                    await showDashboard(member);
                    showToast(`Welcome to Jeans Club ${name}!`, 'success');
                    
                    return true;
                    
                } catch (error) {
                    console.error('Sign up error:', error);
                    showToast('An error occurred. Please try again.', 'error');
                    return false;
                }
            }

            async loginWithJCId(jcId, password) {
                try {
                    if (!jcId || !password) {
                        showToast('Please enter both JC ID and password', 'error');
                        return false;
                    }
                    
                    if (jcId.toLowerCase() === 'admin' && password === 'jeansclub2024') {
                        this.isAdmin = true;
                        this.currentMember = null;
                        localStorage.setItem('jeansClubCurrentMember', '');
                        localStorage.setItem('jeansClubIsAdmin', 'true');
                        
                        showAdminPanel();
                        showToast('Welcome Staff Member!', 'success');
                        return true;
                    }
                    
                    const member = await this.db.getMemberByJCId(jcId.toUpperCase());
                    if (!member) {
                        showToast('Invalid JC ID or password', 'error');
                        return false;
                    }
                    
                    if (member.loginMethod === 'google') {
                        showToast('Please use Google Sign-In for this account', 'error');
                        return false;
                    }
                    
                    if (member.password !== password) {
                        showToast('Invalid JC ID or password', 'error');
                        return false;
                    }
                    
                    member.lastLogin = new Date().toISOString();
                    await this.db.saveMember(member);
                    
                    this.currentMember = member;
                    this.isAdmin = false;
                    localStorage.setItem('jeansClubCurrentMember', JSON.stringify(member));
                    localStorage.setItem('jeansClubIsAdmin', 'false');
                    
                    await this.tierRewardSystem.checkAndIssueReward(member.jcId);
                    const updatedMember = await this.db.getMemberByJCId(member.jcId);
                    if (updatedMember) {
                        this.currentMember = updatedMember;
                        localStorage.setItem('jeansClubCurrentMember', JSON.stringify(updatedMember));
                    }
                    
                    showDashboard(this.currentMember);
                    showToast(`Welcome back ${member.name}!`, 'success');
                    
                    return true;
                    
                } catch (error) {
                    console.error('Login error:', error);
                    showToast('An error occurred. Please try again.', 'error');
                    return false;
                }
            }

            async addPurchase(jcId, amount, description) {
                try {
                    if (!jcId || !amount || amount <= 0) {
                        return { success: false, message: 'Invalid purchase data' };
                    }
                    
                    const member = await this.db.getMemberByJCId(jcId.toUpperCase());
                    if (!member) {
                        return { success: false, message: 'Member not found' };
                    }
                    
                    const pointsEarned = Math.floor(amount / 1000);
                    
                    member.points += pointsEarned;
                    member.totalSpent += amount;
                    member.tier = this.calculateTier(member.points);
                    
                    member.purchaseHistory.unshift({
                        timestamp: new Date().toISOString(),
                        amount: amount,
                        description: description || 'Purchase',
                        pointsEarned: pointsEarned
                    });
                    
                    member.activityLog.unshift({
                        timestamp: new Date().toISOString(),
                        action: 'purchase',
                        description: `Purchase: ${description || 'Item'} - ${amount.toLocaleString()} UGX`,
                        points: pointsEarned
                    });
                    
                    if (member.referredBy) {
                        const referrer = await this.db.getMemberByJCId(member.referredBy);
                        if (referrer) {
                            const referral = referrer.referrals.find(r => r.referredJCId === member.jcId);
                            if (referral && referral.status === 'pending') {
                                referral.status = 'completed';
                                referral.completionDate = new Date().toISOString();
                                
                                referrer.points += 100;
                                referrer.activityLog.unshift({
                                    timestamp: new Date().toISOString(),
                                    action: 'referral_completed',
                                    description: `Referral completed: ${member.name}`,
                                    points: 100
                                });
                                
                                await this.db.saveMember(referrer);
                                
                                this.emailService.sendReferralEmail(referrer.email, referrer, {
                                    referredName: member.name,
                                    pointsEarned: 100
                                });
                            }
                        }
                    }
                    
                    await this.db.saveMember(member);
                    
                    this.emailService.sendPurchaseEmail(member.email, member, {
                        amount: amount,
                        description: description,
                        pointsEarned: pointsEarned,
                        newBalance: member.points
                    });
                    
                    return {
                        success: true,
                        message: `Purchase recorded! ${pointsEarned} points added.`,
                        member: member
                    };
                    
                } catch (error) {
                    console.error('Add purchase error:', error);
                    return { success: false, message: 'Failed to record purchase' };
                }
            }

            logout() {
                this.currentMember = null;
                this.isAdmin = false;
                localStorage.removeItem('jeansClubCurrentMember');
                localStorage.removeItem('jeansClubIsAdmin');
                
                showSignupScreen();
                showToast('Logged out successfully', 'success');
            }

            async deleteMember(jcId) {
                try {
                    if (!jcId) {
                        return { success: false, message: 'Please enter JC ID' };
                    }
                    
                    if (this.currentMember && this.currentMember.jcId === jcId) {
                        return { success: false, message: 'You cannot delete your own account while logged in' };
                    }
                    
                    const member = await this.db.getMemberByJCId(jcId);
                    if (!member) {
                        return { success: false, message: 'Member not found' };
                    }
                    
                    const deleted = await this.db.deleteMember(jcId);
                    if (!deleted) {
                        return { success: false, message: 'Failed to delete member' };
                    }
                    
                    return { success: true, message: `Member ${jcId} deleted successfully` };
                    
                } catch (error) {
                    console.error('Delete member error:', error);
                    return { success: false, message: 'An error occurred' };
                }
            }
            
            async requestPasswordReset(jcId) {
                try {
                    const member = await this.db.getMemberByJCId(jcId);
                    if (!member) {
                        return { success: false, message: 'Member not found' };
                    }
                    
                    if (member.loginMethod === 'google') {
                        return { success: false, message: 'Google accounts do not use passwords. Please use Google Sign-In.' };
                    }
                    
                    const resetToken = Math.floor(100000 + Math.random() * 900000).toString();
                    const resetTokenExpiry = new Date(Date.now() + 3600000);
                    
                    member.resetToken = resetToken;
                    member.resetTokenExpiry = resetTokenExpiry.toISOString();
                    await this.db.saveMember(member);
                    
                    this.emailService.sendPasswordResetEmail(member.email, member, {
                        token: resetToken
                    });
                    
                    return { 
                        success: true, 
                        message: 'Password reset code sent to your email. Check your inbox.' 
                    };
                    
                } catch (error) {
                    console.error('Password reset request error:', error);
                    return { success: false, message: 'Failed to send reset code' };
                }
            }

            async executePasswordReset(jcId, token, newPassword) {
                try {
                    const member = await this.db.getMemberByJCId(jcId);
                    if (!member) {
                        return { success: false, message: 'Member not found' };
                    }
                    
                    if (!member.resetToken || member.resetToken !== token) {
                        return { success: false, message: 'Invalid reset code' };
                    }
                    
                    if (new Date() > new Date(member.resetTokenExpiry)) {
                        return { success: false, message: 'Reset code has expired' };
                    }
                    
                    member.password = newPassword;
                    member.resetToken = null;
                    member.resetTokenExpiry = null;
                    
                    member.activityLog.unshift({
                        timestamp: new Date().toISOString(),
                        action: 'password_reset',
                        description: 'Password reset successfully'
                    });
                    
                    await this.db.saveMember(member);
                    
                    this.emailService.sendPasswordResetSuccessEmail(member.email, member);
                    
                    return { success: true, message: 'Password reset successful! You can now login with your new password.' };
                    
                } catch (error) {
                    console.error('Password reset execution error:', error);
                    return { success: false, message: 'Failed to reset password' };
                }
            }

            async toggleNewsletterSubscription(email, subscribe) {
                try {
                    if (subscribe) {
                        const member = await this.db.getMemberByEmail(email);
                        const name = member ? member.name : null;
                        await this.db.subscribeToNewsletter(email, name);
                        return true;
                    } else {
                        await this.db.unsubscribeFromNewsletter(email);
                        return true;
                    }
                } catch (error) {
                    console.error('Newsletter toggle error:', error);
                    return false;
                }
            }

            async sendNewsletterToSubscribers(subject, content) {
                try {
                    const subscribers = await this.db.getNewsletterSubscribers();
                    
                    if (subscribers.length === 0) {
                        return { success: false, message: 'No active newsletter subscribers found' };
                    }
                    
                    const emails = subscribers.map(s => s.email);
                    
                    const result = await this.emailService.sendBulkNewsletter(emails, subject, content);
                    
                    if (result.success) {
                        return { 
                            success: true, 
                            message: `Newsletter sent to ${emails.length} subscribers successfully` 
                        };
                    } else {
                        return { success: false, message: 'Failed to send newsletter' };
                    }
                    
                } catch (error) {
                    console.error('Send newsletter error:', error);
                    return { success: false, message: 'Failed to send newsletter' };
                }
            }

         
 }
        // ===========================
        // UTILITY FUNCTIONS
        // ===========================
        
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast-notification');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 350px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;
            
            if (type === 'success') toast.style.backgroundColor = '#28a745';
            else if (type === 'error') toast.style.backgroundColor = '#dc3545';
            else if (type === 'warning') toast.style.backgroundColor = '#ffc107';
            else toast.style.backgroundColor = '#17a2b8';
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

       async function showDashboard(member) {
    hideAllSections();
    document.getElementById('dashboardSection').classList.remove('hidden');
    
    //  FORCE FRESH DATA FROM SUPABASE, NOT CACHE
    const freshMember = await clubManager.db.getMemberByJCId(member.jcId);
    if (freshMember) {
        clubManager.currentMember = freshMember;
        localStorage.setItem('jeansClubCurrentMember', JSON.stringify(freshMember));
        updateMemberDashboard(freshMember);
    } else {
        updateMemberDashboard(member);
    }
    
    await updateTierRewardDisplay();
}

        function showAdminPanel() {
            hideAllSections();
            document.getElementById('adminSection').classList.remove('hidden');
            loadAdminMembersList();
        }

        function showSignupScreen() {
            hideAllSections();
            document.getElementById('signupSection').classList.remove('hidden');
        }

        function showLoginScreen() {
            hideAllSections();
            document.getElementById('loginSection').classList.remove('hidden');
        }

        function showPasswordResetScreen() {
            hideAllSections();
            document.getElementById('passwordResetSection').classList.remove('hidden');
        }

        function showAdminLogin() {
            const jcId = prompt('Enter Admin JC ID:');
            const password = prompt('Enter Admin Password:');
            
            if (jcId === 'admin' && password === 'jeansclub2024') {
                clubManager.isAdmin = true;
                clubManager.currentMember = null;
                localStorage.setItem('jeansClubCurrentMember', '');
                localStorage.setItem('jeansClubIsAdmin', 'true');
                
                showAdminPanel();
                showToast('Welcome Staff Member!', 'success');
            } else {
                showToast('Invalid admin credentials', 'error');
            }
        }

        function showDeleteMemberSection() {
            hideAllSections();
            document.getElementById('deleteMemberSection').classList.remove('hidden');
        }

        function showVoucherManagementPanel() {
            hideAllSections();
            document.getElementById('voucherManagementSection').classList.remove('hidden');
            loadAllVouchers();
        }

        function showMembershipInfo() {
            hideAllSections();
            document.getElementById('membershipInfoPage').classList.remove('hidden');
        }

        function showBenefits() {
            hideAllSections();
            document.getElementById('benefitsInfoPage').classList.remove('hidden');
        }

        function showTiers() {
            hideAllSections();
            document.getElementById('tiersInfoPage').classList.remove('hidden');
        }

        function showRewards() {
            hideAllSections();
            document.getElementById('rewardsInfoPage').classList.remove('hidden');
        }

        function showContact() {
            hideAllSections();
            document.getElementById('contactInfoPage').classList.remove('hidden');
        }

        function showLimitsInfo() {
            hideAllSections();
            document.getElementById('limitsInfoPage').classList.remove('hidden');
        }

        function showDashboardSection() {
            if (clubManager.currentMember) {
                showDashboard(clubManager.currentMember);
            } else {
                showLoginScreen();
            }
        }

        function hideAllSections() {
            const sections = [
                'signupSection', 'loginSection', 'passwordResetSection',
                'dashboardSection', 'adminSection', 'deleteMemberSection',
                'voucherManagementSection', 'membershipInfoPage',
                'benefitsInfoPage', 'tiersInfoPage', 'rewardsInfoPage',
                'contactInfoPage', 'limitsInfoPage'
            ];
            
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) element.classList.add('hidden');
            });
        }

        function updateMemberDashboard(member) {
            if (!member) return;
            
            document.getElementById('memberJcId').textContent = member.jcId;
            document.getElementById('memberName').textContent = member.name;
            document.getElementById('memberEmail').textContent = member.email;
            document.getElementById('memberLoginMethod').textContent = member.loginMethod === 'google' ? 'Google Sign-In' : 'Email';
            
            document.getElementById('memberPoints').textContent = member.points.toLocaleString();
            document.getElementById('memberTier').textContent = member.tier;
            document.getElementById('memberTier').className = `tier-${member.tier.toLowerCase()}`;
            document.getElementById('totalSpent').textContent = `${member.totalSpent.toLocaleString()} UGX`;
            document.getElementById('memberReferralCode').textContent = member.referralCode;
            
            const tiers = [
                { name: 'PEARL', min: 0, max: 7499 },
                { name: 'BRONZE', min: 7500, max: 24999 },
                { name: 'SILVER', min: 25000, max: 99999 },
                { name: 'RUBY', min: 100000, max: 249999 },
                { name: 'GOLD', min: 250000, max: 499999 },
                { name: 'SAPPHIRE', min: 500000, max: 999999 },
                { name: 'PLATINUM', min: 1000000, max: Infinity }
            ];
            
            const currentTier = tiers.find(t => t.name === member.tier);
            const nextTier = tiers[tiers.findIndex(t => t.name === member.tier) + 1];
            
            if (nextTier) {
                const progress = ((member.points - currentTier.min) / (nextTier.min - currentTier.min)) * 100;
                document.getElementById('progressFill').style.width = `${Math.min(progress, 100)}%`;
                document.getElementById('tierProgressText').textContent = 
                    `${member.points.toLocaleString()} / ${nextTier.min.toLocaleString()} points to ${nextTier.name}`;
            } else {
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('tierProgressText').textContent = 'Maximum tier reached!';
            }
            
            const newsletterToggle = document.getElementById('newsletterToggle');
            if (member.newsletterSubscribed) {
                newsletterToggle.textContent = 'Unsubscribe from Newsletter';
                newsletterToggle.style.backgroundColor = '#6c757d';
            } else {
                newsletterToggle.textContent = 'Subscribe to Newsletter';
                newsletterToggle.style.backgroundColor = '';
            }
            
            const referredCount = member.referrals ? member.referrals.filter(r => r.status === 'completed').length : 0;
            const pendingCount = member.referrals ? member.referrals.filter(r => r.status === 'pending').length : 0;
            document.getElementById('referralStats').innerHTML = `
                <strong>Completed Referrals:</strong> ${referredCount} (${referredCount * 100} points)<br>
                <strong>Pending Referrals:</strong> ${pendingCount}
            `;
            
            updateActivityLog(member);
            updateMemberVouchers(member.jcId);
            updateMemberCard(member);
        }

        function updateMemberCard(member) {
            const memberCard = document.getElementById('memberCard');
            const cardNumber = document.getElementById('cardNumber');
            const cardHolderName = document.getElementById('cardHolderName');
            const cardTier = document.getElementById('cardTier');
            const cardDate = document.getElementById('cardDate');
            
            memberCard.className = `member-card ${member.tier.toLowerCase()}`;
            
            cardNumber.innerHTML = member.jcId.split('').map(char => `<span>${char}</span>`).join('');
            cardHolderName.textContent = member.name.toUpperCase();
            cardTier.textContent = member.tier;
            cardTier.className = `tier-${member.tier.toLowerCase()}`;
            
            const joinedDate = new Date(member.joinedDate);
            cardDate.textContent = `${String(joinedDate.getMonth() + 1).padStart(2, '0')}/${String(joinedDate.getFullYear()).slice(-2)}`;
        }

        function updateActivityLog(member) {
            const activityLog = document.getElementById('activityLog');
            if (!member.activityLog || member.activityLog.length === 0) {
                activityLog.innerHTML = '<div class="activity-item">No activity yet</div>';
                return;
            }
            
            activityLog.innerHTML = member.activityLog
                .slice(0, 10)
                .map(activity => `
                    <div class="activity-item">
                        <strong>${new Date(activity.timestamp).toLocaleDateString()}</strong><br>
                        ${activity.description}
                        ${activity.points ? `<span style="color: #28a745; font-weight: bold;"> (+${activity.points} pts)</span>` : ''}
                    </div>
                `)
                .join('');
        }

function updateMemberVouchers(jcId) {
    const vouchersList = document.getElementById('vouchersList');
    
    //  FIX: Use global voucherSystem or get from clubManager
    const vs = window.voucherSystem || (clubManager?.voucherSystem);
    
    if (!vs) {
        console.error(' Voucher system not available, retrying in 1 second...');
        vouchersList.innerHTML = '<div class="activity-item">Loading vouchers...</div>';
        
        // Retry after 1 second
        setTimeout(() => updateMemberVouchers(jcId), 1000);
        return;
    }
    
    try {
        const vouchers = vs.getMemberVouchers(jcId);
        
        if (vouchers.length === 0) {
            vouchersList.innerHTML = '<div class="activity-item">No vouchers yet</div>';
            return;
        }
                vouchersList.innerHTML = vouchers.map(voucher => {
                    const statusClass = voucher.status === 'active' ? 'status-active' : 
                                       voucher.status === 'used' ? 'status-used' : 'status-expired';
                    const statusText = voucher.status.charAt(0).toUpperCase() + voucher.status.slice(1);
                    const expiryDate = new Date(voucher.expiryDate).toLocaleDateString();
                    const createdDate = new Date(voucher.createdDate).toLocaleDateString();
                    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent(voucher.code)}`;
                    
                    return `
                        <div class="voucher-item ${voucher.status}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${voucher.discountPercentage}% OFF</strong>
                                    <span class="voucher-status ${statusClass}">${statusText}</span>
                                </div>
                                <div style="font-size: 12px; color: #666;">
                                    Created: ${createdDate}
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin-top: 10px;">
                                <div style="flex: 1;">
                                    <div class="voucher-code">${voucher.code}</div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                        Points used: ${voucher.pointsUsed}<br>
                                        Expires: ${expiryDate}
                                        ${voucher.usedDate ? `<br>Used: ${new Date(voucher.usedDate).toLocaleDateString()}` : ''}
                                    </div>
                                </div>
                                
                                ${voucher.status === 'active' ? `
                                <div style="text-align: center;">
                                    <img src="${qrCodeUrl}" alt="QR Code" 
                                         style="width: 80px; height: 80px; border: 1px solid #ddd; border-radius: 5px; padding: 5px;">
                                    <div style="font-size: 10px; color: #666; margin-top: 5px;">Scan at checkout</div>
                                </div>
                                ` : ''}
                            </div>
                            
                            ${voucher.status === 'active' ? `
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="showVoucherQR('${voucher.code}')" 
                                        class="btn secondary" style="padding: 5px 10px; font-size: 12px; flex: 1;">
                                     Show QR
                                </button>
                            </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading vouchers:', error);
                vouchersList.innerHTML = '<div class="activity-item">Error loading vouchers</div>';
            }
        }

        function showVoucherQR(voucherCode) {
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(voucherCode)}`;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 90%;">
                    <h3 style="margin-top: 0;">Voucher QR Code</h3>
                    <img src="${qrCodeUrl}" alt="QR Code" 
                         style="width: 250px; height: 250px; border: 2px solid #ddd; border-radius: 10px; padding: 10px;">
                    <div style="margin: 15px 0; font-family: 'Courier New', monospace; font-weight: bold; font-size: 18px;">
                        ${voucherCode}
                    </div>
                    <p style="color: #666; margin-bottom: 20px;">Show this QR code at checkout</p>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            class="btn" style="padding: 10px 20px;">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        async function loadAdminMembersList() {
            const adminContent = document.getElementById('adminContent');
            adminContent.innerHTML = '<div class="activity-item">Loading members...</div>';
            
            try {
                const members = await clubManager.db.getAllMembers();
                
                if (members.length === 0) {
                    adminContent.innerHTML = '<div class="activity-item">No members found</div>';
                    return;
                }
                
                adminContent.innerHTML = `
                    <div class="admin-card">
                        <h3>All Members (${members.length})</h3>
                        <div class="members-list">
                            ${members.map(member => `
                                <div class="member-item" style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea;">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <strong>${member.name}</strong><br>
                                            <small>JC ID: ${member.jcId} | Tier: <span class="tier-${member.tier.toLowerCase()}">${member.tier}</span></small><br>
                                            <small>Email: ${member.email}</small><br>
                                            <small>Points: ${member.points.toLocaleString()} | Spent: ${member.totalSpent.toLocaleString()} UGX</small>
                                            ${member.tier_reward_available ? '<br><small style="color: #28a745;"> Reward Available</small>' : ''}
                                            ${member.tier_reward_generated ? '<br><small style="color: #667eea;"> QR Generated</small>' : ''}
                                        </div>
                                        <div style="text-align: right;">
                                            <small>Joined: ${new Date(member.joinedDate).toLocaleDateString()}</small><br>
                                            <button onclick="adminAddPurchaseForMember('${member.jcId}')" class="btn" style="padding: 5px 10px; font-size: 12px; margin-top: 5px;">
                                                Add Purchase
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading members:', error);
                adminContent.innerHTML = '<div class="activity-item">Error loading members</div>';
            }
        }

        function adminAddPurchaseForMember(jcId) {
            document.getElementById('purchaseJCId').value = jcId;
            document.getElementById('purchaseJCId').focus();
        }

        async function loadAllVouchers() {
            const allVouchersList = document.getElementById('allVouchersList');
            const voucherStats = document.getElementById('voucherStats');
            
            const stats = voucherSystem.getVoucherStats();
            voucherStats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                    <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold;">${stats.total}</div>
                        <div style="font-size: 12px; color: #666;">Total</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #d4edda; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold;">${stats.active}</div>
                        <div style="font-size: 12px; color: #666;">Active</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #e2e3e5; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold;">${stats.used}</div>
                        <div style="font-size: 12px; color: #666;">Used</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #f8d7da; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold;">${stats.expired}</div>
                        <div style="font-size: 12px; color: #666;">Expired</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <p><strong>Average Discount:</strong> ${stats.avgDiscount}%</p>
                    <p><strong>Redemption Rate:</strong> ${stats.redemptionRate}</p>
                </div>
            `;
            
            const vouchers = voucherSystem.getAllVouchers();
            
            if (vouchers.length === 0) {
                allVouchersList.innerHTML = '<div class="activity-item">No vouchers found</div>';
                return;
            }
            
            allVouchersList.innerHTML = vouchers.map(voucher => {
                const statusClass = voucher.status === 'active' ? 'status-active' : 
                                   voucher.status === 'used' ? 'status-used' : 'status-expired';
                const statusText = voucher.status.charAt(0).toUpperCase() + voucher.status.slice(1);
                const expiryDate = new Date(voucher.expiryDate).toLocaleDateString();
                const createdDate = new Date(voucher.createdDate).toLocaleDateString();
                
                return `
                    <div class="voucher-item ${voucher.status}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${voucher.memberName} (${voucher.memberJCId})</strong>
                                <span class="voucher-status ${statusClass}">${statusText}</span>
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                ${createdDate}
                            </div>
                        </div>
                        <div class="voucher-code">${voucher.code}</div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            <strong>${voucher.discountPercentage}% OFF</strong> | 
                            Points: ${voucher.pointsUsed} | 
                            Expires: ${expiryDate}
                            ${voucher.usedDate ? `<br>Used by: ${voucher.redeemedBy || 'system'} on ${new Date(voucher.usedDate).toLocaleDateString()}` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===========================
        // TIER REWARD UI FUNCTIONS
        // ===========================

        async function updateTierRewardDisplay() {
            if (!clubManager.currentMember) return;
            
            const status = await clubManager.getTierRewardStatus();
            if (!status) return;
            
            const dashboardSection = document.getElementById('dashboardSection');
            let rewardCard = document.getElementById('tierRewardCard');
            
            if (!rewardCard) {
                rewardCard = document.createElement('div');
                rewardCard.id = 'tierRewardCard';
                rewardCard.className = 'info-card tier-reward-card';
                
                const memberInfo = document.querySelector('.member-info');
                memberInfo.parentNode.insertBefore(rewardCard, memberInfo.nextSibling);
            }
            
            const tier = clubManager.currentMember.tier;
            const rewardConfig = TIER_REWARDS[tier];
            
            if (!rewardConfig.enabled) {
                rewardCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="color: #333; margin: 0 0 10px 0;"> Tier Rewards</h3>
                            <p style="color: #666; margin: 0;">
                                <strong>${tier} Tier</strong>  ${rewardConfig.reason}
                            </p>
                            <p style="color: #999; margin: 10px 0 0 0; font-size: 13px;">
                                Next reward cycle: ${status.nextRewardDate}
                            </p>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px 20px; border-radius: 8px; text-align: center;">
                            <span style="font-size: 24px; color: #667eea;"></span>
                            <p style="margin: 5px 0 0; font-size: 12px; color: #666;">Locked</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            if (status.available && !status.generated) {
                rewardCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="color: #333; margin: 0 0 10px 0;"> Your Tier Reward is READY!</h3>
                            <p style="color: #28a745; font-weight: bold; margin: 0;">
                                ${tier} TIER  ${status.percentage}% OFF
                            </p>
                            <p style="color: #666; margin: 5px 0;">
                                Max discount: ${status.maxDiscount.toLocaleString()} UGX
                            </p>
                            <p style="color: #999; margin: 10px 0 0 0; font-size: 13px;">
                                 Valid until: ${new Date(status.expiryDate).toLocaleDateString()}
                            </p>
                        </div>
                        <div>
                            <button onclick="handleGenerateTierReward()" 
                                    class="btn" 
                                    style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #333; font-weight: bold; padding: 12px 24px;">
                                 GENERATE QR CODE
                            </button>
                            <p style="margin: 10px 0 0; font-size: 12px; color: #666; text-align: center;">
                                Once per 2 months  60 days validity
                            </p>
                        </div>
                    </div>
                `;
            } else if (status.generated && !status.usedDate) {
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(status.qrCode)}`;
                
                rewardCard.innerHTML = `
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <h3 style="color: #333; margin: 0 0 10px 0;"> Your Tier Reward QR Code</h3>
                                <p style="color: #28a745; font-weight: bold; margin: 0;">
                                    ${tier} TIER  ${status.percentage}% OFF  Max ${status.maxDiscount.toLocaleString()} UGX
                                </p>
                            </div>
                            <span style="background: #28a745; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px;">
                                 GENERATED
                            </span>
                        </div>
                        
                        <div style="display: flex; gap: 30px; align-items: center; flex-wrap: wrap;">
                            <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                <img src="${qrCodeUrl}" alt="Tier Reward QR Code" style="width: 200px; height: 200px;">
                                <p style="margin: 10px 0 0; font-size: 12px; color: #666; text-align: center;">
                                    Reward ID: ${status.qrId}
                                </p>
                            </div>
                            
                            <div style="flex: 1;">
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                                    <h4 style="margin-top: 0; color: #333;">How to use:</h4>
                                    <ol style="color: #666; margin-bottom: 20px;">
                                        <li style="margin-bottom: 10px;">Show this QR code at checkout</li>
                                        <li style="margin-bottom: 10px;">Cashier scans the code</li>
                                        <li style="margin-bottom: 10px;">Get ${status.percentage}% off (up to ${status.maxDiscount.toLocaleString()} UGX)</li>
                                        <li>Valid until: ${new Date(status.expiryDate).toLocaleDateString()}</li>
                                    </ol>
                                    
                                    <div style="display: flex; gap: 10px;">
                                        <button onclick="downloadRewardQR()" class="btn secondary" style="flex: 1;">
                                             Download QR
                                        </button>
                                        <button onclick="emailRewardQR()" class="btn secondary" style="flex: 1;">
                                             Email QR
                                        </button>
                                    </div>
                                    
                                    <p style="color: #dc3545; font-size: 12px; margin-top: 15px;">
                                         This QR code can only be generated ONCE. Screenshot and save it.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (status.usedDate) {
                rewardCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="color: #333; margin: 0 0 10px 0;"> Tier Reward</h3>
                            <p style="color: #666; margin: 0;">
                                <strong>${tier} Tier  ${status.percentage}% OFF</strong>
                            </p>
                            <p style="color: #999; margin: 5px 0;">
                                Used on: ${new Date(status.usedDate).toLocaleDateString()}
                            </p>
                        </div>
                        <div style="background: #e2e3e5; padding: 10px 20px; border-radius: 8px;">
                            <span style="color: #6c757d; font-weight: bold;"> USED</span>
                        </div>
                    </div>
                    <p style="color: #667eea; margin: 15px 0 0 0;">
                        Next reward: ${status.nextRewardDate}
                    </p>
                `;
            } else {
                rewardCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="color: #333; margin: 0 0 10px 0;"> Tier Rewards</h3>
                            <p style="color: #666; margin: 0;">
                                <strong>${tier} Tier</strong>  ${status.percentage}% OFF (up to ${status.maxDiscount.toLocaleString()} UGX)
                            </p>
                            <p style="color: #999; margin: 10px 0 0 0;">
                                Next reward available: ${status.nextRewardDate}
                            </p>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px 20px; border-radius: 8px;">
                            <span style="color: #666;"> Every 2 months</span>
                        </div>
                    </div>
                `;
            }
        }

        async function handleGenerateTierReward() {
            try {
                showToast("Generating your tier reward QR code...", "info");
                
                const result = await clubManager.generateTierRewardQR();
                
                if (result.success) {
                    await updateTierRewardDisplay();
                    showToast(" QR code generated successfully! Save it now.", "success");
                    
                    // Send email with QR code
                    if (clubManager.currentMember && clubManager.currentMember.email) {
                        clubManager.emailService.sendTierRewardEmail(
                            clubManager.currentMember.email,
                            clubManager.currentMember,
                            {
                                qrData: result.qrData,
                                qrId: result.qrId,
                                percentage: result.percentage,
                                maxDiscount: result.maxDiscount,
                                expiryDate: result.expiryDate,
                                nextRewardDate: tierRewardSystem.getNextRewardDate()
                            }
                        );
                    }
                    
                    playScanBeep();
                }
            } catch (error) {
                showToast(error.message || "Failed to generate QR code", "error");
            }
        }

        function downloadRewardQR() {
            const qrImg = document.querySelector('#tierRewardCard img');
            if (!qrImg) return;
            
            const link = document.createElement('a');
            link.download = `jeans-club-${clubManager.currentMember.tier}-reward-${new Date().getTime()}.png`;
            link.href = qrImg.src;
            link.click();
            
            showToast("QR code downloaded!", "success");
        }

        async function emailRewardQR() {
            if (!clubManager.currentMember) return;
            
            showToast("Sending QR code to your email...", "info");
            
            await clubManager.emailService.sendTierRewardEmail(
                clubManager.currentMember.email,
                clubManager.currentMember,
                {
                    qrData: clubManager.currentMember.tier_reward_qr_code,
                    qrId: clubManager.currentMember.tier_reward_qr_id,
                    percentage: clubManager.currentMember.tier_reward_percentage,
                    maxDiscount: clubManager.currentMember.tier_reward_max_discount,
                    expiryDate: clubManager.currentMember.tier_reward_expiry_date,
                    nextRewardDate: tierRewardSystem.getNextRewardDate()
                }
            );
            
            showToast("QR code sent to your email!", "success");
        }

        // ===========================
        // EVENT HANDLERS
        // ===========================
        
        function signUpWithEmail() {
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const password = document.getElementById('userPassword').value;
            const referralCode = document.getElementById('referralCode').value.trim().toUpperCase();
            
            if (!name || !email || !password) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            clubManager.signUpWithEmail(name, email, password, referralCode);
        }

        function loginWithCredentials() {
            const jcId = document.getElementById('loginJCId').value.trim().toUpperCase();
            const password = document.getElementById('loginPassword').value;
            
            clubManager.loginWithJCId(jcId, password);
        }

        function requestPasswordReset() {
            const jcId = document.getElementById('resetJCId').value.trim().toUpperCase();
            
            if (!jcId) {
                showToast('Please enter your JC ID', 'error');
                return;
            }
            
            clubManager.requestPasswordReset(jcId).then(result => {
                const resultElement = document.getElementById('resetRequestResult');
                if (result.success) {
                    resultElement.innerHTML = `<div class="success-message">${result.message}</div>`;
                    document.getElementById('resetForm').classList.remove('hidden');
                } else {
                    resultElement.innerHTML = `<div class="error-message">${result.message}</div>`;
                }
            });
        }

        function executePasswordReset() {
            const jcId = document.getElementById('resetJCId').value.trim().toUpperCase();
            const token = document.getElementById('resetToken').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!jcId || !token || !newPassword || !confirmPassword) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            clubManager.executePasswordReset(jcId, token, newPassword).then(result => {
                const resultElement = document.getElementById('resetExecuteResult');
                if (result.success) {
                    resultElement.innerHTML = `<div class="success-message">${result.message}</div>`;
                    setTimeout(() => showLoginScreen(), 3000);
                } else {
                    resultElement.innerHTML = `<div class="error-message">${result.message}</div>`;
                }
            });
        }

        function adminAddPurchase() {
            const jcId = document.getElementById('purchaseJCId').value.trim().toUpperCase();
            const amount = parseFloat(document.getElementById('purchaseAmount').value);
            const description = document.getElementById('purchaseDescription').value.trim();
            
            if (!jcId || !amount || amount <= 0 || !description) {
                showToast('Please fill in all fields correctly', 'error');
                return;
            }
            
            clubManager.addPurchase(jcId, amount, description).then(result => {
                const resultElement = document.getElementById('purchaseResult');
                if (result.success) {
                    resultElement.innerHTML = `<div class="success-message">${result.message}</div>`;
                    document.getElementById('purchaseJCId').value = '';
                    document.getElementById('purchaseAmount').value = '';
                    document.getElementById('purchaseDescription').value = '';
                    
                    loadAdminMembersList();
                } else {
                    resultElement.innerHTML = `<div class="error-message">${result.message}</div>`;
                }
            });
        }

        function confirmDeleteMember() {
            const jcId = document.getElementById('deleteJCId').value.trim().toUpperCase();
            
            if (!jcId) {
                showToast('Please enter JC ID', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete member ${jcId}? This action cannot be undone.`)) {
                return;
            }
            
            clubManager.deleteMember(jcId).then(result => {
                const resultElement = document.getElementById('deleteResult');
                if (result.success) {
                    resultElement.innerHTML = `<div class="success-message">${result.message}</div>`;
                    document.getElementById('deleteJCId').value = '';
                    loadAdminMembersList();
                } else {
                    resultElement.innerHTML = `<div class="error-message">${result.message}</div>`;
                }
            });
        }

        function calculateDiscount() {
            const points = parseInt(document.getElementById('discountPoints').value);
            
            if (!points || points < 4) {
                showToast('Minimum 4 points required', 'error');
                return;
            }
            
            if (points > clubManager.currentMember.points) {
                showToast(`You only have ${clubManager.currentMember.points} points`, 'error');
                return;
            }
            
            const discountValue = points * 50;
            const discountPercentage = Math.min((discountValue / 10000) * 100, 100);
            
            document.getElementById('discountResult').innerHTML = `
                <div class="discount-success">
                    <strong>Discount Calculation:</strong><br>
                    <strong>Points to use:</strong> ${points} points<br>
                    <strong>Discount value:</strong> ${discountValue.toLocaleString()} UGX<br>
                    <strong>Approx. percentage:</strong> ${discountPercentage.toFixed(1)}% off<br>
                    <strong>New points balance:</strong> ${clubManager.currentMember.points - points} points
                </div>
            `;
        }

        async function redeemPoints() {
            const points = parseInt(document.getElementById('discountPoints').value);
            
            if (!points || points < 4) {
                showToast('Minimum 4 points required', 'error');
                return;
            }
            
            if (points > clubManager.currentMember.points) {
                showToast(`You only have ${clubManager.currentMember.points} points`, 'error');
                return;
            }
            
            const discountValue = points * 50;
            const discountPercentage = Math.min(Math.round((discountValue / 10000) * 100), 100);
            
            try {
                const voucher = await voucherSystem.createVoucher(
                    clubManager.currentMember.jcId,
                    clubManager.currentMember.name,
                    points,
                    discountPercentage
                );
                
                clubManager.currentMember.points -= points;
                clubManager.currentMember.activityLog.unshift({
                    timestamp: new Date().toISOString(),
                    action: 'voucher_created',
                    description: `Created ${discountPercentage}% discount voucher`,
                    points: -points
                });
                
                await clubManager.db.saveMember(clubManager.currentMember);
                
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(voucher.code)}`;
                
                document.getElementById('discountResult').innerHTML = `
                    <div class="discount-success">
                        <strong> Voucher Created Successfully!</strong><br><br>
                        
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="background: white; padding: 15px; border-radius: 10px; display: inline-block; border: 2px solid #ddd;">
                                <img src="${qrCodeUrl}" alt="QR Code for voucher ${voucher.code}" 
                                     style="width: 150px; height: 150px;">
                                <p style="margin: 10px 0 0; font-size: 12px; color: #666;">Scan at checkout</p>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <table style="width: 100%;">
                                <tr>
                                    <td><strong>Voucher Code:</strong></td>
                                    <td style="font-family: 'Courier New', monospace; font-weight: bold; color: #667eea;">${voucher.code}</td>
                                </tr>
                                <tr>
                                    <td><strong>Discount:</strong></td>
                                    <td style="font-size: 18px; font-weight: bold; color: #28a745;">${discountPercentage}% OFF</td>
                                </tr>
                                <tr>
                                    <td><strong>Points Used:</strong></td>
                                    <td>${points} points</td>
                                </tr>
                                <tr>
                                    <td><strong>Value:</strong></td>
                                    <td>${discountValue.toLocaleString()} UGX</td>
                                </tr>
                                <tr>
                                    <td><strong>Expires:</strong></td>
                                    <td>${new Date(voucher.expiryDate).toLocaleDateString()}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="shareVoucher('${voucher.code}', '${discountPercentage}%')" 
                                    class="btn" style="flex: 1;">
                                 Share Voucher
                            </button>
                            <button onclick="printVoucher('${voucher.code}', '${qrCodeUrl}', ${discountPercentage})" 
                                    class="btn secondary" style="flex: 1;">
                                 Print
                            </button>
                        </div>
                        
                        <p style="margin-top: 15px; font-size: 12px; color: #666;">
                            <strong>How to use:</strong> Show the QR code or voucher code at checkout
                        </p>
                    </div>
                `;
                
                updateMemberDashboard(clubManager.currentMember);
                
                clubManager.emailService.sendDiscountEmail(
                    clubManager.currentMember.email,
                    clubManager.currentMember,
                    {
                        voucherCode: voucher.code,
                        discountPercentage: discountPercentage,
                        expiryDate: voucher.expiryDate,
                        qrCodeUrl: qrCodeUrl
                    }
                );
                
                showToast('Discount voucher created with QR code!', 'success');
                
            } catch (error) {
                console.error('Error creating voucher:', error);
                showToast('Failed to create voucher. Please try again.', 'error');
            }
        }

        async function toggleNewsletter() {
            if (!clubManager.currentMember) return;
            
            const currentStatus = clubManager.currentMember.newsletterSubscribed;
            const newStatus = !currentStatus;
            
            const success = await clubManager.toggleNewsletterSubscription(
                clubManager.currentMember.email,
                newStatus
            );
            
            if (success) {
                clubManager.currentMember.newsletterSubscribed = newStatus;
                await clubManager.db.saveMember(clubManager.currentMember);
                updateMemberDashboard(clubManager.currentMember);
                
                showToast(
                    newStatus ? 'Subscribed to newsletter!' : 'Unsubscribed from newsletter',
                    'success'
                );
            } else {
                showToast('Failed to update newsletter subscription', 'error');
            }
        }

        function shareReferral() {
            if (!clubManager.currentMember) return;
            
            const referralCode = clubManager.currentMember.referralCode;
            const shareText = `Join me on Jeans Club! Use my referral code ${referralCode} to get bonus points when you sign up. ${window.location.href}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Join Jeans Club',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText);
                showToast('Referral link copied to clipboard!', 'success');
            }
        }

        function refreshData() {
            if (clubManager.currentMember) {
                clubManager.db.getMemberByJCId(clubManager.currentMember.jcId).then(member => {
                    if (member) {
                        clubManager.currentMember = member;
                        localStorage.setItem('jeansClubCurrentMember', JSON.stringify(member));
                        updateMemberDashboard(member);
                        showToast('Data refreshed!', 'success');
                    }
                });
            }
        }

        function refreshVouchers() {
            loadAllVouchers();
            showToast('Vouchers refreshed!', 'success');
        }
async function processScan() {
    const codeInput = document.getElementById('voucherCodeInput').value.trim();
    const salespersonName = document.getElementById('salespersonName').value.trim();
    
    if (!codeInput || !salespersonName) {
        showToast('Please enter voucher code and your name', 'error');
        return;
    }
    
    // Check if it's a TIER REWARD QR
    if (codeInput.startsWith('{') && codeInput.includes('TIER_REWARD')) {
        try {
            const result = await clubManager.tierRewardSystem.redeemRewardQR(codeInput, salespersonName);
            if (result.success) {
                // ... success message ...
            }
        } catch (error) {
            // ... error handling ...
        }
    }
    // Check if it's a VOUCHER CODE
    else {
        let voucher = await voucherSystem.getVoucherByCode(codeInput);
        
        if (voucher) {
            const result = await voucherSystem.redeemVoucher(codeInput, salespersonName);
            
            if (result.success) {
                document.getElementById('voucherRedeemResult').innerHTML = `
                    <div class="success-message">
                        <strong> VOUCHER REDEEMED SUCCESSFULLY!</strong><br>
                        Member: ${voucher.memberName} (${voucher.memberJCId})<br>
                        Discount: ${voucher.discountPercentage}%<br>
                        Redeemed by: ${salespersonName}<br>
                        Time: ${new Date().toLocaleString()}
                    </div>
                `;
                
                showToast('Voucher redeemed successfully!', 'success');
                showVoucherDetails(voucher);
                
                //  FORCE VOUCHER LIST REFRESH FOR THIS MEMBER
                if (clubManager && clubManager.currentMember && clubManager.currentMember.jcId === voucher.memberJCId) {
                    updateMemberVouchers(voucher.memberJCId);
                }
                
                //  CLEAR INPUT
                document.getElementById('voucherCodeInput').value = '';
                
            } else {
                // ... error handling ...
            }
        }
    }
}

        function showVoucherDetails(voucher) {
            const detailsDiv = document.getElementById('scanDetails');
            detailsDiv.classList.remove('hidden');
            
            detailsDiv.innerHTML = `
                <h4>Voucher Details</h4>
                <div class="details-grid">
                    <div class="detail-item">
                        <strong>Code</strong>
                        <div>${voucher.code}</div>
                    </div>
                    <div class="detail-item">
                        <strong>Member</strong>
                        <div>${voucher.memberName} (${voucher.memberJCId})</div>
                    </div>
                    <div class="detail-item">
                        <strong>Discount</strong>
                        <div>${voucher.discountPercentage}%</div>
                    </div>
                    <div class="detail-item">
                        <strong>Points Used</strong>
                        <div>${voucher.pointsUsed}</div>
                    </div>
                    <div class="detail-item">
                        <strong>Created</strong>
                        <div>${new Date(voucher.createdDate).toLocaleDateString()}</div>
                    </div>
                    <div class="detail-item">
                        <strong>Expires</strong>
                        <div>${new Date(voucher.expiryDate).toLocaleDateString()}</div>
                    </div>
                    <div class="detail-item">
                        <strong>Status</strong>
                        <div class="voucher-status status-${voucher.status}">${voucher.status.toUpperCase()}</div>
                    </div>
                </div>
            `;
        }

        async function sendNewsletter() {
            const subject = document.getElementById('newsletterSubject').value.trim();
            const content = document.getElementById('newsletterContent').value.trim();
            
            if (!subject || !content) {
                showToast('Please enter both subject and content', 'error');
                return;
            }
            
            const result = await clubManager.sendNewsletterToSubscribers(subject, content);
            
            if (result.success) {
                document.getElementById('newsletterResult').innerHTML = `
                    <div class="success-message">${result.message}</div>
                `;
                document.getElementById('newsletterSubject').value = '';
                document.getElementById('newsletterContent').value = '';
            } else {
                document.getElementById('newsletterResult').innerHTML = `
                    <div class="error-message">${result.message}</div>
                `;
            }
        }

        function logout() {
            clubManager.logout();
        }

        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        function showSearch() {
            const searchModal = document.getElementById('searchModal');
            searchModal.classList.add('active');
            document.getElementById('searchInput').focus();
            document.body.style.overflow = 'hidden';
        }

        function hideSearch() {
            const searchModal = document.getElementById('searchModal');
            searchModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const query = e.target.value.toLowerCase();
                    const resultsDiv = document.getElementById('searchResults');
                    
                    if (query.length < 2) {
                        resultsDiv.innerHTML = '<div class="search-result-item">Type at least 2 characters to search</div>';
                        return;
                    }
                    
                    const cache = JSON.parse(localStorage.getItem('jeansClubCache') || '{}');
                    const members = cache.members || [];
                    
                    const vouchers = voucherSystem ? voucherSystem.getAllVouchers() : [];
                    
                    const memberResults = members.filter(member => 
                        member.jcId.toLowerCase().includes(query) ||
                        member.name.toLowerCase().includes(query) ||
                        member.email.toLowerCase().includes(query) ||
                        member.referralCode.toLowerCase().includes(query)
                    );
                    
                    const voucherResults = vouchers.filter(voucher =>
                        voucher.code.toLowerCase().includes(query) ||
                        voucher.memberJCId.toLowerCase().includes(query) ||
                        voucher.memberName.toLowerCase().includes(query)
                    );
                    
                    let resultsHTML = '';
                    
                    if (memberResults.length > 0) {
                        resultsHTML += '<div style="color: #667eea; padding: 10px 15px; font-weight: bold;">Members</div>';
                        resultsHTML += memberResults.slice(0, 5).map(member => `
                            <div class="search-result-item" onclick="showMemberDetails('${member.jcId}')">
                                <strong>${member.name}</strong> (${member.jcId})<br>
                                <small>Tier: ${member.tier} | Points: ${member.points} | Email: ${member.email}</small>
                                ${member.tier_reward_available ? '<br><small style="color: #28a745;"> Reward Available</small>' : ''}
                            </div>
                        `).join('');
                    }
                    
                    if (voucherResults.length > 0) {
                        resultsHTML += '<div style="color: #667eea; padding: 10px 15px; font-weight: bold;">Vouchers</div>';
                        resultsHTML += voucherResults.slice(0, 5).map(voucher => `
                            <div class="search-result-item" onclick="showVoucherDetailsInSearch('${voucher.code}')">
                                <strong>${voucher.code}</strong> - ${voucher.discountPercentage}% OFF<br>
                                <small>Member: ${voucher.memberName} | Status: ${voucher.status}</small>
                            </div>
                        `).join('');
                    }
                    
                    if (resultsHTML === '') {
                        resultsHTML = '<div class="search-result-item">No results found</div>';
                    }
                    
                    resultsDiv.innerHTML = resultsHTML;
                });
            }
        });

        function showMemberDetails(jcId) {
            hideSearch();
            if (clubManager.isAdmin) {
                showAdminPanel();
                adminAddPurchaseForMember(jcId);
            } else {
                showDashboardSection();
            }
        }

        async function showVoucherDetailsInSearch(code) {
            hideSearch();
            const voucher = await voucherSystem.getVoucherByCode(code);
            if (voucher) {
                showAdminPanel();
                document.getElementById('voucherCodeInput').value = code;
                showToast(`Voucher ${code} loaded`, 'info');
            }
        }

        function toggleUserMenu() {
            if (clubManager.currentMember) {
                showDashboardSection();
            } else {
                showLoginScreen();
            }
        }

        function isValidEmail(email) {
            const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }

        window.onload = function() {
            console.log('=== PAGE LOAD START ===');
            
            clubManager = new ClubManager();
            
            setTimeout(() => {
                if (clubManager) {
                    voucherSystem = clubManager.voucherSystem;
                    tierRewardSystem = clubManager.tierRewardSystem;
                    
                    console.log('Systems initialized:');
                    console.log('- voucherSystem:', !!voucherSystem);
                    console.log('- tierRewardSystem:', !!tierRewardSystem);
                }
                
                const urlParams = new URLSearchParams(window.location.search);
                const action = urlParams.get('action');
                
                if (action === 'login') {
                    showLoginScreen();
                } else if (action === 'signup') {
                    showSignupScreen();
                } else if (action === 'admin') {
                    showAdminLogin();
                }
                
                console.log('=== PAGE LOAD COMPLETE ===');
            }, 1000);
            
            document.getElementById('searchModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideSearch();
                }
            });
            
            document.getElementById('cameraScannerModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCameraScanner();
                }
            });
        };

        
    </script>
</body>
</html>